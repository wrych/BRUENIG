function msToISO(a){if(isNaN(a))throw"NaN";return toLocalISO(new Date(a))}function toLocalISO(a){var b=-a.getTimezoneOffset(),c=b>=0?"+":"-",d=function(a){var b=Math.abs(Math.floor(a));return(b<10?"0":"")+b};return a.getFullYear()+"-"+d(a.getMonth()+1)+"-"+d(a.getDate())+"T"+d(a.getHours())+":"+d(a.getMinutes())+":"+d(a.getSeconds())+"."+d(a.getMilliseconds())+c+d(b/60)}function saveFile(a,b){if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(b,a);else{var c=window.document.createElement("a");console.log(a),c.download=a,c.href=window.URL.createObjectURL(b),document.body.appendChild(c),c.click(),document.body.removeChild(c)}}function filterInt(a){return/^(\-|\+)?([0-9]+|Infinity)$/.test(a)?Number(a):NaN}function prettyJSON(a){if("string"==typeof a){try{var b=JSON.parse(a)}catch(b){return a}a=JSON.stringify(b,void 0,2)}return a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),a.replace(/("(\\u[a-zA&amp;'-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(a){var b="number";return/^"/.test(a)?b=/:$/.test(a)?"key":"string":/true|false/.test(a)?b="boolean":/null/.test(a)&&(b="null"),'<span class="'+b+'">'+a+"</span>"})}function extend(a,b){var c=b.prototype;b.prototype=Object.create(a.prototype);for(var d in c)b.prototype[d]=c[d];b.prototype.constructor=b,Object.defineProperty(b.prototype,"constructor",{enumerable:!1,value:b})}function construct(a,b){function c(){return a.apply(this,b)}return c.prototype=a.prototype,new c}function AreaResizer(){this.addResizeListener(this.resized),this.offsetList=[]}function LineBreak(){this.jElement=$("<br>")}function Area(a,b,c,d){this.parent=a,this.id=b,this.name=c,this.description=d,this.jElement=$('<div class="area"></div>').appendTo(this.parent.getJElement())}function BodyArea(a){this.parentJElement=null,this.parent=null,this.id=a,this.name="Body",this.description="Body",this.jElement=$("body")}function PlacementArea(a,b,c,d){Area.call(this,a,b,c,d),this.jElement.addClass("placement")}function BlockArea(a,b,c,d){Area.call(this,a,b,c,d),this.jElement.addClass("block"),this.widgetList=[]}function ViewArea(a,b,c,d){BlockArea.call(this,a,b,c,d),this.active=!0}function WidgetArea(a,b,c,d){Area.call(this,a,b,c,d),this.jElement.addClass("widget")}function ContainerArea(a,b,c,d){Area.call(this,a,b,c,d),this.jElement.addClass("container"),this.widgetList=[]}function Pre(a,b,c,d){ContainerArea.call(this,a,b,c,d),this.type="Pre",this.jPre=$("<pre/>").appendTo(this.jElement),this.jPre.appendTo(this.jElement)}function Input(a,b,c,d){ContainerArea.call(this,a,b,c,d),this.type="Input",this.label=new _Label(this,this.id,this.name,this.description),this.nwl01=this.addNewLine(),this.jInput=$("<input>").prop({type:"Text"}).appendTo(this.jElement)}function FileInput(a,b,c,d){ContainerArea.call(this,a,b,c,d),this.type="FileInput",this.label=new _Label(this,this.id,this.name,this.description),this.nwl01=this.addNewLine(),this.jInput=$("<input>").prop({type:"file"}).appendTo(this.jElement)}function CheckBox(a,b,c,d){ContainerArea.call(this,a,b,c,d),this.type="CheckBox",this.label=new _Label(this,this.id,this.name,this.description),$("<br>").appendTo(this.jElement),this.jInput=$("<input type='checkbox'>").appendTo(this.jElement)}function Select(a,b,c,d){ContainerArea.call(this,a,b,c,d),this.type="Select",this.length=0,this.label=new _Label(this,this.id,this.name,this.description),$("<br>").appendTo(this.jElement),this.jInput=$("<select></select>").appendTo(this.jElement)}function Extendable(a,b,c,d){ContainerArea.call(this,a,b,c,d),this.jElement.addClass("expandable"),this.expanded=!1,this.clickListeners=[],this.tlt01=this.addWidget(Title,[]),this.tlt01.setLvl("h3"),this.tlt01.setWidth("800px"),this._img01=this.addWidget(Image,[]),this._img01.setSrc("im/expand.png"),this._img01.setWidth("12px"),this.addNewLine(),this.containerArea=this.addWidget(ContainerArea,[]),this.containerArea.setVisibility(!1),this.addClickListener(this.tlt01.jElement,this.clicked),this.addClickListener(this._img01.jElement,this.clicked),this.click(this.toggle,this)}function _Label(a,b,c,d){WidgetArea.call(this,a,b,c,d),this.type="_Label",this.jElement.addClass("label"),this.setWidth("200px"),this.setHeight("18px")}function Label(a,b,c,d){ContainerArea.call(this,a,b,c,d),this.type="Label",this.label=new _Label(this,this.id,this.name,this.description)}function _Title(a,b,c,d){WidgetArea.call(this,a,b,c,d),this.type="_Label",this.jElement.addClass("label"),this.jTitle=$("<h1></h1>").appendTo(this.jElement)}function Title(a,b,c,d){ContainerArea.call(this,a,b,c,d),this.type="Label",this.title=new _Title(this,this.id,this.name,this.description)}function SVGImage(a,b,c,d){ContainerArea.call(this,a,b,c,d),this.type="Image",this.image=new _SVGImage(this,this.id,this.name,this.description)}function _SVGImage(a,b,c,d){WidgetArea.call(this,a,b,c,d),this.type="_Image",this.jElement.addClass("image"),this.svgImage=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.jImage=$(this.svgImage).appendTo(this.getJElement()),this.jImage.addClass("imageDisp")}function Image(a,b,c,d){ContainerArea.call(this,a,b,c,d),this.type="Image",this.image=new _Image(this,this.id,this.name,this.description)}function _Image(a,b,c,d){WidgetArea.call(this,a,b,c,d),this.type="_Image",this.jElement.addClass("image"),this.jImage=$('<img src="">').appendTo(this.getJElement()),this.jImage.addClass("imageDisp")}function _StatusIndicator(a,b,c,d){WidgetArea.call(this,a,b,c,d),this.type="StatusIndicator",this.jElement.addClass("statusIndicator"),this.setWidth("18px"),this.setHeight("18px"),this.jElement.css("background-color","red")}function Indicator(a,b,c,d){ContainerArea.call(this,a,b,c,d),this.type="Indicator",this.jElement.addClass("indicator"),this.statusIndicator=new _StatusIndicator(this,this.id,this.name,this.description),this.label=new _Label(this,this.id,this.name,this.description)}function Form(a,b,c,d,e){Area.call(this,a,b,c,d),this.jForm=$("<Form/>").appendTo(this.jElement),this.widgetList=[],this.submitListeners=[],this.addSubmitListener(this.submitted)}function _Button(a,b,c,d){WidgetArea.call(this,a,b,c,d),this.type="_Button",this.jElement.addClass("button"),this.jButton=$("<input/>").prop({type:"button"}).appendTo(this.jElement),this.jButton.css("cursor","pointer")}function Button(a,b,c,d,e,f){ContainerArea.call(this,a,b,c,d),this.type="Button","undefined"!=typeof f&&(this.image=$('<img class="buttonImage">').appendTo(this.jElement),this.image.attr("src",f)),this.button=new _Button(this,uniId++,this.name,this.description),this.setText(e),this.clickListeners=[],this.addClickListener(this.button.getJElement(),this.clicked),this.disabled=!1}function SubmitButton(a,b,c,d,e,f){Button.call(this,a,b,c,d,e,f),this.setType("submit")}function Progressbar(a,b,c,d,e,f){Area.call(this,a,b,c,d),this.jElement.addClass("progressbar-container"),this.progressIndicator=$("<div class='progressbar-progress container'></div>").appendTo(this.jElement)}function NavButton(a,b,c,d,e,f){ContainerArea.call(this,a,b,c,d),this.jElement.addClass("button"),"undefined"!=typeof f&&(this.image=$('<img class="buttonImage">').appendTo(this.jElement),this.image.attr("src",f)),this.label=new _Label(this,this.id,this.name,this.description),this.label.getJElement().addClass("nav-button"),this.label.setWidth("110px"),this.setText(e),this.clickListeners=[],this.addClickListener(this.jElement,this.clicked)}function Overlay(a,b,c,d,e){Area.call(this,a,b,c,d),this.jElement.addClass("overlay-background")}function OverlayDisplay(a,b,c,d,e){this.overlay=new Overlay(a,b,c,d,e),ContainerArea.call(this,this.overlay,b,c,d),this.jElement.addClass("overlay-display")}function Tabular(a,b,c,d){this.parent=a,this.id=b,this.name=c,this.description=d,this.widgetList=[]}function Table(a,b,c,d){Tabular.call(this,a,b,c,d),this.jElement=$('<table class="area"></table>').appendTo(this.parent.getJElement())}function TableRow(a,b,c,d){Tabular.call(this,a,b,c,d),this.jElement=$("<tr></tr>").appendTo(this.parent.getJElement()),this.jElement.addClass("table-row")}function TableField(a,b,c,d){Tabular.call(this,a,b,c,d),this.jElement=$("<td></td>").appendTo(this.parent.getJElement()),this.text="",this.clickListeners=[],this.addClickListener(this.jElement,this.clicked)}function UiHandler(a,b,c,d){this.area=b,this.navArea=c,this.resizer=d,this.hiddenElements=[],this.hiddenNavigationHoverArea=null,this.hiddenNavigation=[],this.body=a,this.uiOLInt=0,this.uiOverlays={},this.uiInstInt=0,this.uiConnections={},this.viewID=0,this.viewList={},this.btnID=0,this.btnList={},this.btnAssign={}}function UiConnector(a,b,c,d,e){this.id=a,this.interval=d,this.widget=b,this.form=e,this.formAction=void 0,this.setUpWidgetListners(this),this.fValue=c,this.setDisabled(!0),this.active=!1,this.setInterval()}function EIGERStatus(a,b,c,d,e,f){ContainerArea.call(this,a,b,c,d),this.ui=e,this.ui.sset=this,this.eUi=f,this.type="StatusWidget",this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h2"),this.ttl01.setText("EIGER Module Status"),this.addNewLine(),this.det=this.addWidget(SVGImage,[]),this.det.setHeight(600),this.det.setWidth(800),this.btn01=this.addWidget(Button,["show"]),this.btn01.click(this.test,this),this.module1=new EIGERSVGModule(this.det,0,"Module_00","Module 1234",0,0,.05),this.module2=new EIGERSVGModule(this.det,0,"Module_00","Module 1234",0,130,.05),this.module3=new EIGERSVGModule(this.det,0,"Module_00","Module 1234",242,14,.05),this.module4=new EIGERSVGModule(this.det,0,"Module_00","Module 1234",242,144,.05)}function EIGERConSet(a,b,c,d,e,f){ContainerArea.call(this,a,b,c,d),this.ui=e,this.ui.cset=this,this.eUi=f,this.type="ConnectionWidget",this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h2"),this.ttl01.setText("Connect to your EIGER Detector"),this.addNewLine(),this.frm01=this.addWidget(Form,[]),this.inp01=this.frm01.addWidget(Input,[]),this.inp01.setTitle("Address"),this.inp01.setValue(document.domain),this.btn01=this.frm01.addWidget(Button,["..."]),this.btn01.click(this.showAdvSetting,this),this.inp02=this.frm01.addWidget(Input,[]),this.inp02.setTitle("Port"),this.inp02.setValue("80"),this.inp02.setVisibility(!1),this.btn02=this.frm01.addWidget(SubmitButton,["connect"]),this.frm01.submit(this.connect,this)}function EIGERAcqSet(a,b,c,d,e,f){ContainerArea.call(this,a,b,c,d),this.ui=e,this.ui.acq=this,this.eUi=f,this.type="Acquisition Settings",this.advWidgets=[],this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h4"),this.ttl01.setText("Commands"),this.addAdvWidget(this.ttl01),this.addAdvWidget(this.addNewLine()),this.btn01=this.addWidget(Button,["Initialize"]),this.btn01.click(this.init,this),this.addAdvWidget(this.btn01),this.btn02=this.addWidget(Button,["Disarm"]),this.btn02.click(this.disarm,this),this.addAdvWidget(this.btn02),this.btn03=this.addWidget(Button,["Abort"]),this.btn03.click(this.abort,this),this.addAdvWidget(this.btn03),this.btn04=this.addWidget(Button,["Check State"]),this.btn04.click(this.checkState,this),this.addAdvWidget(this.btn04),this.btn05=this.addWidget(Button,["Custom Queue"]),this.btn05.click(this.customQ,this),this.addAdvWidget(this.btn05),this.addAdvWidget(this.addNewLine()),this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h4"),this.ttl01.setText("Settings"),this.frm01=this.addWidget(Form,[]),this.inp01=this.frm01.addWidget(Input,[]),this.inp01.setTitle("Photon Energy [eV]"),this.addAdvWidget(this.inp01),this.inp02=this.frm01.addWidget(Input,[]),this.inp02.setTitle("Threshold Energy [eV]"),this.addAdvWidget(this.inp02),this.sel01=this.frm01.addWidget(Select,[]),this.sel01.setTitle("Elements"),this.frm01.addNewLine(),this.inp03=this.frm01.addWidget(Input,[]),this.inp03.setTitle("Count Time"),this.inp04=this.frm01.addWidget(Input,[]),this.inp04.setTitle("Frame Time"),this.inp05=this.frm01.addWidget(Input,[]),this.inp05.setTitle("Number of Images"),this.frm01.addNewLine(),this.chk01=this.frm01.addWidget(CheckBox,[]),this.chk01.setTitle("Apply Flatfield Correction"),this.addAdvWidget(this.chk01),this.chk02=this.frm01.addWidget(CheckBox,[]),this.chk02.setTitle("Apply Countrate Correction"),this.addAdvWidget(this.chk02),this.addAdvWidget(this.frm01.addNewLine()),this.inp06=this.frm01.addWidget(Input,[]),this.inp06.setTitle("Number of Triggers"),this.addAdvWidget(this.inp06),this.sel02=this.frm01.addWidget(Select,[]),this.sel02.setTitle("Trigger Mode"),this.addAdvWidget(this.sel02),this.addAdvWidget(this.frm01.addNewLine()),this.inp07=this.frm01.addWidget(Input,[]),this.inp07.setTitle("Name Pattern"),this.addAdvWidget(this.inp07),this.inp08=this.frm01.addWidget(Input,[]),this.inp08.setTitle("NImages per Data File"),this.addAdvWidget(this.inp08),this.sel03=this.frm01.addWidget(Select,[]),this.sel03.setTitle("FileWriter Mode"),this.addAdvWidget(this.sel03),this.frm01.addNewLine(),this.frm01.addNewLine(),this.chk04=this.frm01.addWidget(CheckBox,[]),this.chk04.setTitle("Expert Mode"),this.chk04.setDisabled(!0),this.chk05=this.frm01.addWidget(CheckBox,[]),this.chk05.setTitle("Execute Commands Manually"),this.addAdvWidget(this.chk05),this.setAdvModeElVisibility(!1);var g=this;this.chk04.jInput.change(function(a){g.toggleAdvanced.apply(g,[])}),this.btn06=this.frm01.addWidget(SubmitButton,["Acquire"]),this.btn06.setDisabled(!0),this.frm01.submit(this.acquire,this)}function EIGERConvenienceFunctions(a,b,c){switch(this.ui=a,this.eUi=b,this.cmp01=new EIGERSubseqCmdPrompt(this.ui.body,0,"EHC","EIGER Command Handler",this.eUi,{success:[this.success,this,[]],error:[this.error,this,[]]}),this.cmp01.setCloseDone(!1),this.cmd01=this.cmp01.addCmdLog(),c){case"initialize":this.cmd01.addCmd(this.eUi.e.detector.command.initialize,["Put","",!0]),this.cmd01.setCmdHeight("35px"),this.cmd01.exec();break;case"disarm":this.cmd01.addCmd(this.eUi.e.detector.command.disarm,["Put","",!0]),this.cmd01.setCmdHeight("35px"),this.cmd01.exec();break;case"abort":this.cmd01.addCmd(this.eUi.e.detector.command.abort,["Put","",!0]),this.cmd01.setCmdHeight("35px"),this.cmd01.exec();break;case"checkstate":this.cmp01.setTitle("Checking status and error keys of the detector..."),this.eUi.e.isVersionOrHigher(1,6,0)?this.cmd01.addCmd(this.eUi.e.detector.command.status_update,["Put","",!0]):confirm("The detector will have to be reinitialized (JAUN Version 1.5.0 and older) in order to get the current state. Would you like to initialize the detector now?")&&this.cmd01.addCmd(this.eUi.e.detector.command.initialize,["Put","",!0]),this.cmd01.addCmd(this.eUi.e.detector.status.state,["GET","",!0]),this.cmd01.addCmd(this.eUi.e.detector.status.error,["Get","",!0]),this.cmd01.addCmd(this.eUi.e.filewriter.status.state,["GET","",!0]),this.cmd01.addCmd(this.eUi.e.filewriter.status.error,["GET","",!0]);var d=4;this.eUi.e.monitor&&(this.cmd01.addCmd(this.eUi.e.monitor.status.state,["GET","",!0]),this.cmd01.addCmd(this.eUi.e.monitor.status.error,["GET","",!0]),d+=2),this.eUi.e.stream&&(this.cmd01.addCmd(this.eUi.e.stream.status.state,["GET","",!0]),this.cmd01.addCmd(this.eUi.e.monitor.status.error,["GET","",!0]),d+=2),this.cmd01.setCmdHeight(sprintf("%spx",32*d)),this.cmd01.exec()}}function EIGERExp(a,b,c,d){this.ui=a,this.ui.exp=this,this.eUi=b;var e=this.getView("Exposure");switch(this.switchView(e),this.cmd01=e.addWidget(EIGERSubseqCmdHandler,[this.eUi,{success:[this.success,this,[]],error:[this.error,this,[]]}]),c){case"expose":this.cmd01.addCmd(this.eUi.e.detector.command.arm,["Put","",!0]),this.cmd01.addCmd(this.eUi.e.detector.command.trigger,["Put","",!0]),this.cmd01.addCmd(this.eUi.e.detector.command.disarm,["Put","",!0]),this.endView="Data";break;case"advExpose":d?(execStyle1=this.cmd01.EXEC_CLICK,execStyle2=this.cmd01.EXEC_ICLICK):(execStyle1=this.cmd01.EXEC_IMMED,execStyle2=this.cmd01.EXEC_IMMED);var f=this.eUi.e.detector.config.trigger_mode.value.value,g=this.eUi.e.detector.config.ntrigger.value.value;if(console.log(sprintf("Starting %s series with %s triggers...",f,g)),this.cmd01.addCmd(this.eUi.e.detector.command.arm,["Put","",!0]),"ints"===f.toLowerCase())for(var h=0;h<g;h++)this.cmd01.addCmd(this.eUi.e.detector.command.trigger,["Put","",!0],execStyle1);else if("inte"===f.toLowerCase())for(var h=0;h<g;h++)this.cmd01.addCmd(this.eUi.e.detector.command.trigger,["Put","",!0],this.cmd01.EXEC_VCLICK);this.cmd01.addCmd(this.eUi.e.detector.command.disarm,["Put","",!0],execStyle2,this.cmd01.ENDING_COMMAND),this.endView="Data"}this.cmd01.exec(this.cmd01)}function EIGERData(a,b,c,d,e,f){ContainerArea.call(this,a,b,c,d),this.ui=e,this.eUi=f,this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h2"),this.ttl01.setText("EIGER Data"),this.addNewLine(),this.btn01=this.addWidget(Button,["refresh"]);var g=this;this.btn01.click(function(){g.cmp01=new EIGERSubseqCmdPrompt(g.ui.body,0,"EHC","EIGER Command Handler",g.eUi,{success:[function(){},g,[]],error:[function(){},this,[]]}),g.cmp01.setCloseDone(!0),g.cmd01=g.cmp01.addCmdLog(),g.cmd01.addCmd(g.eUi.e.filewriter.files,["GET",""]),g.cmd01.setCmdHeight("35px"),g.cmd01.exec()}),this.addNewLine(),this.lgh01=this.addWidget(EIGERDataLogger,[this.eUi])}function EIGERAcq(a,b,c,d,e,f){ContainerArea.call(this,a,b,c,d),this.ui=e,this.eUi=f,this.type="AcquireSettings",this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h4"),this.ttl01.setText("Acquisition")}function EIGERLog(a,b,c,d,e,f){ContainerArea.call(this,a,b,c,d),this.ui=e,this.ui.log=this,this.eUi=f,this.type="ConnectionWidget";var g=this;this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h2"),this.ttl01.setText("EIGER Logs and Command Overview"),this.addNewLine(),this.chk01=this.addWidget(CheckBox,[]),this.chk01.setTitle("Enable Command Log"),this.chk01.jInput.change(function(a){g.chk01.getValue()?g.activateLog.apply(g,[]):g.disableLog.apply(g,[])}),this.lbl01=this.addWidget(Label,[]),this.addNewLine(),this.ttl02=this.addWidget(Title,[]),this.ttl02.setLvl("h4"),this.ttl02.setText("Overview"),this.addNewLine(this),this.ttl02.lbl01=this.addWidget(Label,[]),this.ttl02.lbl01.setText("Active Commands:"),this.ttl02.lbl02=this.addWidget(Label,[]),this.ttl02.lbl02.setText("n/a"),this.ttl02.lbl02.setWidth("50px"),this.uic01=e.uiConnect(this.ttl02.lbl02,function(){return Object.keys(g.eUi.eHandler.activeQueries).length},500),this.ttl02.lbl03=this.addWidget(Label,[]),this.ttl02.lbl03.setText("History:"),this.ttl02.lbl04=this.addWidget(Label,[]),this.ttl02.lbl04.setText("n/a"),this.ttl02.lbl04.setWidth("50px"),this.uic02=e.uiConnect(this.ttl02.lbl04,function(){return g.eUi.eHandler.history},500),this.addNewLine(),this.ttl03=this.addWidget(Title,[]),this.ttl03.setLvl("h4"),this.ttl03.setText("Active Commands"),this.addNewLine(),this.lgh01=this.addWidget(EIGERCmdLogger,[this.eUi])}function EIGERHelp(a,b,c,d,e,f){ContainerArea.call(this,a,b,c,d),this.ui=e,this.eUi=f,this.type="AcquireSettings",this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h2"),this.ttl01.setText("Support"),this.addNewLine(),this.ext01=this.addWidget(Extendable,[]),this.ext01.setTitle("Support"),this.ext01.toggle(),this.ext01.containerArea.getJElement().append($('<p>We want to be your partner and find solutions for your needs. <br> \t\t\t\t\t\t\t\tWe can support you with our broad technical expertise and application know-how.<br><br> \t\t\t\t\t\t\t\tQuestions and inquiries - please contact us:<br><br> \t\t\t\t\t\t\t\tE-mail<br> \t\t\t\t\t\t\t\t<a href="mailto:support@dectris.com">support@dectris.com</a><br><br> \t\t\t\t\t\t\t\tHomepage<br> \t\t\t\t\t\t\t\t<a href="http://www.dectris.com" target="_blank">www.dectris.com</a><br><br> \t\t\t\t\t\t\t\tTelephone<br> \t\t\t\t\t\t\t\t+41 56 500 21 02</p> ')),this.addNewLine(),this.ttl02=this.addWidget(Title,[]),this.ttl02.setLvl("h2"),this.ttl02.setText("Help"),this.addNewLine(),this.ext02=this.addWidget(Extendable,[]),this.ext02.setTitle("Connect"),this.ext02.img01=this.ext02.addContent(Image,[]),this.ext02.img01.setSrc("im/help/Connect.jpeg"),this.ext02.img01.setWidth("600px"),this.ext02.containerArea.getJElement().append($("<p>1. Please enter the detectors address (name or IP).<br>The port is configured to be 80 when the input is left empty <br> \t\t\t\t\t\t\t2. Click on the connect button to set up the client.</p> ")),this.addNewLine(),this.ext03=this.addWidget(Extendable,[]),this.ext03.setTitle("Settings"),this.ext03.img01=this.ext03.addContent(Image,[]),this.ext03.img01.setSrc("im/help/Settings.jpeg"),this.ext03.img01.setWidth("600px"),this.ext03.containerArea.getJElement().append($("<p>1. Please adapt the settings to your needs. <br> \t\t\t\t\t\t\t2. Click on the acquire button to record a (series) of image(s).</p> ")),this.ext03.img01=this.ext03.addContent(Image,[]),this.ext03.img01.setSrc("im/help/ExpertMode.jpeg"),this.ext03.img01.setWidth("600px"),this.ext03.containerArea.getJElement().append($("<p>Advanced users might chose to use the advanced mode. Please only use this mode if you are an expert.</p> ")),this.addNewLine(),this.ext04=this.addWidget(Extendable,[]),this.ext04.setTitle("Data Downloader"),this.ext04.img01=this.ext04.addContent(Image,[]),this.ext04.img01.setSrc("im/help/Download.jpeg"),this.ext04.img01.setWidth("600px"),this.ext04.containerArea.getJElement().append($('<p>1. By clicking the download button you will start downloading a file. <br>Always make sure to download the master and the data file.<br> \t\t\t\t\t\t\t2. Clicking the "x" button will delete the resource on the DCU. You will be asked to confirm.</p> '))}function EIGERDataLogger(a,b,c,d,e){BlockArea.call(this,a,b,c,d),this.eUi=e,this.table=this.addWidget(Table,[]),this.table.setWidth("865px"),this.setHeight("320px"),this.jElement.css("overflow-y","scroll"),this.jElement.css("overflow-x","hidden"),this.ids=0,this.rows={};for(var f in this.eUi.eHandler.activeQueries)this.newQItem(this.eUi.eHandler.activeQueries[f]);this.eUi.uiConnect(this,this.eUi.e.filewriter.files,2)}function EIGERCmdLogger(a,b,c,d,e){BlockArea.call(this,a,b,c,d),this.eUi=e,this.table=this.addWidget(Table,[]),this.table.setWidth("865px"),this.setHeight("320px"),this.jElement.css("overflow-y","scroll"),this.jElement.css("overflow-x","hidden"),this.rows={}}function EIGERCmdDisplay(a,b,c,d,e){EIGERCmdLogger.call(this,a,b,c,d,e)}function EIGERCustomCmdPrompt(a,b,c,d,e){OverlayDisplay.call(this,a,b,c,d),this.eUi=e,this.closeDone=!1,this.jElement.css("cursor","default"),this.tlt01=this.addWidget(Title,[]),this.tlt01.setLvl("h3"),this.eUi.ui.resizer.resizeOffset(this.setOffset,this,"top",["mid",-200],0),this.eUi.ui.resizer.resizeOffset(this.setOffset,this,"left",["mid",-445],0),this.eUi.ui.resizer.trigger(),this.tlt01.setText("Custom Command Queue Builder"),this.addNewLine();var f=this;this.ext01=this.addWidget(Extendable,[]),this.ext01.setTitle("Add or Append to Queue from File"),this.frm01=this.ext01.addContent(Form,[]),this.frm01.submit(this.append,this),this.fin01=this.frm01.addWidget(FileInput,[]),this.fin01.setTitle("Select file to upload..."),this.btn01=this.frm01.addWidget(SubmitButton,["Append to Queue"]),this.addNewLine(),this.ext02=this.addWidget(Extendable,[]),this.ext02.setTitle("Append to Queue manually"),this.ext02.toggle(),this.frm02=this.ext02.addContent(Form,[]),this.frm02.submit(this.submit,this),this.sel01=this.frm02.addWidget(Select,[]),this.sel01.setTitle("Method"),this.sel01.setWidth("80px"),this.sel01.addOptions(["GET","PUT","DELETE"]),this.sel01.jInput.change(function(a){f.changeMethod.apply(f,[a])}),this.sel02=this.frm02.addWidget(Select,[]),this.sel02.setTitle("Module"),this.sel02.setWidth("80px"),this.addOptions(this.sel02,this.eUi.e.children),this.sel02.jInput.change(function(a){f.changeModule.apply(f,[a])}),this.sel03=this.frm02.addWidget(Select,[]),this.sel03.setTitle("Task"),this.sel03.setWidth("87px"),this.sel03.jInput.change(function(a){f.changeTask.apply(f,[a])}),this.sel03.setDisabled(!0),this.sel04=this.frm02.addWidget(Select,[]),this.sel04.setTitle("Key"),this.sel04.setWidth("247px"),this.sel04.jInput.change(function(a){f.changeKey.apply(f,[a])}),this.sel04.setDisabled(!0),this.vaa01=this.frm02.addWidget(ContainerArea,[]),this.vaa01.setWidth("150px"),this.frm02.addNewLine(),this.lbl01=this.frm02.addWidget(Label,[]),this.lbl01.setWidth("500px"),this.lbl01.setText(" "),this.chk01=this.frm02.addWidget(CheckBox,[]),this.chk01.setWidth("150px"),this.chk01.setTitle("Execute manually"),this.btn02=this.frm02.addWidget(SubmitButton,["Add To Queue"]),this.btn02.setDisabled(!0),this.addNewLine(),this.cmd01=this.addWidget(EIGERSubseqCmdHandler,[this.eUi,{success:[this._done,this,[]],error:[this._fail,this,[]]}]),this.cmd01.setCmdHeight("100px"),this.cmd01.btn01.setDisabled(!0),this.addNewLine(),this.chk02=this.addWidget(CheckBox,[]),this.chk02.setTitle("Close when finished"),this.chk02.jInput.change(function(){f.closeDone=f.chk02.getValue()}),this.btn03=this.addWidget(Button,["Execute"]),this.btn03.click(this.startQ,this),this.btn03.setDisabled(!0),this.btn04=this.addWidget(Button,["Save Queue to file"]),this.btn04.click(this.save,this),this.btn04.setDisabled(!0),this.btn05=this.addWidget(Button,["Close"]),this.btn05.click(this.close,this)}function EIGERCmdInformation(a,b,c,d,e){OverlayDisplay.call(this,a,b,c,d),this.eUi=e,this.qInstance=void 0,this.reqPayload=!1,this.resPayload=!1;var f=this;this.jElement.css("cursor","default"),this.jElement.css("max-height","600px"),this.jElement.css("overflow-y","scroll"),this.jElement.css("overflow-x","hidden"),this.addClickListener(this.getJElement(),function(){}),this.eUi.ui.resizer.resizeOffset(this.setOffset,this,"top",["mid",-300],0),this.eUi.ui.resizer.resizeOffset(this.setOffset,this,"left",["mid",-445],0),this.eUi.ui.resizer.trigger(),this.img01=this.addWidget(Image,[]),this.img01.setSrc("im/wait.gif"),this.img01.setWidth("24px"),this.img01.getJElement().css("vertical-align","top"),this.tlt01=this.addWidget(Title,[]),this.tlt01.setLvl("h3"),this.tlt01.setText("Command Information"),this.addNewLine(),this.lbl01=this.addWidget(Label,[]),this.lbl01.setText("Request URI"),this.addNewLine(),this.table=this.addWidget(Table,[]),this.table.setWidth("700px"),this.tbr01=this.table.addWidget(TableRow,[]),this.tbr01.tfd01=this.tbr01.addWidget(TableField),this.tbr01.tfd01.setWidth("120px"),this.tbr01.tlt02=this.tbr01.tfd01.addWidget(Title,[]),this.tbr01.tlt02.setLvl("h3"),this.tbr01.tlt02.setText("Request"),this.tbr01.tfd02=this.tbr01.addWidget(TableField),this.tbr01.tfd02.setWidth("230px"),this.tbr01.tfd03=this.tbr01.addWidget(TableField),this.tbr01.tfd03.setWidth("120px"),this.tbr01.tlt03=this.tbr01.tfd03.addWidget(Title,[]),this.tbr01.tlt03.setLvl("h3"),this.tbr01.tlt03.setText("Response"),this.tbr01.tfd04=this.tbr01.addWidget(TableField),this.tbr01.tfd04.setWidth("230px"),this.tbr02=this.table.addWidget(TableRow,[]),this.tbr02.setHeight("22px"),this.tbr02.tfd01=this.tbr02.addWidget(TableField),this.tbr02.tfd01.setText("Address"),this.tbr02.tfd02=this.tbr02.addWidget(TableField),this.tbr02.tfd02.setText("DCU_Addr"),this.tbr02.tfd03=this.tbr02.addWidget(TableField),this.tbr02.tfd03.setText("Code"),this.tbr02.tfd04=this.tbr02.addWidget(TableField),this.tbr02.tfd04.setText("RESPONSE_CODE"),this.tbr03=this.table.addWidget(TableRow,[]),this.tbr03.setHeight("22px"),this.tbr03.tfd01=this.tbr03.addWidget(TableField),this.tbr03.tfd01.setText("Port"),this.tbr03.tfd02=this.tbr03.addWidget(TableField),this.tbr03.tfd02.setText("DCU_Port"),this.tbr03.tfd03=this.tbr03.addWidget(TableField),this.tbr03.tfd03.setText("Status"),this.tbr03.tfd04=this.tbr03.addWidget(TableField),this.tbr03.tfd04.setText("RESPONSE_Status"),this.tbr04=this.table.addWidget(TableRow,[]),this.tbr04.setHeight("22px"),this.tbr04.tfd01=this.tbr04.addWidget(TableField),this.tbr04.tfd01.setText("Module"),this.tbr04.tfd02=this.tbr04.addWidget(TableField),this.tbr04.tfd02.setText("Module"),this.tbr05=this.table.addWidget(TableRow,[]),this.tbr05.setHeight("22px"),this.tbr05.tfd01=this.tbr05.addWidget(TableField),this.tbr05.tfd01.setText("API Version"),this.tbr05.tfd02=this.tbr05.addWidget(TableField),this.tbr05.tfd02.setText("DCU_APIVER"),this.tbr06=this.table.addWidget(TableRow,[]),this.tbr06.setHeight("22px"),this.tbr06.tfd01=this.tbr06.addWidget(TableField),this.tbr06.tfd01.setText("Task"),this.tbr06.tfd02=this.tbr06.addWidget(TableField),this.tbr06.tfd02.setText("Task"),this.tbr07=this.table.addWidget(TableRow,[]),this.tbr07.setHeight("22px"),this.tbr07.tfd01=this.tbr07.addWidget(TableField),this.tbr07.tfd01.setText("Key"),this.tbr07.tfd02=this.tbr07.addWidget(TableField),this.tbr07.tfd02.setText("Key"),this.tbr08=this.table.addWidget(TableRow,[]),this.tbr08.tfd01=this.tbr08.addWidget(TableField),this.tbr08.tfd01.setText("Payload"),this.tbr08.tfd02=this.tbr08.addWidget(TableField),this.tbr08.tfd02.lbl01=this.tbr08.tfd02.addWidget(Label,[]),this.tbr08.tfd02.lbl01.setWidth("210px"),this.tbr08.tfd02.lbl01.getJElement().css("overflow-x","hidden"),this.tbr08.tfd02.lbl01.getJElement().css("overflow-y","hidden"),this.tbr08.tfd02.lbl01.getJElement().css("vertical-align","top"),this.tbr08.tfd02.lbl01.setText("RESPONSE_Payload"),this.tbr08.tfd02.img01=this.tbr08.tfd02.addWidget(Image,[]),this.tbr08.tfd02.img01.getJElement().css("vertical-align","top"),this.tbr08.tfd02.img01.setSrc("im/expand.png"),this.tbr08.tfd02.img01.setWidth("12px"),this.tbr08.tfd02.click(function(){f.toggleReqPayload.apply(f,[])}),this.tbr08.tfd03=this.tbr08.addWidget(TableField),this.tbr08.tfd03.setText("Payload"),this.tbr08.tfd04=this.tbr08.addWidget(TableField),this.tbr08.tfd04.lbl01=this.tbr08.tfd04.addWidget(Label,[]),this.tbr08.tfd04.lbl01.setWidth("210px"),this.tbr08.tfd04.lbl01.getJElement().css("overflow-x","hidden"),this.tbr08.tfd04.lbl01.getJElement().css("overflow-y","hidden"),this.tbr08.tfd04.lbl01.getJElement().css("vertical-align","top"),this.tbr08.tfd04.lbl01.setText("RESPONSE_Payload"),this.tbr08.tfd04.img01=this.tbr08.tfd04.addWidget(Image,[]),this.tbr08.tfd04.img01.getJElement().css("vertical-align","top"),this.tbr08.tfd04.img01.setSrc("im/expand.png"),this.tbr08.tfd04.img01.setWidth("12px"),this.tbr08.tfd04.click(function(){f.toggleResPayload.apply(f,[])}),this.pre01=this.addWidget(Pre,[]),this.pre01.setWidth("700px"),this.pre01.addClickListener(this.pre01.getJElement(),function(){}),this.tbl02=this.addWidget(Table,[]),this.tbl02.setWidth("700px"),this.tbr09=this.tbl02.addWidget(TableRow,[]),this.tbr09.tfd01=this.tbr09.addWidget(TableField),this.tbr09.tfd01.setWidth("120px"),this.tbr09.tlt02=this.tbr09.tfd01.addWidget(Title,[]),this.tbr09.tlt02.setLvl("h3"),this.tbr09.tlt02.setText("Meta"),this.tbr09.tfd02=this.tbr09.addWidget(TableField),this.tbr09.tfd02.setWidth("230px"),this.tbr09.tfd03=this.tbr09.addWidget(TableField),this.tbr09.tfd03.setWidth("120px"),this.tbr09.tfd04=this.tbr09.addWidget(TableField),this.tbr09.tfd04.setWidth("230px"),this.tbr10=this.tbl02.addWidget(TableRow,[]),this.tbr10.tfd01=this.tbr10.addWidget(TableField),this.tbr10.tfd01.setText("Start Time"),this.tbr10.tfd02=this.tbr10.addWidget(TableField),this.tbr10.tfd02.setText("REQ_Time"),this.tbr10.tfd03=this.tbr10.addWidget(TableField),this.tbr10.tfd03.setText("Done Time"),this.tbr10.tfd04=this.tbr10.addWidget(TableField),this.tbr10.tfd04.setText("RESPONSE_Time"),this.tbr11=this.tbl02.addWidget(TableRow,[]),this.tbr11.tfd01=this.tbr11.addWidget(TableField),this.tbr11.tfd01.setText("Duration"),this.tbr11.tfd02=this.tbr11.addWidget(TableField),this.tbr11.tfd02.setText("REQ_Duration"),this.addNewLine(),this.chk01=this.addWidget(CheckBox,[]),this.chk01.setTitle("Update automatically"),this.enableAutoUpdate(),this.chk01.getJElement().change(function(){f.chk01.getValue()?f.enableAutoUpdate.apply(f,[]):f.disableAutoUpdate.apply(f,[])}),this.btn01=this.addWidget(Button,["Close"]),this.btn01.click(this.remove,this),this.setClickClose(!0)}function EIGERSubseqCmdPrompt(a,b,c,d,e,f){OverlayDisplay.call(this,a,b,c,d),this.eUi=e,this.closeDone=!0,this.callback=f,this.img01=this.addWidget(Image,[]),this.img01.setSrc("im/wait.gif"),this.img01.setWidth("24px"),this.img01.getJElement().css("vertical-align","top"),this.tlt01=this.addWidget(Title,[]),
this.tlt01.setLvl("h3"),this.eUi.ui.resizer.resizeOffset(this.setOffset,this,"top",["mid",-200],0),this.eUi.ui.resizer.resizeOffset(this.setOffset,this,"left",["mid",-445],0),this.eUi.ui.resizer.trigger(),this.cmdLogList=[],this.cmdLogCallback=[],this.cmdLogId=0}function EIGERSubseqCmdHandler(a,b,c,d,e,f){BlockArea.call(this,a,b,c,d),this.listOfQueues=[],this.callbackList=f,this.eUi=e,this.status=0,this.statusText="",this.tblContainer=this.addWidget(BlockArea,a,b,c,d),this.tblContainer.jElement.css("overflow-x","hidden"),this.setHeight("400px"),this.table=this.tblContainer.addWidget(Table,[]),this.table.setWidth("865px"),this.btn01=this.addWidget(Button,["Cancel"]),this.btn01.click(this.cancel,this),this.rows={},this.eUi.addQueryStatusListener(this.updateQItem,this.newQItem,this),this.mQIter=0,this.eIter=0}function EIGERTableRow(a,b,c,d){TableRow.call(this,a,b,c,d),this.tfd01=this.addWidget(TableField,[]),this.tfd01.setText("ID"),this.tfd01.setWidth("40px"),this.tfd02=this.addWidget(TableField,[]),this.tfd02.setText("Path : Key"),this.tfd02.setWidth("640px"),this.tfd03=this.addWidget(TableField,[]),this.tfd03.setWidth("110px"),this.tfd03.ind01=this.tfd03.addWidget(Indicator,[]),this.tfd03.ind01.setText("Status"),this.tfd03.ind01.setWidth("100px"),this.tfd04=this.addWidget(TableField,[]),this.tfd04.setText("Error"),this.tfd04.setWidth("70px")}function EIGERTableMCRow(a,b,c,d){TableRow.call(this,a,b,c,d),this.tfd01=this.addWidget(TableField,[]),this.tfd01.setText("ID"),this.tfd01.setWidth("40px"),this.tfd02=this.addWidget(TableField,[]),this.tfd02.setWidth("640px"),this.tfd02.prb01=this.tfd02.addWidget(Progressbar,[]),this.tfd02.prb01.setProgress(0),this.tfd03=this.addWidget(TableField,[]),this.tfd03.setText("Status"),this.tfd03.setWidth("100px"),this.tfd04=this.addWidget(TableField,[]),this.tfd04.setText("Error"),this.tfd04.setWidth("70px")}function EIGERDataTableRow(a,b,c,d){EIGERTableRow.call(this,a,b,c,d),this.tfd02.setWidth("590px"),this.tfd03.setWidth("120px"),this.tfd03.ind01.setWidth("80px"),this.tfd04.setWidth("110px")}function EIGERUiHandler(a){this.ui=a,this.fu=fu++,this.uiInstInt=0,this.uiConnections={},this.listOfSyncedKeys=[],this.eHandler=new EIGERHandler,this.e=new EIGER("","",this.eHandler),this.refInterval=1e3}function EIGERUiConnector(a,b,c,d,e,f){this.eUi=a,this.id=b,this.interval=e,this.form=f,this.formAction=[],this.widget=c,this.eigerValue=d,this.setUpWidgetListners(this),this.setDisabled(!0)}function SVGElement(a,b,c,d){this.parent=a,this.id=b,this.name=c,this.description=d,this.svgNS=this.parent.getSVG().namespaceURI}function SVGGroup(a,b,c,d){SVGElement.call(this,a,b,c,d),this.type="group",this.svgElementList=[],this.element=document.createElementNS(this.svgNS,"g"),this.parent.getSVG().appendChild(this.element),this.paths=[]}function SVGObject(a,b,c,d){SVGElement.call(this,a,b,c,d)}function SVGPath(a,b,c,d,e){SVGObject.call(this,a,b,c,d),this.type="path",this.element=document.createElementNS(this.svgNS,"path"),this.element.setAttribute("id",b),this.element.setAttribute("d",e),this.parent.getSVG().appendChild(this.element)}function EIGERSVGModule(a,b,c,d,e,f,g){SVGGroup.call(this,a,b,c,d),this.xOffset=e,this.yOffset=f,this.setAttr("transform",sprintf("matrix(%f,0,0,%f,%f,%f)",g,g,e,f)),this.mcbs=[];var h=this.addSVGObject(EIGERSVGMCB,[0,0]);h.setSVGPathsAttr("fill","none"),h.setSVGPathsAttr("stroke","#000000"),h.setSVGPathsAttr("stroke-width","15px"),this.sensor=this.addSVGObject(EIGERSVGBack,[0,0]),this.sensor.setSVGPathsAttr("fill","none"),this.sensor.setSVGPathsAttr("stroke","#aaaaaa"),this.sensor.setSVGPathsAttr("stroke-width","10px"),h=this.addSVGObject(EIGERSVGMCB,[0,732]),h.setSVGPathsAttr("fill","none"),h.setSVGPathsAttr("stroke","#000000"),h.setSVGPathsAttr("stroke-width","15px"),this.mcbs.push(h),this.sensor=this.addSVGObject(EIGERSVGFront,[0,0]),this.sensor.setSVGPathsAttr("fill","none"),this.sensor.setSVGPathsAttr("stroke","#aaaaaa"),this.sensor.setSVGPathsAttr("stroke-width","10px"),chipOffsets=[[0,0],[1190,65],[2380,130],[3570,195],[0,1255],[1190,1320],[2380,1385],[3570,1450]],this.rocs=[],chipOffsets.forEach(function(a,b,c){var d=this.addSVGObject(EIGERSVGChip,[a[0],a[1]]);d.setSVGPathsAttr("fill","none"),d.setSVGPathsAttr("stroke","#aaaaaa"),d.setSVGPathsAttr("stroke-width","10px"),this.rocs.push(d)},this),this.sensor=this.addSVGObject(EIGERSVGSensor,[0,0]),this.sensor.setSVGPathsAttr("fill","#ffffff"),this.sensor.setSVGPathsAttr("stroke","#000000"),this.sensor.setSVGPathsAttr("stroke-width","15px"),this.sensor.setSVGPathsAttr("fill-opacity",".6"),console.log(this.sensor);this.sensor.paths[0].element.onclick=function(){alert("hi")}}function EIGERSVGSensor(a,b,c,d,e,f){SVGGroup.call(this,a,b,c,d),this.xOffset=e,this.yOffset=f,this.setAttr("transform",sprintf("matrix(%f,0,0,%f,%f,%f)",1,1,e,f));var g=["m1523,4394 l5,-2445 l4765,260 l0,0 l0,2445 z"];this.addSVGPaths(g)}function EIGERSVGChip(a,b,c,d,e,f){SVGGroup.call(this,a,b,c,d),this.xOffset=e,this.yOffset=f,this.setAttr("transform",sprintf("matrix(%f,0,0,%f,%f,%f)",1,1,e,f));var g=["m 1533,1915 l 0,1255 l 1190,65 l 0,-1250 z","m 1542,1900 l 0,1255 l 1190,65 l 0,-1250 z"];this.addSVGPaths(g)}function EIGERSVGFront(a,b,c,d,e,f){SVGGroup.call(this,a,b,c,d),this.xOffset=e,this.yOffset=f,this.setAttr("transform",sprintf("matrix(%f,0,0,%f,%f,%f)",1,1,e,f));var g=["m 6440,4620 l 0,-2580 l -4780,-265 l 5,2580 z","m 6440,4620 l -115,85 l 0,-130 l 20,-10 l 0,-165 l -20,15 l -5,-2010 l 20,-20 l 0,-160 l -20,20 l 0,-125 l 120,-80","m 1661.8051,4355.9366 l -115,85 l 0,-130 l 20,-10 l 0,-165 l -20,15 l -5,-2010 l 20,-20 l 0,-160 l -20,20 l 0,-125 l 120,-80","m 1540,1980 l 4780,265","m 1541,2141 l 4780,265","m 1559,2121 l 4780,265","m 1547,4313 l 4780,265","m 1545,4154 l 4780,265","m 1565,4298 l 4780,265","m 1544,4441 l 4780,265","m 1541,1857 l 4780,265"];this.addSVGPaths(g)}function EIGERSVGBack(a,b,c,d,e,f){SVGGroup.call(this,a,b,c,d),this.xOffset=e,this.yOffset=f,this.setAttr("transform",sprintf("matrix(%f,0,0,%f,%f,%f)",1,1,e,f));var g=["m 2180,3250 0,-440 -229.0765,-15.4815 c -95,-5 -148,65 -148,135 l 0,155 c 3,90 58,140 138,150 z","m 1771,2878 95,-63","m 2180,3250 85,-60 0,-75 2065,-1360","m 2265,3190 -60,-10 0,-75 60,10","m 2264,3113 157,-103 c 60,-45 58,-312 1,-272 l -153,110","m 2204,3104 157,-103 c 60,-45 58,-312 1,-272 l -153,110","m 2180,2810 1846,-1226 415,23 339,-227 -445,-25 -1960,1300 30,8","m 2270,2845 -60,-5 0,-55 60,5 z","m 2205,3180 195,-121","m 2399,3056 1.2658,-390.9011 -30,-10 -160,165 0,60 z","m 6248,3539 c 95,5 148,-65 148,-135 l 0,-155 c -3,-90 -58,-140 -138,-150 L 1860,2855 c -95,-5 -148,65 -148,135 l 0,155 c 3,90 58,140 138,150 z","m 6105,3023 0,440 229,15 c 95,5 148,-65 148,-135 l 0,-155 c -3,-90 -58,-140 -138,-150 z","m 6197,3326 157,-103 c 60,-45 58,-312 1,-273 l -153,110","m 6251,3333 157,-103 c 60,-45 58,-312 1,-273 l -153,110","m 6100,3460 95,-55 0,-80 60,5 0,80 -60,-5","m 6105,3025 90,-60 65,5 0,95 -62,-7 -3,-93","m 6260,2970 195,-125 0,435 -200,130","m 6455,2845 25,0 155,170 0,120 -155,147 -25,-2","m 6480,2845 1960,-1300 40,35 0,365 -2000,1335","m 6635,3015 1930,-1275 0,115 -1930,1280","m 8480,1945 85,-90","m 8565,1740 -85,-160","m 8440,1545 -455,-30 0,440 445,25","m 4780,1780 -450,-25 -195,-145 0,-75 155,-150 45,-30","m 4290,1390 0,330","m 2210,2880 1925,-1270","m 4135,1535 -1925,1285","m 4660,1460 2080,100 -140,100 c -34,32 29,34 80,40 l 820,40 c 54,0 123,17 160,0 l 325,-225","m 4780,1780 -221,163 C 4530,1970 4480,1990 4520,2000 l 860,60 c 40,5 107,9 160,-20 l 165,-127 2113,145","m 4660,1460 0,410","m 4780,1780 0,-400","m 7985,1955 -165,100 0,-425"];this.addSVGPaths(g)}function EIGERSVGMCB(a,b,c,d,e,f){SVGGroup.call(this,a,b,c,d),this.xOffset=e,this.yOffset=f,this.setAttr("transform",sprintf("matrix(%f,0,0,%f,%f,%f)",1,1,e,f));var g=["m 2233.6927,2665.4629 70,-50 -60,-3 1940,-1292 330,20 200,-125 3190,175 -185,125 325,20 -1940,1290 -60,-5 -75,50 -1475,-80 70,-50 -790,-40 -70,45 z","m 2232.5389,2785.3466 70,-50 -60,-3 1940,-1292 330,20 200,-125 3189.9998,175 -185,125 325,20 -1939.9998,1290 -60,-5 -75,50 -1475,-80 70,-50 -790,-40 -70,45 z","m 4488,2793 0,120","m 4565,2741 0,120","m 3773,2705 0,120","m 3702,2743 0,120","m 2231,2668 0,120","m 2305,2615 0,120","m 2246,2612 0,120","m 4184,1320 0,120","m 4512,1338 0,120","m 4714,1217 0,120","m 7718,1518 0,120","m 7907,1389 0,120","m 8045,1537 0,120","m 6101,2827 0,120","m 6045,2821 0,120","m 5966,2872 0,120"];this.addSVGPaths(g)}AreaResizer.prototype={resizeOffset:function(a,b,c,d,e){this.offsetList.push([a,b,c,d,e])},resized:function(a,b){for(var c=0;c<this.offsetList.length;c++)if("abs"===this.offsetList[c][3][0]){var d="top"===this.offsetList[c][2]?"height":"width",e=b[d]+this.offsetList[c][3][1];e=e>this.offsetList[c][4]?e:this.offsetList[c][4];var f={};f[this.offsetList[c][2]]=e,this.offsetList[c][0].apply(this.offsetList[c][1],[f])}else if("mid"===this.offsetList[c][3][0]){var d="top"===this.offsetList[c][2]?"height":"width",e=b[d]/2+this.offsetList[c][3][1];e=e>this.offsetList[c][4]?e:this.offsetList[c][4];var f={};f[this.offsetList[c][2]]=e,this.offsetList[c][0].apply(this.offsetList[c][1],[f])}},addResizeListener:function(a){var b=this;$(window).resize(function(c){a.apply(b,[c,{width:$(window).width(),height:$(window).height()}])})},trigger:function(){this.resized("",{width:$(window).width(),height:$(window).height()})}},LineBreak.prototype={getJElement:function(){return this.jElement},setVisibility:function(a){a?this.getJElement().show():this.getJElement().hide()}},Area.prototype={getParent:function(){return this.parent()},getId:function(){return this.id},getName:function(){return this.name},getDescription:function(){return this.description},getJElement:function(){return this.jElement},fadeIn:function(a){this.jElement.fadeIn(a)},fadeOut:function(a){this.jElement.fadeOut(a)},addClickListener:function(a,b){var c=this;$(a).click(function(a){a.stopPropagation(),b&&b.apply(c,[a])})},removeClickListener:function(a){$(a).unbind("click")},click:function(a,b){return this.clickListeners.push([a,b])-1},unbindClick:function(a){return delete this.clickListeners[a]},clicked:function(a){if(!this.disabled)for(var b in this.clickListeners)this.clickListeners[b][0].apply(this.clickListeners[b][1],[a])},addHoverListener:function(a,b,c){var d=this;$(a).mouseenter(function(a){a.stopPropagation(),b&&b.apply(d,[a])}),$(a).mouseleave(function(a){a.stopPropagation(),c&&c.apply(d,[a])})},removeHoverListeners:function(a){$(a).unbind("mouseenter"),$(a).unbind("mouseleave")},setWidth:function(a){this.getJElement().width(a)},setHeight:function(a){this.getJElement().height(a)},setVisibility:function(a){a?this.getJElement().show():this.getJElement().hide()},remove:function(){this.getJElement().remove()}},BodyArea.prototype={},PlacementArea.prototype={setWidth:function(a){this.getJElement().width(a)},setHeight:function(a){this.getJElement().height(a)},setOffset:function(a){this.getJElement().offset(a)}},BlockArea.prototype={addWidget:function(a){defaultArgs=[this,uniId++,arguments[0].type,"ToDo"];var b=construct(arguments[0],defaultArgs.concat(arguments[1]));return this.widgetList.push(b),b},addNewLine:function(){var a=new LineBreak;return a.getJElement().appendTo(this.jElement),a}},ViewArea.prototype={setVisibility:function(a){a?(this.getJElement().show(),this.active=!0,this.activate()):(this.getJElement().hide(),this.active&&(this.active=!1,this.leave()))},activate:function(){},leave:function(){}},WidgetArea.prototype={},ContainerArea.prototype={addWidget:function(a){defaultArgs=[this,uniId++,arguments[0].type,"ToDo"];var b=construct(arguments[0],defaultArgs.concat(arguments[1]));return this.widgetList.push(b),b},addNewLine:function(){var a=new LineBreak;return a.getJElement().appendTo(this.jElement),a}},Pre.prototype={setWidth:function(a){this.getJElement().width(a);var b=a.length-2,c=a.substr(0,b);this.jPre.width(sprintf("%spx",parseInt(c)-25))},setHeight:function(a){this.getJElement().height(a);var b=a.length-2,c=a.substr(0,b);this.jPre.height(sprintf("%spx",parseInt(c)-30))},html:function(a){this.jPre.html.apply(this.jPre,arguments)},empty:function(a){this.jPre.empty.apply(this.jPre,arguments)}},Input.prototype={setWidth:function(a){this.getJElement().width(a),this.label.setWidth(a);var b=a.length-2,c=a.substr(0,b);this.jInput.width(sprintf("%spx",parseInt(c)-12))},setValue:function(a){this.jInput.val(a)},getValue:function(){return this.jInput.val()},setDisabled:function(a){this.jInput.prop("disabled",a)},getDisabled:function(){this.jInput.prop("disabled")},setTitle:function(a){this.label.setText.apply(this.label,arguments)},getTitle:function(a){this.label.getText.apply(this.label,arguments)}},FileInput.prototype={getFile:function(){return this.jInput.get(0).files[0]}},CheckBox.prototype={setValue:function(a){this.jInput.prop("checked",a)},getValue:function(){return this.jInput.prop("checked")},setDisabled:function(a){this.jInput.prop("disabled",a)},getDisabled:function(){this.jInput.prop("disabled")},setTitle:function(a){this.label.setText.apply(this.label,arguments)},getTitle:function(a){this.label.getText.apply(this.label,arguments)}},Select.prototype={addOptions:function(a){for(var b=a.length,c=0;c<b;c++)this.length++,this.jInput.append($("<option>",{value:a[c],text:a[c]}))},empty:function(a){this.jInput.empty(arguments)},setValue:function(a){this.jInput.val(a)},getValue:function(){return this.jInput.val()},setDisabled:function(a){this.jInput.prop("disabled",a)},getDisabled:function(){this.jInput.prop("disabled")},setTitle:function(a){this.label.setText.apply(this.label,arguments)},getTitle:function(a){this.label.getText.apply(this.label,arguments)}},Extendable.prototype={toggle:function(){(this.expanded=!this.expanded)?(this.containerArea.getJElement().slideDown(300),this._img01.setSrc("im/collapse.png")):(this.containerArea.getJElement().slideUp(300),this._img01.setSrc("im/expand.png"))},addContent:function(a){return this.containerArea.addWidget.apply(this.containerArea,arguments)},setTitle:function(a){this.tlt01.setText.apply(this.tlt01,arguments)}},_Label.prototype={setText:function(a){this.getJElement().text(a)},getText:function(){return this.getJElement().text()}},Label.prototype={setText:function(a){this.label.setText.apply(this.label,arguments)},getText:function(a){return this.label.getText.apply(this.label,arguments)},setWidth:function(a){this.getJElement().width(a),this.label.setWidth(a)}},_Title.prototype={setLvl:function(a){if(!($.inArray(a,["h1","h2","h3","h4","h5"])>-1))throw"Illegal Title Level";this.lvl=a,this.jTitle.detach(),this.jTitle=$(sprintf("<%s></%s>",a,a)).appendTo(this.jElement),this.jTitle.text(this.text)},getLvl:function(){return this.lvl},setText:function(a){this.text=a,this.jTitle.text(a)},getText:function(){return this.text}},Title.prototype={setLvl:function(a){this.title.setLvl.apply(this.title,arguments)},getLvl:function(a){this.title.getLvl.apply(this.title,arguments)},setText:function(a){this.title.setText.apply(this.title,arguments)},getText:function(a){this.title.getText.apply(this.title,arguments)}},SVGImage.prototype={setWidth:function(a){this.image.setWidth.apply(this.image,arguments)},setHeight:function(a){this.image.setHeight.apply(this.image,arguments)},getSVG:function(){return this.image.svgImage}},_SVGImage.prototype={setWidth:function(a){this.svgImage.setAttribute("width",a)},setHeight:function(a){this.svgImage.setAttribute("height",a)}},Image.prototype={setSrc:function(a){this.image.setSrc.apply(this.image,arguments)},setWidth:function(a){this.image.setWidth.apply(this.image,arguments)}},_Image.prototype={setSrc:function(a){this.jImage.attr({src:a})}},_StatusIndicator.prototype={error:function(){this.getJElement().css("background-color","red")},ok:function(){this.getJElement().css("background-color","green")},warning:function(){this.getJElement().css("background-color","yellow")},grey:function(){this.getJElement().css("background-color","grey")}},Indicator.prototype={error:function(a){this.statusIndicator.error.apply(this.statusIndicator,arguments)},ok:function(a){this.statusIndicator.ok.apply(this.statusIndicator,arguments)},warning:function(a){this.statusIndicator.warning.apply(this.statusIndicator,arguments)},grey:function(a){this.statusIndicator.grey.apply(this.statusIndicator,arguments)},setText:function(a){this.label.setText.apply(this.label,arguments)},setWidth:function(a){this.getJElement().width(a);var b=a.length-2,c=a.substr(0,b);this.label.setWidth(sprintf("%spx",parseInt(c)-20))}},Form.prototype={submit:function(a,b){this.submitListeners.push([a,b])},clearSubmit:function(){this.submitListeners=[]},getSubmit:function(){return this.submitListeners},submitted:function(a){if(!this.disabled)for(var b=0;b<this.submitListeners.length;b++)this.submitListeners[b][0].apply(this.submitListeners[b][1],[a])},addSubmitListener:function(a){var b=this;this.jForm.submit(function(c){return c.preventDefault(),a&&a.apply(b,[c]),!1})},setSubmitListeners:function(a){this.submitListeners=a},addWidget:function(a){defaultArgs=[this,uniId++,arguments[0].type,"ToDo"];var b=construct(arguments[0],defaultArgs.concat(arguments[1]));return this.widgetList.push(b),b},addNewLine:function(){var a=new LineBreak;return a.getJElement().appendTo(this.jForm),a},getJElement:function(){return this.jForm}},_Button.prototype={setText:function(a){this.text=a,this.jButton.val(a)},getText:function(){return this.val()},setType:function(a){this.jButton.prop({type:a})},setDisabled:function(a){a?this.jButton.css("cursor","not-allowed"):this.jButton.css("cursor","pointer"),this.jButton.prop("disabled",a)}},Button.prototype={setText:function(a){this.button.setText.apply(this.button,arguments)},getText:function(a){this.button.getText.apply(this.button,arguments)},setType:function(a){this.button.setType.apply(this.button,arguments)},setDisabled:function(a){a?(this.disabled=a,this.button.setDisabled(!0)):(this.disabled=a,this.button.setDisabled(!1))}},SubmitButton.prototype={},Progressbar.prototype={setProgress:function(a){this.progressIndicator.css("width",sprintf("%s%%",Math.round(100*a)))}},NavButton.prototype={setText:function(a){this.label.setText.apply(this.label,arguments)},getText:function(a){this.label.getText.apply(this.label,arguments)}},Overlay.prototype={clickClose:function(a){this.remove()},setClickClose:function(a){a?this.addClickListener(this.jElement,this.clickClose):this.removeClickListener(this.jElement)},remove:function(){this.jElement.remove()}},OverlayDisplay.prototype={setClickClose:function(a){this.overlay.setClickClose.apply(this.overlay,arguments)},remove:function(a){this.overlay.remove.apply(this.overlay,arguments)},setOffset:function(a){this.getJElement().offset(a)}},extend(Area,BodyArea),extend(Area,BlockArea),extend(BlockArea,ViewArea),extend(Area,WidgetArea),extend(Area,ContainerArea),extend(Area,PlacementArea),extend(Area,Progressbar),extend(Area,Overlay),extend(WidgetArea,_Button),extend(WidgetArea,_Label),extend(WidgetArea,_Title),extend(WidgetArea,_SVGImage),extend(WidgetArea,_Image),extend(WidgetArea,_StatusIndicator),extend(ContainerArea,Form),extend(ContainerArea,Label),extend(ContainerArea,CheckBox),extend(ContainerArea,Extendable),extend(ContainerArea,Title),extend(ContainerArea,SVGImage),extend(ContainerArea,Image),extend(ContainerArea,Pre),extend(ContainerArea,Input),extend(Input,FileInput),extend(ContainerArea,Select),extend(ContainerArea,Indicator),extend(ContainerArea,Button),extend(Button,SubmitButton),extend(ContainerArea,NavButton),extend(ContainerArea,OverlayDisplay),Tabular.prototype={getParent:function(){return this.parent()},getId:function(){return this.id},getName:function(){return this.name},getDescription:function(){return this.description},getJElement:function(){return this.jElement},addClickListener:function(a,b){var c=this;$(a).click(function(a){a.stopPropagation(),b&&b.apply(c,[a])})},removeClickListener:function(a){$(a).unbind("click")},click:function(a,b){return this.clickListeners.push([a,b])-1},unbindClick:function(a){return delete this.clickListeners[a]},clicked:function(a){if(!this.disabled)for(var b in this.clickListeners)this.clickListeners[b][0].apply(this.clickListeners[b][1],[a])},addHoverListener:function(a,b,c){var d=this;$(a).mouseenter(function(a){a.stopPropagation(),b&&b.apply(d,[a])}),$(a).mouseleave(function(a){a.stopPropagation(),c&&c.apply(d,[a])})},setWidth:function(a){this.getJElement().width(a)},setHeight:function(a){this.getJElement().height(a)},setVisibility:function(a){a?this.getJElement().show():this.getJElement().hide()},addWidget:function(a){defaultArgs=[this,uniId++,arguments[0].type,"ToDo"];var b=construct(arguments[0],defaultArgs.concat(arguments[1]));return this.widgetList.push(b),b}},Table.prototype={},TableRow.prototype={},TableField.prototype={setWidth:function(a){this.getJElement().width(a),this.getJElement().css({"max-width":a})},setText:function(a){this.text=a,this.getJElement().text(a)},setTitle:function(a){this.getJElement().attr("title",a)},getText:function(){return this.text},addWidget:function(a){defaultArgs=[this,uniId++,arguments[0].type,"ToDo"];var b=construct(arguments[0],defaultArgs.concat(arguments[1]));return this.widgetList.push(b),b},addNewLine:function(){var a=new LineBreak;return a.getJElement().appendTo(this.jElement),a}},extend(Tabular,Table),extend(Tabular,TableRow),extend(Tabular,TableField),UiHandler.prototype={addHiddenHomeNavigation:function(a){this.hiddenNavigation.push(a),a.setVisibility(!1)},hideHomeNavigation:function(){for(var a in this.hiddenNavigation)this.hiddenNavigation[a].getJElement().delay(2e3).fadeOut(500)},showHomeNavigation:function(){for(var a in this.hiddenNavigation)this.hiddenNavigation[a].getJElement().fadeIn(200)},enableHomeNavigationHover:function(a){var b=this;this.hiddenNavigationHoverArea=a,a.addHoverListener(a.getJElement(),function(a){b.showHomeNavigation.apply(b,[])},function(a){b.hideHomeNavigation.apply(b,[])})},addHiddenHomeWidget:function(a){this.hiddenElements.push(a),a.setVisibility(!1)},hideHiddenHomeWidgets:function(){for(var a in this.hiddenElements)this.hiddenElements[a].setVisibility(!1)},showHiddenHomeWidgets:function(){for(var a in this.hiddenElements)this.hiddenElements[a].setVisibility(!0);for(var a in this.hiddenNavigation)this.hiddenNavigation[a].setVisibility(!0);this.hiddenNavigationHoverArea.removeHoverListeners(this.hiddenNavigationHoverArea.getJElement())},showOverlay:function(){var a=this.uiOLInt++,b=new Overlay(this.body,a,"Overlay","Overlay");return this.uiOverlays[a]=b,b},showOverlayDisp:function(){var a=this.uiOLInt++,b=new OverlayDisplay(this.body,a,"Overlay","Overlay");return this.uiOverlays[a]=b,b},uiConnect:function(a,b,c,d){var e=this.uiInstInt++,f=new UiConnector(e,a,b,c,d);return this.uiConnections[e]=f,f},addView:function(a){var b=this.viewID++;defaultArgs=[this.area,b];var c=construct(arguments[0],defaultArgs.concat(arguments[1]));return 0==Object.keys(this.viewList).length?c.setVisibility(!0):c.setVisibility(!1),this.viewList[b]=c,c},addNavButton:function(a,b,c){var d=this.btnID++;void 0===b&&(b=this.area),void 0===c&&(c=NavButton);var e=construct(c,[b,d,a.name,a.describtion,a.name]);return e.click(this.selectView,this),this.btnList[d]=e,this.btnAssign[d]=a,e},selectView:function(a){for(var b in this.btnList)if(this.btnList[b].jElement.has(a.target).length){this.activateView(this.btnAssign[this.btnList[b].id]);break}},activateView:function(a){for(var b in this.viewList)this.viewList[b].id!==a.id&&this.viewList[b].setVisibility(!1);a.setVisibility(!0)}},UiConnector.prototype={setId:function(a){this.id=a},setDisabled:function(a){"function"==typeof this.widget.setDisabled&&this.widget.setDisabled(this.widget,a)},sync:function(){"Label"===this.widget.type||"_Label"===this.widget.type?this.widget.setText(this.fValue()):"Input"===this.widget.type?this.widget.setValue(this.fValue()):"Indicator"===this.widget.type&&this.widget.setText(this.fValue())},iFunction:function(){if(this.interval>0&&!this.active){var a=this;return this.active=!0,window.setInterval(function(){a.sync.apply(a,[])},this.interval)}return this.sync(),this.iInst},setUpWidgetListners:function(){"Label"===this.widget.type||"_Label"===this.widget.type||"Input"===this.widget.type},clearInterval:function(){window.clearInterval(this.iInst),this.active=!1},setInterval:function(){this.iInst=this.iFunction()}};var clientVersion="1.4.0T3",uniId=0;$(document).ready(function(){var a=new BodyArea(uniId++),b=new AreaResizer,c=new PlacementArea(a,uniId++,"xx","xx");c.setWidth("900px"),c.setHeight("223px"),c.setOffset({top:"10",left:"10"}),b.resizeOffset(c.setOffset,c,"left",["mid",-457],-7);var d=new PlacementArea(a,uniId++,"xx","xx");d.setWidth("173px"),d.setHeight("40px"),d.setOffset({top:"3",left:"30"}),b.resizeOffset(d.setOffset,d,"left",["mid",-437],13);var e=new PlacementArea(a,uniId++,"xx","xx");e.setWidth("440px"),e.setHeight("40px"),e.setOffset({top:"3",left:"470"}),b.resizeOffset(e.setOffset,e,"left",["mid",3],453);var f=new PlacementArea(a,uniId++,"xx","xx");f.setWidth("900px"),f.setHeight("270px"),f.setOffset({top:"0",left:"18"}),f.jElement.addClass("header-area"),b.resizeOffset(f.setOffset,f,"left",["mid",-449],1);var g=new PlacementArea(a,uniId++,"xx","xx");g.setWidth("130px"),g.setHeight("50px"),g.setOffset({top:"205",left:"780"}),b.resizeOffset(g.setOffset,g,"left",["mid",317],767);var h=new PlacementArea(a,uniId++,"xx","xx");h.setWidth("900px"),h.setHeight("30px"),h.setOffset({top:"235",left:"25"}),b.resizeOffset(h.setOffset,h,"left",["mid",-442],8);var i=new PlacementArea(a,uniId++,"xx","xx");i.setWidth("300px"),i.setHeight("100px"),i.setOffset({top:"600",left:"600"}),b.resizeOffset(i.setOffset,i,"left",["mid",133],583),b.resizeOffset(i.setOffset,i,"top",["abs",-100],390);var j=new PlacementArea(a,uniId++,"xx","xx");j.setWidth("295px"),j.setHeight("7px"),j.setOffset({top:"800",left:"605"}),j.getJElement().addClass("dectris-background"),b.resizeOffset(j.setOffset,j,"left",["mid",138],588),b.resizeOffset(j.setOffset,j,"top",["abs",-7],390);var k=new PlacementArea(a,uniId++,"xx","xx");k.jElement.addClass("main-area"),k.setWidth("900px"),k.setOffset({top:"290",left:"18"}),b.resizeOffset(k.setOffset,k,"left",["mid",-449],1),b.trigger();var l=new BlockArea(c,uniId++,"xx","xx"),m=l.addWidget(Image,[]);m.setSrc("im/Banner_BRUENIG_WEBCLIENT.jpg"),m.setWidth("900px");var n=new BlockArea(d,uniId++,"xx","xx"),o=n.addWidget(Image,[]);o.setSrc("im/dectris_logo_1x.jpg"),o.setWidth("173px");var p=new BlockArea(e,uniId++,"xx","xx"),q=p.addWidget(Image,[]);q.setSrc("im/dectris_claim.png"),q.setWidth("440px");var r=new BlockArea(i,uniId++,"xx","xx"),s=r.addWidget(Label,[]);s.getJElement().addClass("dectris"),s.getJElement().html("<b>DECTRIS Ltd.</b><br>5400 Baden<br>Switzerland<br><b>www.dectris.com<b>");var t=new BlockArea(g,uniId++,"xx","xx"),u=new UiHandler(a,k,y,b),v=new EIGERUiHandler(u),w=t.addWidget(Label,[]);w.setText("No S/N Found"),w.setWidth("100px"),v.uiConnect(w,v.e.detector.config.detector_number,10),t.addNewLine();var x=t.addWidget(Indicator,[]);x.setText("Not Connected"),x.setWidth("120px"),v.uiConnect(x,v.e.detector.status.state,.2),u.addHiddenHomeWidget(t);var y=new BlockArea(h,1,"xx","xx"),z=u.addView(ViewArea,"Home","Detector Settings"),A=u.addView(ViewArea,"Acquire","Aquisition Settings"),B=u.addView(ViewArea,"Exposure","Exposure Information"),C=u.addView(ViewArea,"Data","Data Information"),D=u.addView(ViewArea,"Log","Logs and Information"),E=u.addView(ViewArea,"Help & Support","Information about DECTRIS Ltd. support and help."),F=u.addNavButton(z,y),G=u.addNavButton(A,y),H=u.addNavButton(B,y),I=u.addNavButton(C,y),J=u.addNavButton(D,y),K=u.addNavButton(E,y);u.addHiddenHomeNavigation(F),u.addHiddenHomeWidget(G),u.addHiddenHomeWidget(H),u.addHiddenHomeWidget(I),u.addHiddenHomeWidget(J),u.addHiddenHomeNavigation(K);var P=(z.addWidget(EIGERConSet,[u,v]),A.addWidget(EIGERAcqSet,[u,v]),B.addWidget(EIGERAcq,[u,v]),C.addWidget(EIGERData,[u,v]),D.addWidget(EIGERLog,[u,v]));E.addWidget(EIGERHelp,[u,v]);D.activate=function(){P.activateLog()},D.leave=function(){P.disableLog()},C.activate=function(){v.e.filewriter.files.update()};var R=new BlockArea(k,uniId++,"xx","xx"),S=R.addWidget(Label,[]);S.getJElement().addClass("main-footer"),S.setText(sprintf("EIGER Quick Start Client, %s, Copyright: DECTRIS Ltd., Author: Andy Moesch",clientVersion)),u.addHiddenHomeWidget(R),u.enableHomeNavigationHover(h)}),EIGERStatus.prototype={test:function(){console.log(this.module1),this.module1.rocs[0].setSVGPathsAttr("stroke","#00ff00")}},EIGERConSet.prototype={showAdvSetting:function(a){this.btn01.setVisibility(!1),this.inp02.setVisibility(!0)},connect:function(a){this.eUi.connect(this.inp01.getValue(),this.inp02.getValue())},disconnect:function(a){alert("Not Implemented!")}},EIGERAcqSet.prototype={connect:function(){this.eUi.uiConnect(this.inp01,this.eUi.e.detector.config.photon_energy,1,this.frm01),this.eUi.uiConnect(this.inp02,this.eUi.e.detector.config.threshold_energy,1,this.frm01),this.eUi.uiConnect(this.sel01,this.eUi.e.detector.config.element,1,this.frm01),this.eUi.uiConnect(this.inp03,this.eUi.e.detector.config.count_time,1,this.frm01),this.eUi.uiConnect(this.inp04,this.eUi.e.detector.config.frame_time,1,this.frm01),this.eUi.uiConnect(this.inp05,this.eUi.e.detector.config.nimages,1,this.frm01),this.eUi.uiConnect(this.chk01,this.eUi.e.detector.config.flatfield_correction_applied,1,this.frm01),this.eUi.uiConnect(this.chk02,this.eUi.e.detector.config.countrate_correction_applied,1,this.frm01),this.eUi.uiConnect(this.inp06,this.eUi.e.detector.config.ntrigger,1,this.frm01),this.eUi.uiConnect(this.sel02,this.eUi.e.detector.config.trigger_mode,1,this.frm01),this.eUi.uiConnect(this.inp07,this.eUi.e.filewriter.config.name_pattern,1,this.frm01),this.eUi.uiConnect(this.inp08,this.eUi.e.filewriter.config.nimages_per_file,1,this.frm01),this.eUi.uiConnect(this.sel03,this.eUi.e.filewriter.config.mode,1,this.frm01),this.eUi.setUpInterval(),this.btn06.setDisabled(!1)},acquire:function(){"idle"!==this.eUi.e.detector.status.state.value.value?alert("Detector is not in idle state, will not start exposure.\n\nPlease disarm detector or abort exposure."):this.advMode?new EIGERExp(this.ui,this.eUi,"advExpose",this.chk05.getValue()):(this.cmp01=new EIGERSubseqCmdPrompt(this.ui.body,0,"EHC","EIGER Command Handler",this.eUi,{success:[this.expose,this,[]],error:[function(){},this,[]]}),this.cmp01.setTitle("Preparing standard user mode..."),this.cmd01=this.cmp01.addCmdLog(),this.cmd01.setCmdHeight("180px"),this.cmd01.addQObj(this.eUi.e.detector.config.ntrigger.setValue(1)),this.cmd01.addQObj(this.eUi.e.detector.config.flatfield_correction_applied.setValue(!0)),this.cmd01.addQObj(this.eUi.e.detector.config.countrate_correction_applied.setValue(!0)),this.cmd01.addQObj(this.eUi.e.detector.config.trigger_mode.setValue("ints")),this.cmd01.addQObj(this.eUi.e.filewriter.config.mode.setValue("enabled")),this.cmd01.addQObj(this.eUi.e.filewriter.config.name_pattern.setValue(sprintf("BRUENIG_%s_$id",(new Date).toISOString().slice(0,10)))))},expose:function(){new EIGERExp(this.ui,this.eUi,"expose")},toggleAdvanced:function(){this.advMode||2!==this.eUi.e.connectionStateID?this.disableAdvMode():this.enableAdvMode()},enableAdvMode:function(){this.setAdvModeElVisibility(!0)},disableAdvMode:function(){this.setAdvModeElVisibility(!1)},addAdvWidget:function(a){this.advWidgets.push(a)},setAdvModeElVisibility:function(a){this.advMode=a;for(var b in this.advWidgets)this.advWidgets[b].setVisibility(a);this.chk04.setValue(a)},init:function(){new EIGERConvenienceFunctions(this.ui,this.eUi,"initialize")},disarm:function(){new EIGERConvenienceFunctions(this.ui,this.eUi,"disarm")},abort:function(){new EIGERConvenienceFunctions(this.ui,this.eUi,"abort")},checkState:function(){new EIGERConvenienceFunctions(this.ui,this.eUi,"checkstate",!0)},customQ:function(){this.cmd01=new EIGERCustomCmdPrompt(this.ui.body,0,"EHC","EIGER Command Handler",this.eUi,{success:[this.success,this,[]],
error:[function(){},this,[]]})},cmdI:function(){this.cmd02=new EIGERCmdInformation(this.ui.body,0,"EHC","EIGER Command Handler",this.eUi)},success:function(a){this.cmd01=""}},EIGERConvenienceFunctions.prototype={success:function(a){this._success.apply(this,arguments)},error:function(a){this._error.apply(this,arguments)},_success:function(a){},_error:function(a){}},EIGERExp.prototype={getView:function(a){for(var b in this.ui.viewList)if(this.ui.viewList[b].name===a)return this.ui.viewList[b]},switchView:function(a){this.ui.activateView(a)},success:function(a){this.cmd01.remove(),dView=this.getView(this.endView),this.switchView(dView)},abortSuccess:function(a){alert(sprintf("%s\n\n%s","Failed to execute an exposure.",a.statusText)),this.switchView(this.getView("Acquire"))},error:function(a){this.cmp01=new EIGERSubseqCmdPrompt(this.ui.body,0,"EHC","EIGER Command Handler",this.eUi,{success:[this.abortSuccess,this,[]],error:[function(){},this,[]]}),this.cmp01.setTitle("Recovering detector state..."),this.cmd01=this.cmp01.addCmdLog(),this.cmd01.setCmdHeight("35px"),this.cmd01.addCmd(this.eUi.e.detector.command.abort,["PUT",""])}},EIGERData.prototype={getView:function(a){for(var b in this.ui.viewList)if(this.ui.viewList[b].name===a)return this.ui.viewList[b]},switchView:function(a){this.ui.activateView(a)}},EIGERAcq.prototype={},EIGERLog.prototype={activateLog:function(){this.chk01.setValue(!0),this.uic01.setInterval(),this.uic02.setInterval(),this.lgh01.activate();var a=this;this.iInst=window.setTimeout(function(){a.disableLog.apply(a,[])},6e4),this.lbl01.getJElement().html("Please be aware that logging will automatically be disabled<br>after 60 seconds for performance consideratons.")},disableLog:function(){this.chk01.setValue(!1),this.uic01.clearInterval(),this.ttl02.lbl02.setText("n/a"),this.uic02.clearInterval(),this.ttl02.lbl04.setText("n/a"),this.lgh01.disable(),window.clearTimeout(this.iInst),this.lbl01.getJElement().html("")}},EIGERHelp.prototype={},extend(ContainerArea,EIGERStatus),extend(ContainerArea,EIGERConSet),extend(ContainerArea,EIGERAcqSet),extend(ContainerArea,EIGERAcq),extend(ContainerArea,EIGERData),extend(ContainerArea,EIGERLog),extend(ContainerArea,EIGERHelp),EIGERDataLogger.prototype={setValue:function(a){var b=[];for(var c in this.rows)a.indexOf(this.rows[c].fileName)<0&&this.updateQItem(c,"deleted"),b.push(this.rows[c].fileName);for(var d in a)b.indexOf(a[d])<0&&this.newQItem(a[d])},updateQItem:function(a,b){switch(b){case"new":this.rows[a].tfd03.ind01.setText("new"),this.rows[a].tfd03.ind01.ok();break;case"downloaded":this.rows[a].tfd03.ind01.setText("downloaded"),this.rows[a].tfd03.ind01.grey();break;case"deleted":this.rows[a].tfd03.ind01.setText("deleted"),this.rows[a].tfd03.ind01.error();var c=this;this.rows[a].getJElement().delay(1e3).slideUp(200,function(){c.rows[a].getJElement().remove(),delete c.rows[a]});break;case"deleting":this.rows[a].tfd03.ind01.setText("deleting"),this.rows[a].tfd03.ind01.warning()}this.rows[a].status=b},newQItem:function(a){var b=this.ids++;this.rows[b]=this.table.addWidget(EIGERDataTableRow,[]),this.rows[b].fileName=a,this.rows[b].tfd01.setText(b),this.rows[b].tfd02.setText(a),this.rows[b].tfd04.setText("");var c=this;this.rows[b].tfd04.btn01=this.rows[b].tfd04.addWidget(Button,["download"]),this.rows[b].tfd04.btn01.click(function(){c.getData(b)},this),this.rows[b].tfd04.btn02=this.rows[b].tfd04.addWidget(Button,["x"]),this.rows[b].tfd04.btn02.click(function(){c.delData(b)},this),this.updateQItem(b,"new")},getData:function(a){window.location=sprintf("http://%s:%s/data/%s",this.eUi.e.address,this.eUi.e.port,this.rows[a].fileName),this.updateQItem(a,"downloaded")},delData:function(a){if(confirm(sprintf("Do you really want to delete the file %s on the detector control unit.",this.rows[a].fileName))){var b=this;this.updateQItem(a,"deleted"),$.ajax({url:sprintf("http://%s:%s/data/%s",this.eUi.e.address,this.eUi.e.port,this.rows[a].fileName),type:"delete",contentType:"application/json",success:function(c){b.updateQItem.apply(b,[a,"deleted"])},error:function(c){alert("Could not delete file."),b.updateQItem.apply(b,[a,"new"])}})}}},EIGERCmdLogger.prototype={activate:function(){this.eUi.addQueryStatusListener(this.updateQItem,this.newQItem,this);for(var a in this.eUi.eHandler.activeQueries)this.newQItem(this.eUi.eHandler.activeQueries[a])},disable:function(){this.eUi.removeQueryStatusListener(this);for(var a in this.rows)this.rows[a].getJElement().remove(),this.rows[a]=void 0,delete this.rows[a];this.rows=[]},updateQItem:function(a){var b=a.getId(),c=this;0===a.status?(this.rows[b].tfd03.ind01.setText(a.progressText),this.rows[b].tfd03.ind01.grey()):1===a.status?(this.rows[b].tfd03.ind01.setText(a.progressText),this.rows[b].tfd03.ind01.warning()):2===a.status?(this.rows[b].tfd03.ind01.setText(a.progressText),this.rows[b].tfd03.ind01.ok(),this.rows[b].getJElement().delay(500).slideUp(100,function(){c.rows[b].getJElement().remove(),c.rows[b]=void 0,delete c.rows[b]})):a.status<0&&void 0!==this.rows[b]&&(this.rows[b].tfd03.ind01.setText(a.progressText),this.rows[b].tfd03.ind01.error(),a.response&&(this.rows[b].tfd04.setText(a.response.statusText),this.rows[b].tfd04.setTitle(a.response.statusText)),this.rows[b].getJElement().delay(500).slideUp(100,function(){c.rows[b].getJElement().remove(),c.rows[b]=void 0,delete c.rows[b],a.deleteQ()}))},newQItem:function(a){var b=a.getId();this.rows[b]=this.table.addWidget(EIGERTableRow,[]);var c=this;this.rows[b].tfd01.setText(b),this.rows[b].tfd01.click(function(){c.showCmdInformation.apply(c,[a])},this),this.rows[b].tfd02.setText(a.getText()),this.rows[b].tfd02.click(function(){c.showCmdInformation.apply(c,[a])},this),this.rows[b].tfd04.setText(""),this.updateQItem(a)},showCmdInformation:function(a){var b=new EIGERCmdInformation(this.eUi.ui.body,0,"EHC","EIGER Command Information",this.eUi);b.setQ(a)}},EIGERCmdDisplay.prototype={newQItem:function(a){var b=a.getId();this.rows[b]=this.table.addWidget(EIGERTableRow,[]),this.rows[b].tfd01.setText(b),this.rows[b].tfd02.setText(a.getText()),this.rows[b].tfd04.setText("")}},EIGERCustomCmdPrompt.prototype={_done:function(){this.closeDone&&this.close()},_fail:function(){alert("Failed to execute queue...")},addOptions:function(a,b){var c=[];for(var d in b)c.push(b[d].name);a.addOptions(c),a.setValue("")},append:function(){var a=new FileReader,b=this;a.onload=function(a){b.cmd01.importFromStr.apply(b.cmd01,[this.result])},a.readAsText(this.fin01.getFile()),this.btn03.setDisabled(!1),this.btn04.setDisabled(!1)},addValueField:function(a){var b=this.getDataType(a);try{var c=a.allowed_values.value}catch(a){}if(void 0!==c)this.val01=this.vaa01.addWidget(Select,[]),this.val01.setTitle("Value"),this.val01.addOptions(c),this.val01.setValue(a.value.value);else switch(b){case"bool":this.val01=this.vaa01.addWidget(CheckBox,[]),this.val01.setTitle("Value"),this.val01.setValue(a.value.value);break;case"int":case"uint":case"float":case"string":this.val01=this.vaa01.addWidget(Input,[]),this.val01.setTitle("Value"),this.val01.setValue(a.value.value);break;case"file":this.val01=this.vaa01.addWidget(FileInput,[]),this.val01.setTitle("Select file to upload...")}},removeValueField:function(){this.vaa01.getJElement().empty()},getValue:function(a){var b=this.getDataType(a);switch(b){case"command":var c=void 0;break;case"bool":var c=this.val01.getValue();break;case"int":case"uint":var c=filterInt(this.val01.getValue());if(isNaN(c))throw sprintf("Failed to cast '%s' to %s...",this.val01.getValue(),b);break;case"float":var c=parseFloat(this.val01.getValue());if(isNaN(c))throw sprintf("Failed to cast '%s' to %s...",this.val01.getValue(),b);break;case"file":var c=this.val01.getFile();break;default:var c=this.val01.getValue()}return c},changeModule:function(a){this.removeValueField(),this.enableAllModes(),this.btn02.setDisabled(!0),this.sel03.empty(),this.sel03.setDisabled(!1),this.sel04.empty(),this.sel04.setDisabled(!0),this.addOptions(this.sel03,this.eUi.e[this.sel02.getValue()].children)},changeTask:function(a){this.removeValueField(),this.enableAllModes(),this.btn02.setDisabled(!0),this.sel04.setDisabled(!0),this.sel04.empty(),this.eUi.e[this.sel02.getValue()][this.sel03.getValue()]instanceof EIGERSubDomain?(this.addOptions(this.sel04,this.eUi.e[this.sel02.getValue()][this.sel03.getValue()].children),this.sel04.setDisabled(!1)):this.eUi.e[this.sel02.getValue()][this.sel03.getValue()]instanceof EIGERSpecialKey&&(this.enableMode(this.eUi.e[this.sel02.getValue()][this.sel03.getValue()].access_mode.value),this.sel04.setDisabled(!0),this.btn02.setDisabled(!1))},changeKey:function(a){this.removeValueField();try{var b=this.eUi.e[this.sel02.getValue()][this.sel03.getValue()][this.sel04.getValue()];switch(this.enableMode(b.access_mode.value),this.sel01.getValue()){case"PUT":this.addValueField(b);break;case"GET":default:this.removeValueField()}this.btn02.setDisabled(!1)}catch(a){console.log(a)}},changeMethod:function(a){this.changeKey()},changeMode:function(a){this.inp01.setDisabled(!1)},close:function(a){1===this.cmd01.status?this.cmd01.cancel():this.remove()},enableAllModes:function(){var a=this.sel01.jInput.find("option");a.each(function(){$(this).prop("disabled",!1)})},enableMode:function(a){var b=this.sel01.jInput.find("option"),c=this;b.each(function(){var b=!0;if(a.search("r")>=0&&"GET"===$(this).text()&&(b=!1),a.search("w")>=0&&"PUT"===$(this).text()&&(b=!1),$(this).prop("disabled",b),b&&$(this).prop("selected")){var d=c.sel01.jInput.find("option:enabled").first();d.each(function(){c.sel01.setValue($(this).val()),c.changeMethod.apply(c,[])})}})},save:function(){var a=new Blob([this.cmd01.exportAsStr()],{type:"application/json"});saveFile(sprintf("BRUENIG_%s.json",(new Date).toISOString().slice(0,10)),a)},startQ:function(){this.btn03.setVisibility(!1),this.ext01.setVisibility(!1),this.ext02.setVisibility(!1),this.cmd01.btn01.setDisabled(!1),this.cmd01.exec()},submit:function(a){var b=this.eUi.e[this.sel02.getValue()][this.sel03.getValue()],c=b instanceof EIGERSpecialKey?b:b[this.sel04.getValue()];"PUT"===this.sel01.getValue()?this.addQObjByNames(this.sel02.getValue(),this.sel03.getValue(),this.sel04.getValue(),this.sel01.getValue(),this.getValue(c),this.chk01.getValue()):this.addQObjByNames(this.sel02.getValue(),this.sel03.getValue(),this.sel04.getValue(),this.sel01.getValue(),void 0,this.chk01.getValue()),this.btn03.setDisabled(!1),this.btn04.setDisabled(!1)},addCmd:function(a){return this.cmd01.addCmd.apply(this.cmd01,arguments)},addQObj:function(a){return this.cmd01.addQObj.apply(this.cmd01,arguments)},addQObjByNames:function(a){return this.cmd01.addQObjByNames.apply(this.cmd01,arguments)},addMCmd:function(a){return this.cmd01.addMCmd.apply(this.cmd01,arguments)},getDataType:function(a){return this.cmd01.getDataType.apply(this.cmd01,arguments)},setTitle:function(a){return this.tlt01.setText.apply(this.tlt01,arguments)},setCmdHeight:function(a){return this.cmd01.setCmdHeight.apply(this.cmd01,arguments)}},extend(OverlayDisplay,EIGERCustomCmdPrompt),EIGERCmdInformation.prototype={enableAutoUpdate:function(){this.chk01.setValue(!0),this.eUi.addQueryStatusListener(this.updateQItem,this.newQItem,this)},disableAutoUpdate:function(){this.chk01.setValue(!1),this.eUi.removeQueryStatusListener(this)},updateQItem:function(a){this.qInstance===a&&this.update()},newQItem:function(){},close:function(a){this.remove()},toggleReqPayload:function(){if(this.reqPayload)this.tbr08.tfd02.img01.setSrc("im/expand.png"),this.tbr08.tfd02.getJElement().css("border-bottom","0px"),this.pre01.getJElement().slideUp(300);else{this.resPayload&&(this.tbr08.tfd04.img01.setSrc("im/expand.png"),this.tbr08.tfd04.getJElement().css("border-bottom","0px"),this.resPayload=!this.resPayload),this.tbr08.tfd02.img01.setSrc("im/collapse.png"),this.tbr08.tfd02.getJElement().css("border-bottom","1px solid white");var a=this.tbr08.tfd02.lbl01.getText();""===a?this.pre01.html("not available"):this.pre01.html(prettyJSON(a)),this.pre01.getJElement().slideDown(300)}this.reqPayload=!this.reqPayload},toggleResPayload:function(){if(this.resPayload)this.tbr08.tfd04.img01.setSrc("im/expand.png"),this.tbr08.tfd04.getJElement().css("border-bottom","0px"),this.pre01.getJElement().slideUp(300);else{this.reqPayload&&(this.tbr08.tfd02.img01.setSrc("im/expand.png"),this.tbr08.tfd02.getJElement().css("border-bottom","0px"),this.reqPayload=!this.reqPayload),this.tbr08.tfd04.img01.setSrc("im/collapse.png"),this.tbr08.tfd04.getJElement().css("border-bottom","1px solid white");var a=this.tbr08.tfd04.lbl01.getText();""===a||"n/a"===a?this.pre01.html("not available"):this.pre01.html(prettyJSON(a)),this.pre01.getJElement().slideDown(300)}this.resPayload=!this.resPayload},setQ:function(a){if(this.qInstance=a,this.qInstance.instance.versionInURI===!0)var b=sprintf("http://%s:%s/%s/api/%s/%s/%s",this.qInstance.instance.superDet.address,this.qInstance.instance.superDet.port,this.qInstance.instance.domain.index,this.qInstance.instance.superDet.version,this.qInstance.instance.subdomain.index,this.qInstance.instance.index);else var b=sprintf("http://%s:%s/%s/api/%s/%s",this.qInstance.instance.superDet.address,this.qInstance.instance.superDet.port,this.qInstance.instance.domain.index,this.qInstance.instance.subdomain.index,this.qInstance.instance.index);this.lbl01.setText(sprintf("[%s] %s",a.method.toUpperCase(),b)),this.update()},update:function(){this.tbr02.tfd02.setText(this.qInstance.instance.superDet.address),this.tbr03.tfd02.setText(this.qInstance.instance.superDet.port),this.tbr04.tfd02.setText(this.qInstance.instance.domain.index);try{this.tbr05.tfd02.setText(this.qInstance.instance.domain.version.value.value)}catch(a){this.tbr05.tfd02.setText("not yet available...")}switch(this.tbr06.tfd02.setText(this.qInstance.instance.subdomain.index),this.tbr07.tfd02.setText(this.qInstance.instance.index),this.tbr08.tfd02.lbl01.setText(this.qInstance.data),this.tbr08.tfd02.setTitle(this.qInstance.data),this.qInstance.status){case 0:this.tbr02.tfd04.setText("n/a"),this.tbr03.tfd04.setText("Queued"),this.tbr08.tfd04.lbl01.setText("n/a"),this.tbr10.tfd02.setText("n/a"),this.tbr10.tfd04.setText("n/a"),this.tbr11.tfd02.setText("n/a");break;case 1:this.tbr02.tfd04.setText("n/a"),this.tbr03.tfd04.setText("Sent"),this.tbr08.tfd04.lbl01.setText("n/a"),this.tbr10.tfd02.setText(msToISO(this.qInstance.startTime)),this.tbr10.tfd04.setText("n/a"),this.tbr11.tfd02.setText("n/a");break;case 2:this.disableAutoUpdate(),this.img01.remove(),this.chk01.setDisabled(!0),this.tbr02.tfd04.setText(this.qInstance.request.status),this.tbr03.tfd04.setText(this.qInstance.request.statusText),this.tbr08.tfd04.lbl01.setText(JSON.stringify(this.qInstance.request.response)),this.tbr08.tfd04.setTitle(JSON.stringify(this.qInstance.request.response)),this.tbr10.tfd02.setText(msToISO(this.qInstance.startTime)),this.tbr10.tfd04.setText(msToISO(this.qInstance.endTime)),this.tbr11.tfd02.setText(sprintf("%s ms",this.qInstance.endTime-this.qInstance.startTime));break;default:this.disableAutoUpdate(),this.img01.remove(),this.chk01.setDisabled(!0);try{this.tbr02.tfd04.setText(this.qInstance.request.status),this.tbr03.tfd04.setText(this.qInstance.request.statusText),this.tbr03.tfd04.setTitle(this.qInstance.request.statusText),this.tbr08.tfd04.lbl01.setText(JSON.stringify(this.qInstance.request.response)),this.tbr08.tfd04.setTitle(JSON.stringify(this.qInstance.request.response))}catch(a){this.tbr02.tfd04.setText("n/a"),this.tbr03.tfd04.setText("error"),this.tbr08.tfd04.lbl01.setText("n/a")}try{this.tbr10.tfd02.setText(msToISO(this.qInstance.startTime))}catch(a){this.tbr10.tfd02.setText("n/a")}try{this.tbr10.tfd04.setText(msToISO(this.qInstance.endTime)),this.tbr11.tfd02.setText(sprintf("%s ms",this.qInstance.endTime-this.qInstance.startTime))}catch(a){this.tbr10.tfd04.setText("n/a"),this.tbr11.tfd02.setText("n/a")}}},setTitle:function(a){return this.tlt01.setText.apply(this.tlt01,arguments)}},extend(OverlayDisplay,EIGERCmdInformation),EIGERSubseqCmdPrompt.prototype={addCmdLog:function(a,b){this.addNewLine();var c=this.addWidget(EIGERSubseqCmdHandler,[this.eUi,{success:[this._step,this,[this.cmdLogId,"success"]],error:[this._step,this,[this.cmdLogId,"error"]]}]);return this.cmdLogList[this.cmdLogId]=c,this.cmdLogCallback[this.cmdLogId]=a,this.cmdLogId++,this.endAfter=void 0===b,c},addCmd:function(a){return this.cmd01.addCmd.apply(this.cmd01,arguments)},addQObj:function(a){return this.cmd01.addQObj.apply(this.cmd01,arguments)},addMCmd:function(a){return this.cmd01.addMCmd.apply(this.cmd01,arguments)},exec:function(a){return this.cmd01.exec.apply(this.cmd01,arguments)},setCloseDone:function(a){this.closeDone=a},setTitle:function(a){return this.tlt01.setText.apply(this.tlt01,arguments)},setCmdHeight:function(a){return this.cmd01.setCmdHeight.apply(this.cmd01,arguments)},_step:function(a,b,c){if(void 0!==this.cmdLogCallback[b]&&this.cmdLogCallback[b][c][0].apply(this.cmdLogCallback[b][c][1],[a].concat(this.cmdLogCallback[b][c][2])),b===this.cmdLogId-1&&this.endAfter)if(this.callback[c][0].apply(this.callback[c][1],[a].concat(this.callback[c][2])),this.closeDone)this.remove();else{var d=this,e=this.addWidget(Button,["Close"]);e.click(function(){d.remove.apply(d,[])})}}},extend(OverlayDisplay,EIGERSubseqCmdPrompt),EIGERSubseqCmdHandler.prototype={EXEC_IMMED:0,EXEC_EXT:1,EXEC_CLICK:2,EXEC_ICLICK:3,EXEC_VCLICK:4,ENDING_COMMAND:!0,NONENDING_COMMAND:!1,addCmd:function(a,b,c,d){void 0===c&&(c=this.EXEC_IMMED),this.addQObj(a.queueQuery.apply(a,b),c,d)},addQObj:function(a,b,c){this.listOfQueues.push({qObject:a,execStyle:b,endingCommand:c}),this.newQItem(a)},addMCmd:function(a,b,c){void 0===b&&(b=this.EXEC_IMMED);var d=new EIGERMQuery(this.eUi.eHandler,a,this,this.newMQItem,this.updateMQItem);d.setId(this.mQIter++),this.listOfQueues.push({qObject:d,execStyle:b,endingCommand:c}),this.newMQItem(d)},cancel:function(){confirm('Do you really want to cancel current operation, this might cause invalid states. Press "ok" to cancel.')&&(this.status=-2,this.end())},exportAsStr:function(){var a={};return this.listOfQueues.forEach(function(b,c,d){a[c]={endingCommand:b.endingCommand,execStyle:b.execStyle,acceptType:b.qObject.acceptType,data:b.qObject.data,method:b.qObject.method,mimeType:b.qObject.mimeType,processData:b.qObject.processData,apiDomain:b.qObject.instance.domain.name,apiSubDomain:b.qObject.instance.subdomain.name,apiKey:b.qObject.instance.name}},this),JSON.stringify(a)},importFromStr:function(a){var b=JSON.parse(a);for(var c in b){obj=b[c];var d="";try{d=JSON.parse(obj.data).value}catch(a){}this.addQObjByNames(obj.apiDomain,obj.apiSubDomain,obj.apiKey,obj.method,d,obj.execStyle,obj.endingCommand)}},addQObjByNames:function(a,b,c,d,e,f,g){var h=this.eUi.e[a][b],i=h instanceof EIGERSpecialKey?h:h[c],j=f?this.EXEC_CLICK:this.EXEC_IMMED;switch(d){case"GET":"file"===this.getDataType(i)?this.addQObj(i.downloadFile(!0),j,g):this.addQObj(i.updateKey(!0),j,g);break;case"PUT":try{"file"===this.getDataType(i)?this.addQObj(i.setUploadFile(e,!0),j,g):this.addQObj(i.setValue(e,!0),j,g)}catch(a){alert(sprintf("Error in parsing value.\n\n%s",a))}}},exec:function(){var a=this.eIter++;if(void 0===this.listOfQueues[a]){var b=!0;for(var c in this.listOfQueues)if(2!==this.listOfQueues[c].qObject.status){b=!1;break}b&&this.end()}else if(0===this.listOfQueues[a].qObject.status)switch(this.listOfQueues[a].execStyle){default:case this.EXEC_IMMED:this.listOfQueues[a].qObject.exec();break;case this.EXEC_CLICK:case this.EXEC_ICLICK:case this.EXEC_VCLICK:var d=this.listOfQueues[a].qObject.getId();this.rows[d].btn01.setDisabled(!1)}else this.exec()},getDataType:function(a){try{if("flatfield"===a.name||"pixel_mask"===a.name)var b="file";else var b=a.value_type.value}catch(b){if("command"===a.subdomain.index)if("trigger"===a.index)var b="float";else var b="command"}return b},end:function(){if(this.btn01.remove(),this.eUi.removeQueryStatusListener(this),this.status<0){console.log("Aborting Queue due to previous error.");for(a in this.listOfQueues)this.listOfQueues[a].qObject.deleteQ()}if(this.status<0)this.callbackList.error[0].apply(this.callbackList.error[1],[this].concat(this.callbackList.error[2]));else{for(var a in this.listOfQueues)2!==this.listOfQueues[a].qObject.status&&this.listOfQueues[a].qObject.deleteQ();this.callbackList.success[0].apply(this.callbackList.success[1],[this].concat(this.callbackList.success[2]))}for(a in this.rows)delete this.rows[a]},updateQItem:function(a){var b=this.checkQueued(a);if(b){var c=a.getId();if(0===a.status)this.rows[c].tfd03.ind01.setText(a.progressText),this.rows[c].tfd03.ind01.grey();else if(1===a.status)this.status>-1&&(this.status=1),this.rows[c].tfd03.ind01.setText(a.progressText),this.rows[c].tfd03.ind01.warning(),b.execStyle===this.EXEC_CLICK||b.execStyle===this.EXEC_ICLICK?this.rows[c].btn01.remove():b.execStyle===this.EXEC_VCLICK&&(this.rows[c].btn01.remove(),this.rows[c].inp01.remove());else if(2===a.status){if(this.rows[c].tfd03.ind01.setText(a.progressText),this.rows[c].tfd03.ind01.ok(),"GET"===a.method)try{"application/tiff"===a.acceptType?(this.rows[c].btn01=this.rows[c].tfd04.addWidget(Button,["download"]),this.rows[c].btn01.click(a.download,a)):this.rows[c].tfd04.setText(a.request.response.value)}catch(a){}b.endingCommand===this.ENDING_COMMAND?this.end():(this.status=2,this.exec())}else a.status<0&&this.status>=0&&(this.statusText=a.request.statusText,this.status=a.status,this.rows[c].tfd03.ind01.setText(a.progressText),this.rows[c].tfd03.ind01.error(),this.rows[c].tfd04.setText(this.statusText),this.rows[c].tfd04.setTitle(this.statusText),this.end())}},newQItem:function(a){var b=this.checkQueued(a);if(b){var c=a.getId();this.rows[c]=this.table.addWidget(EIGERTableRow,[]),this.rows[c].tfd01.setText(c);var d=this;this.rows[c].tfd01.click(function(){d.showCmdInformation.apply(d,[a])},this),this.rows[c].tfd02.setText(a.getText()),this.rows[c].tfd02.click(function(){d.showCmdInformation.apply(d,[a])},this),this.rows[c].tfd04.setText(""),b.execStyle===this.EXEC_CLICK||b.execStyle===this.EXEC_ICLICK?(this.rows[c].btn01=this.rows[c].tfd04.addWidget(Button,["exec"]),this.rows[c].btn01.click(a.exec,a),b.execStyle===this.EXEC_CLICK&&this.rows[c].btn01.setDisabled(!0)):b.execStyle===this.EXEC_VCLICK&&(this.rows[c].inp01=this.rows[c].tfd04.addWidget(Input,[]),this.rows[c].inp01.label.remove(),this.rows[c].inp01.nwl01.setVisibility(!1),this.rows[c].tfd04.addNewLine(),this.rows[c].btn01=this.rows[c].tfd04.addWidget(Button,["exec"]),this.rows[c].btn01.setDisabled(!0),this.rows[c].inp01.setWidth("50px"),this.rows[c].btn01.click(function(b){var e=parseFloat(d.rows[c].inp01.getValue());isNaN(e)?alert("Failed casting to float..."):(a.data=JSON.stringify({value:e}),a.exec())},a)),this.updateQItem(a)}},showCmdInformation:function(a){var b=new EIGERCmdInformation(this.eUi.ui.body,0,"EHC","EIGER Command Information",this.eUi);b.setQ(a)},updateMQItem:function(a){var b=a.getId();0===a.status?this.rows[b].tfd03.setText("queued"):1===a.status?(this.status>-1&&(this.status=1),this.rows[b].tfd03.setText(sprintf("%3.1f%%",100*a.getProgress())),this.rows[b].tfd02.prb01.setProgress(a.getProgress())):2===a.status?(this.rows[b].tfd03.setText("sucess"),this.exec()):a.status<0&&this.status>=0&&(this.rows[b].tfd02.prb01.setProgress(a.getProgress()),this.rows[b].tfd03.setText("error"),this.rows[b].tfd04.setText("An error occured."),this.rows[b].tfd04.setTitle("An error occured."),this.status=a.status,this.end())},newMQItem:function(a){var b=a.getId();this.rows[b]=this.table.addWidget(EIGERTableMCRow,[a]),this.rows[b].tfd01.setText(a.getId()),this.rows[b].tfd04.setText(""),this.updateMQItem(a)},checkQueued:function(a){for(var b in this.listOfQueues)if(this.listOfQueues[b].qObject===a)return this.listOfQueues[b];return!1},remove:function(){this.getJElement().remove()},setCmdHeight:function(a){var b=a.length-2,c=a.substr(0,b);this.getJElement().height(sprintf("%spx",parseInt(c)+30)),this.tblContainer.setHeight(a)},setHeight:function(a){this.getJElement().height(a);var b=a.length-2,c=a.substr(0,b);this.tblContainer.setHeight(sprintf("%spx",parseInt(c)-30))}},extend(BlockArea,EIGERDataLogger),extend(BlockArea,EIGERCmdLogger),extend(EIGERCmdLogger,EIGERCmdDisplay),extend(EIGERCmdLogger,EIGERSubseqCmdHandler),EIGERTableRow.prototype={},EIGERTableMCRow.prototype={},EIGERTableMCRow.prototype={},extend(TableRow,EIGERTableRow),extend(TableRow,EIGERTableMCRow),extend(EIGERTableRow,EIGERDataTableRow);var fu=0;EIGERUiHandler.prototype={_checkConnection:function(a,b,c,d){console.log(sprintf("Checking connection to %s:%s...",a,b));var e={success:[this._checkConSuccess,this,[a,b,d]],error:[this._checkConError,this,[]]};this.cmp01=new EIGERSubseqCmdPrompt(this.ui.body,0,"EHC","EIGER Command Handler",this,e),this.cmp01.setTitle(sprintf("Trying to connect to %s:%s",a,b)),this.cmd01=this.cmp01.addCmdLog({success:[this._getKeys,this,[a,b,d]],error:[this._checkConError,this,[]]},!1),this.cmd01.setCmdHeight("35px"),this.cmd01.addCmd(this.e.detector.version,["GET",""])},_getKeys:function(a,b,c,d){var e=this.e.detector.version.value.value;this.e.setVersion(e),this.updateUiConnections(),this.cmd02=this.cmp01.addCmdLog();var f=4;this.cmd02.addCmd(this.e.detector.config.keys,["GET",""]),this.cmd02.addCmd(this.e.detector.status.keys,["GET",""]),this.e.detector.command.keys&&(this.cmd02.addCmd(this.e.detector.command.keys,["GET",""]),f++),this.cmd02.addCmd(this.e.filewriter.config.keys,["GET",""]),this.cmd02.addCmd(this.e.filewriter.status.keys,["GET",""]),this.e.filewriter.command.keys&&(this.cmd02.addCmd(this.e.filewriter.command.keys,["GET",""]),f++),this.e.monitor&&(this.cmd02.addCmd(this.e.monitor.config.keys,["GET",""]),f++,this.cmd02.addCmd(this.e.monitor.status.keys,["GET",""]),f++,this.e.monitor.command.keys&&(this.cmd02.addCmd(this.e.monitor.command.keys,["GET",""]),f++)),this.e.stream&&(this.cmd02.addCmd(this.e.stream.config.keys,["GET",""]),f++,this.cmd02.addCmd(this.e.stream.status.keys,["GET",""]),f++,this.e.stream.command.keys&&(this.cmd02.addCmd(this.e.stream.command.keys,["GET",""]),f++)),this.cmd02.setCmdHeight(sprintf("%spx",30*f))},_checkConSuccess:function(a,b,c,d){var e=a.listOfQueues[1].qObject.endTime-a.listOfQueues[0].qObject.startTime;this.refInterval=5*(e+1e3),console.log(sprintf("Requests took %s ms to complete. Using %s ms as reference interval setting.",e,this.refInterval)),this._connect(b,c,d)},_checkConError:function(a){this.cmp01.remove(),alert(sprintf("%s\n\n%s","Failed to connect to detector.",a.statusText))},_connect:function(a,b,c){var d=sprintf("Connecting to %s:%s...",a,b);if(console.log(d),c&&console.log(sprintf("Retrying after initalize...")),c){var e={success:[this.connectSuccess,this,[]],error:[this.connectError,this,[]]};cmdHeight="70px"}else{var e={success:[this.connectSuccess,this,[]],error:[this.connectErrorInit,this,[a,b,c]]};cmdHeight="40px"}this.cmp01=new EIGERSubseqCmdPrompt(this.ui.body,0,"EHC","EIGER Command Handler",this,e),this.cmp01.setTitle(d),this.cmd01=this.cmp01.addCmdLog(),this.cmd01.setCmdHeight(cmdHeight),c===!0&&this.cmd01.addCmd(this.e.detector.command.initialize,["Put","",!0]),this.cmd01.addMCmd([this.e.update,[this.e,!0]]),this.cmd01.exec()},connect:function(a,b,c){""==b&&(b=80),""!=a&&this.e.setHost(a,b),this._checkConnection(a,b,!0,c)},connectSuccess:function(a){this.cmd01="",this.e.connectionStateID=2;var b=this.getView("Acquire");this.ui.cset.inp01.setDisabled(!0),this.ui.cset.inp02.setDisabled(!0),this.ui.cset.frm01.clearSubmit(),this.ui.cset.btn02.setText("disconnect"),this.ui.cset.btn02.click(function(){window.location.reload(),[]}),this.switchView(b),this.ui.acq.connect(),this.ui.acq.disableAdvMode(),this.ui.acq.chk04.setDisabled(!1),this.ui.showHiddenHomeWidgets()},connectError:function(a){alert(sprintf("%s\n\n%s","Failed to connect to detector.",a.statusText)),this.cmd01=""},connectErrorInit:function(a,b,c,d){this.cmd01="",confirm("Could not connect to detector system.\n\nThis can be caused by the detector not being initialized. Would you like initializing the detector system and retry?")&&this._connect(b,c,!0)},getView:function(a){for(var b in this.ui.viewList)if(this.ui.viewList[b].name===a)return this.ui.viewList[b]},switchView:function(a){this.ui.activateView(a)},sync:function(){for(var a in this.uiConnections)this.uiConnections[a].sync()},setUpInterval:function(){for(var a in this.uiConnections)this.uiConnections[a].setInterval(),this.uiConnections[a].eigerValue.refreshed()},uiConnect:function(a,b,c,d){var e=this.uiInstInt++,f=new EIGERUiConnector(this,e,a,b,c,d);return this.uiConnections[e]=f,f},updateUiConnections:function(){for(var a in this.uiConnections){var b=this.uiConnections[a].eigerValue.refreshListeners;this.uiConnections[a].eigerValue instanceof EIGERKey?this.uiConnections[a].eigerValue=this.e[this.uiConnections[a].eigerValue.domain.index][this.uiConnections[a].eigerValue.subdomain.index][this.uiConnections[a].eigerValue.index]:this.uiConnections[a].eigerValue=this.e[this.uiConnections[a].eigerValue.domain.index][this.uiConnections[a].eigerValue.subdomain.index],this.uiConnections[a].eigerValue.refreshListeners=b}},addQueryStatusListener:function(a,b,c){this.eHandler.addQueueListener(c,a,b)},addQueryListenerList:function(a){this.eHandler.addQueryListenerList(a)},getQueryStatusListeners:function(){return this.eHandler.getQueryStatusListeners()},removeQueryStatusListener:function(a){this.eHandler.removeQueueListener(a)},removeAllQueryStatusListeners:function(){this.eHandler.removeAllQueryStatusListeners()}},EIGERUiConnector.prototype={setId:function(a){this.id=a},setDisabled:function(a){"function"==typeof this.widget.setDisabled&&this.widget.setDisabled(a)},sync:function(){switch(this.widget.type){case"Label":case"_Label":this.widget.setText(this.eigerValue.value.value);break;case"Select":0===this.widget.length&&this.widget.addOptions(this.eigerValue.allowed_values.value);case"Input":this.widget.setValue(this.eigerValue.value.value);break;case"Indicator":this.widget.setText(this.eigerValue.value.value),$.inArray(this.eigerValue.value.value,this.eigerValue.critical_values.value.push("error"))>-1?this.widget.error():$.inArray(this.eigerValue.value.value,["initialize","configure","acquire","test"])>-1?this.widget.warning():$.inArray(this.eigerValue.value.value,["ready","idle"])>-1?this.widget.ok():this.widget.grey();break;default:this.widget.setValue(this.eigerValue.value.value)}},clearInterval:function(){window.clearInterval(this.iInst);for(var a in this.eUi.listOfSyncedKeys)if(this.eUi.listOfSyncedKeys[a][0]===this.eigerValue){delete this.eUi.listOfSyncedKeys[a];break}},setInterval:function(){this.iInst=this.iFunction(),this.setDisabled(!1)},iFunction:function(){var a=this;for(var b in this.eUi.listOfSyncedKeys)if(this.eUi.listOfSyncedKeys[b][0]===this.eigerValue){var c=b;break}if(void 0===c){var d=window.setInterval(function(){a.eigerValue.update.apply(a.eigerValue,[])},this.interval*this.eUi.refInterval);return this.eUi.listOfSyncedKeys.push([this.eigerValue,d]),d}return this.eUi.listOfSyncedKeys[c][1]},setUpWidgetListners:function(){var a=this;this.eigerValue.refresh(this.sync,this),"Label"===this.widget.type||"_Label"===this.widget.type||("Input"===this.widget.type?(this.widget.jInput.focus(function(){a.clearInterval(),a.eUi.eHandler.abortAllKeyRequests(a.eigerValue),void 0!==a.form&&(a.formAction=a.form.getSubmit(),a.form.clearSubmit(),a.form.submit(a.setValueSubmit,a))}),this.widget.jInput.focusout(function(){a.setValue.apply(a,[]),a.form.setSubmitListeners(a.formAction)})):"CheckBox"!==this.widget.type&&"Select"!==this.widget.type||this.widget.jInput.change(function(){a.setValue.apply(a,[])}))},setValueSubmit:function(){this.setValue(!0)},setValue:function(a){var b=this.widget.getValue()!=this.eigerValue.value.value;b?(console.log(sprintf("Changed %s to: %s (from: %s)",this.eigerValue.index,this.widget.getValue(),this.eigerValue.value.value)),this.cmp01=new EIGERSubseqCmdPrompt(this.eUi.ui.body,0,"EHC","EIGER Command Handler",this.eUi,{
success:[this.success,this,[a]],error:[this.putError,this,[]]}),this.cmp01.setTitle(sprintf("Updating value %s...",this.eigerValue.index)),this.cmd01=this.cmp01.addCmdLog(),this.cmd01.setCmdHeight("35px"),this.cmd01.addQObj(this.eigerValue.setValue(this.widget.getValue()))):(console.log(sprintf("Unchanged value %s (%s, from: %s)",this.eigerValue.index,this.widget.getValue(),this.eigerValue.value.value)),a&&(this.reattachSubmit(),this.form.submitted())),this.setInterval()},success:function(a,b){b&&(this.reattachSubmit(),this.form.submitted())},reattachSubmit:function(){this.formAction.length>0&&void 0!==this.form&&this.form.setSubmitListeners(this.formAction)},putError:function(a){alert(sprintf("Error while executing request.\n\n%s"),a.statusText),this.cmp01=new EIGERSubseqCmdPrompt(this.eUi.ui.body,0,"EHC","EIGER Command Handler",this.eUi,{success:[this.error,this,[]],error:[this.error,this,[]]}),this.cmp01.setTitle(sprintf("Recovering value %s...",this.eigerValue.index)),this.cmd01=this.cmp01.addCmdLog(),this.cmd01.setCmdHeight("35px"),this.cmd01.addCmd(a.listOfQueues[0].qObject.instance,["GET",""])},error:function(a){this.cmd01="",this.reattachSubmit()}},SVGElement.prototype={getSVG:function(){return this.element}},SVGGroup.prototype={setAttr:function(a){this.element.setAttribute(arguments[0],arguments[1])},addSVGObject:function(a){var b=[this,uniId++,arguments[0].type,"ToDo"],c=construct(arguments[0],b.concat(arguments[1]));return this.svgElementList.push(c),c},addSVGPaths:function(a){a.forEach(function(a,b,c){var d=this.addSVGObject(SVGPath,[a]);this.paths.push(d)},this)},setSVGPathsAttr:function(a){var b=arguments;this.paths.forEach(function(a,c,d){a.setAttr2.apply(a,b)},this)}},SVGObject.prototype={setAttr:function(a){this.element.setAttribute(arguments[0],arguments[1])},setAttr2:function(a){this.element.setAttribute(arguments[0],arguments[1])},setFill:function(a){this.setAttr("fill",a)},setStroke:function(a){this.setAttr("stroke",a)},setStrokeWidth:function(a){this.setAttr("stroke-width",a)}},SVGPath.prototype={},EIGERSVGModule.prototype={},EIGERSVGSensor.prototype={},EIGERSVGChip.prototype={},EIGERSVGFront.prototype={},EIGERSVGBack.prototype={},EIGERSVGMCB.prototype={},extend(SVGElement,SVGGroup),extend(SVGElement,SVGObject),extend(SVGObject,SVGPath),extend(SVGGroup,EIGERSVGModule),extend(SVGGroup,EIGERSVGSensor),extend(SVGGroup,EIGERSVGChip),extend(SVGGroup,EIGERSVGFront),extend(SVGGroup,EIGERSVGBack),extend(SVGGroup,EIGERSVGMCB);