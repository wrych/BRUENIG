function msToISO(t){if(isNaN(t))throw"NaN";return toLocalISO(new Date(t))}function toLocalISO(t){var e=-t.getTimezoneOffset(),i=e>=0?"+":"-",s=function(t){var e=Math.abs(Math.floor(t));return(10>e?"0":"")+e};return t.getFullYear()+"-"+s(t.getMonth()+1)+"-"+s(t.getDate())+"T"+s(t.getHours())+":"+s(t.getMinutes())+":"+s(t.getSeconds())+"."+s(t.getMilliseconds())+i+s(e/60)+":"+s(e%60)}function extend(t,e){var i=e.prototype;e.prototype=Object.create(t.prototype);for(var s in i)e.prototype[s]=i[s];e.prototype.constructor=e,Object.defineProperty(e.prototype,"constructor",{enumerable:!1,value:e})}function construct(t,e){function i(){return t.apply(this,e)}return i.prototype=t.prototype,new i}function AreaResizer(){this.addResizeListener(this.resized),this.offsetList=[]}function LineBreak(){this.jElement=$("<br>")}function Area(t,e,i,s){this.parent=t,this.id=e,this.name=i,this.description=s,this.jElement=$('<div class="area"></div>').appendTo(this.parent.getJElement())}function BodyArea(t){this.parentJElement=null,this.parent=null,this.id=t,this.name="Body",this.description="Body",this.jElement=$("body")}function PlacementArea(t,e,i,s){Area.call(this,t,e,i,s),this.jElement.addClass("placement")}function BlockArea(t,e,i,s){Area.call(this,t,e,i,s),this.jElement.addClass("block"),this.widgetList=[]}function WidgetArea(t,e,i,s){Area.call(this,t,e,i,s),this.jElement.addClass("widget")}function ContainerArea(t,e,i,s){Area.call(this,t,e,i,s),this.jElement.addClass("container"),this.widgetList=[]}function Input(t,e,i,s){ContainerArea.call(this,t,e,i,s),this.type="Input",this.label=new _Label(this,this.id,this.name,this.description),$("<br>").appendTo(this.jElement),this.jInput=$("<input>").prop({type:"Text"}).appendTo(this.jElement)}function CheckBox(t,e,i,s){ContainerArea.call(this,t,e,i,s),this.type="CheckBox",this.label=new _Label(this,this.id,this.name,this.description),$("<br>").appendTo(this.jElement),this.jInput=$("<input type='checkbox'>").appendTo(this.jElement)}function Select(t,e,i,s){ContainerArea.call(this,t,e,i,s),this.type="Select",this.length=0,this.label=new _Label(this,this.id,this.name,this.description),$("<br>").appendTo(this.jElement),this.jInput=$("<select></select>").appendTo(this.jElement)}function _Label(t,e,i,s){WidgetArea.call(this,t,e,i,s),this.type="_Label",this.jElement.addClass("label"),this.setWidth("200px"),this.setHeight("18px")}function Label(t,e,i,s){ContainerArea.call(this,t,e,i,s),this.type="Label",this.label=new _Label(this,this.id,this.name,this.description)}function _Title(t,e,i,s){WidgetArea.call(this,t,e,i,s),this.type="_Label",this.jElement.addClass("label"),this.jTitle=$("<h1></h1>").appendTo(this.jElement)}function Title(t,e,i,s){ContainerArea.call(this,t,e,i,s),this.type="Label",this.title=new _Title(this,this.id,this.name,this.description)}function Image(t,e,i,s){ContainerArea.call(this,t,e,i,s),this.type="Image",this.image=new _Image(this,this.id,this.name,this.description)}function _Image(t,e,i,s){WidgetArea.call(this,t,e,i,s),this.type="_Image",this.jElement.addClass("image"),this.jImage=$('<img src="">').appendTo(this.getJElement()),this.jImage.addClass("imageDisp")}function _StatusIndicator(t,e,i,s){WidgetArea.call(this,t,e,i,s),this.type="StatusIndicator",this.jElement.addClass("statusIndicator"),this.setWidth("18px"),this.setHeight("18px"),this.jElement.css("background-color","red")}function Indicator(t,e,i,s){ContainerArea.call(this,t,e,i,s),this.type="Indicator",this.jElement.addClass("indicator"),this.statusIndicator=new _StatusIndicator(this,this.id,this.name,this.description),this.label=new _Label(this,this.id,this.name,this.description)}function Form(t,e,i,s){Area.call(this,t,e,i,s),this.jForm=$("<Form/>").appendTo(this.jElement),this.widgetList=[],this.submitListeners=[],this.addSubmitListener(this.submitted)}function _Button(t,e,i,s){WidgetArea.call(this,t,e,i,s),this.type="_Button",this.jElement.addClass("label"),this.jButton=$("<input/>").prop({type:"button"}).appendTo(this.jElement),this.jButton.css("cursor","pointer")}function Button(t,e,i,s,n,a){ContainerArea.call(this,t,e,i,s),this.jElement.addClass("button"),"undefined"!=typeof a&&(this.image=$('<img class="buttonImage">').appendTo(this.jElement),this.image.attr("src",a)),this.button=new _Button(this,uniId++,this.name,this.description),this.setText(n),this.clickListeners=[],this.addClickListener(this.jElement,this.clicked),this.disabled=!1}function SubmitButton(t,e,i,s,n,a){Button.call(this,t,e,i,s,n,a),this.setType("submit")}function Progressbar(t,e,i,s){Area.call(this,t,e,i,s),this.jElement.addClass("progressbar-container"),this.progressIndicator=$("<div class='progressbar-progress container'></div>").appendTo(this.jElement)}function NavButton(t,e,i,s,n,a){ContainerArea.call(this,t,e,i,s),this.jElement.addClass("button"),"undefined"!=typeof a&&(this.image=$('<img class="buttonImage">').appendTo(this.jElement),this.image.attr("src",a)),this.label=new _Label(this,this.id,this.name,this.description),this.label.getJElement().addClass("nav-button"),this.label.setWidth("110px"),this.setText(n),this.clickListeners=[],this.addClickListener(this.jElement,this.clicked)}function Overlay(t,e,i,s){Area.call(this,t,e,i,s),this.jElement.addClass("overlay-background")}function OverlayDisplay(t,e,i,s,n){this.overlay=new Overlay(t,e,i,s,n),ContainerArea.call(this,this.overlay,e,i,s),this.jElement.addClass("overlay-display")}function Tabular(t,e,i,s){this.parent=t,this.id=e,this.name=i,this.description=s,this.widgetList=[]}function Table(t,e,i,s){Tabular.call(this,t,e,i,s),this.jElement=$('<table class="area"></table>').appendTo(this.parent.getJElement())}function TableRow(t,e,i,s){Tabular.call(this,t,e,i,s),this.jElement=$("<tr></tr>").appendTo(this.parent.getJElement()),this.jElement.addClass("table-row")}function TableField(t,e,i,s){Tabular.call(this,t,e,i,s),this.jElement=$("<td></td>").appendTo(this.parent.getJElement()),this.text="",this.clickListeners=[],this.addClickListener(this.jElement,this.clicked)}function UiHandler(t,e,i,s){this.area=e,this.navArea=i,this.resizer=s,this.body=t,this.uiOLInt=0,this.uiOverlays={},this.uiInstInt=0,this.uiConnections={},this.viewID=0,this.viewList={},this.btnID=0,this.btnList={},this.btnAssign={}}function UiConnector(t,e,i,s,n){this.id=t,this.interval=s,this.widget=e,this.form=n,this.formAction=void 0,this.setUpWidgetListners(this),this.fValue=i,this.setDisabled(!0),this.setInterval(this)}function inExcludedKeys(t){for(var e in excludedKeys)if(excludedKeys[e]===t)return!0;return!1}function EIGERQuery(t,e,i,s){this.id=void 0,this.handler=e,this.method=i,this.instance=t,this.data=s,this.status=0}function EIGERMQuery(t,e,i,s,n){this.qListener={widget:i,newCallback:s,updateCallback:n},this.id=void 0,this.handler=t,this.status=0,this.listOfQueues=e[0].apply(e[1][0],e[1]),this.qDone=0,this.qCount=this.listOfQueues.length,this.progress=0}function EIGERHandler(){this.qInstInt=0,this.activeQueries={},this.history=0,this.qListerInt=0,this.qListenerList={}}function EIGERContainer(){this.versionInURI=!0,this.refreshListeners=[]}function EIGER(t,e,i){EIGERContainer.call(this),this.address=t,this.port=e,this.index="detector",this.version=defaultVersion,console.log(this),this.connectionStateID=0,this.handler=i,console.log(i),this.children=this.addChilds(domains),this.handler.addQueueListener(this,this.updateQItem)}function EIGERDomain(t,e){EIGERContainer.call(this),this.superDet=t,this.index=e,this.name=e,this.children=this.addChilds(subdomains);for(var e in specialKeys)specialKeys[e].domain===this.index&&(this.children[specialKeys[e].subdomain]=new EIGERSpecialKey(this.superDet,this,specialKeys[e].subdomain,specialKeys[e].versionInURI),this[specialKeys[e].subdomain]=this.children[specialKeys[e].subdomain])}function EIGERSubDomain(t,e,i){EIGERContainer.call(this),this.superDet=t,this.domain=e,this.index=i,this.name=i,this.children=this.addChilds(keys[this.domain.index][this.index])}function EIGERKey(t,e,i,s){EIGERContainer.call(this),this.superDet=t,this.domain=e,this.subdomain=i,this.index=s,this.name=s,this.children={},"command"===this.subdomain.index?this.constructChild("access_mode","w"):this.constructChild("access_mode","")}function EIGERSpecialKey(t,e,i,s){EIGERContainer.call(this),this.superDet=t,this.domain=e,this.subdomain={},this.subdomain.index=i,this.versionInURI=s,this.index="",this.name=i,this.children={},this.constructChild("access_mode","r")}function EIGERValue(t,e,i,s,n,a){this.superDet=t,this.domain=e,this.subdomain=i,this.key=s,this.index=n,this.value=a}function EIGERConSet(t,e,i,s,n,a){ContainerArea.call(this,t,e,i,s),this.ui=n,this.ui.cset=this,this.eUi=a,this.type="ConnectionWidget",this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h2"),this.ttl01.setText("EIGER Connection Settings"),this.addNewLine(),this.frm01=this.addWidget(Form,[]),this.inp01=this.frm01.addWidget(Input,[]),this.inp01.setTitle("Address"),this.inp01.setValue(document.domain),this.inp02=this.frm01.addWidget(Input,[]),this.inp02.setTitle("Port"),this.btn01=this.frm01.addWidget(SubmitButton,["connect"]),this.frm01.submit(this.connect,this)}function EIGERAcqSet(t,e,i,s,n,a){ContainerArea.call(this,t,e,i,s),this.ui=n,this.ui.acq=this,this.eUi=a,this.type="Acquisition Settings",this.advWidgets=[],this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h4"),this.ttl01.setText("Commands"),this.addAdvWidget(this.ttl01),this.addAdvWidget(this.addNewLine()),this.btn01=this.addWidget(Button,["Initialize"]),this.btn01.click(this.init,this),this.addAdvWidget(this.btn01),this.btn02=this.addWidget(Button,["Disarm"]),this.btn02.click(this.disarm,this),this.addAdvWidget(this.btn02),this.btn03=this.addWidget(Button,["Abort"]),this.btn03.click(this.abort,this),this.addAdvWidget(this.btn03),this.btn04=this.addWidget(Button,["Custom Queue"]),this.btn04.click(this.customQ,this),this.addAdvWidget(this.btn04),this.addAdvWidget(this.addNewLine()),this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h4"),this.ttl01.setText("Settings"),this.frm01=this.addWidget(Form,[]),this.inp01=this.frm01.addWidget(Input,[]),this.inp01.setTitle("Photon Energy [eV]"),a.uiConnect(this.inp01,a.e.detector.config.photon_energy,1,this.frm01),a.uiConnect(this.inp01,a.e.detector.config.photon_energy,1,this.frm01),this.addAdvWidget(this.inp01),this.inp02=this.frm01.addWidget(Input,[]),this.inp02.setTitle("Threshold Energy [eV]"),a.uiConnect(this.inp02,a.e.detector.config.threshold_energy,1,this.frm01),this.addAdvWidget(this.inp02),this.sel01=this.frm01.addWidget(Select,[]),this.sel01.setTitle("Elements"),a.uiConnect(this.sel01,a.e.detector.config.element,1,this.frm01),this.frm01.addNewLine(),this.inp03=this.frm01.addWidget(Input,[]),this.inp03.setTitle("Count Time"),a.uiConnect(this.inp03,a.e.detector.config.count_time,1,this.frm01),this.inp03=this.frm01.addWidget(Input,[]),this.inp03.setTitle("Frame Time"),a.uiConnect(this.inp03,a.e.detector.config.frame_time,1,this.frm01),this.inp05=this.frm01.addWidget(Input,[]),this.inp05.setTitle("Number of Images"),a.uiConnect(this.inp05,a.e.detector.config.nimages,1,this.frm01),this.frm01.addNewLine(),this.chk01=this.frm01.addWidget(CheckBox,[]),this.chk01.setTitle("Apply Flatfield Correction"),a.uiConnect(this.chk01,a.e.detector.config.flatfield_correction_applied,1,this.frm01),this.addAdvWidget(this.chk01),this.chk02=this.frm01.addWidget(CheckBox,[]),this.chk02.setTitle("Apply Countrate Correction"),a.uiConnect(this.chk02,a.e.detector.config.countrate_correction_applied,1,this.frm01),this.addAdvWidget(this.chk02),this.addAdvWidget(this.frm01.addNewLine()),this.inp06=this.frm01.addWidget(Input,[]),this.inp06.setTitle("Number of Triggers"),a.uiConnect(this.inp06,a.e.detector.config.ntrigger,1,this.frm01),this.addAdvWidget(this.inp06),this.sel02=this.frm01.addWidget(Select,[]),this.sel02.setTitle("Trigger Mode"),a.uiConnect(this.sel02,a.e.detector.config.trigger_mode,1,this.frm01),this.addAdvWidget(this.sel02),this.addAdvWidget(this.frm01.addNewLine()),this.inp07=this.frm01.addWidget(Input,[]),this.inp07.setTitle("Name Pattern"),a.uiConnect(this.inp07,a.e.filewriter.config.name_pattern,1,this.frm01),this.addAdvWidget(this.inp07),this.inp08=this.frm01.addWidget(Input,[]),this.inp08.setTitle("NImages per Data File"),a.uiConnect(this.inp08,a.e.filewriter.config.nimages_per_file,1,this.frm01),this.addAdvWidget(this.inp08),this.sel03=this.frm01.addWidget(Select,[]),this.sel03.setTitle("FileWriter Mode"),a.uiConnect(this.sel03,a.e.filewriter.config.mode,1,this.frm01),this.addAdvWidget(this.sel03),this.frm01.addNewLine(),this.frm01.addNewLine(),this.chk04=this.frm01.addWidget(CheckBox,[]),this.chk04.setTitle("Expert Mode"),this.chk04.setDisabled(!0),this.setAdvModeElVisibility(!1);var h=this;this.chk04.jInput.change(function(){h.toggleAdvanced.apply(h,[])}),this.btn05=this.frm01.addWidget(SubmitButton,["Acquire"]),this.frm01.submit(this.acquire,this)}function EIGERExp(t,e,i){this.ui=t,this.ui.exp=this,this.eUi=e;var s=this.getView("Exposure");switch(this.switchView(s),this.cmd01=s.addWidget(EIGERSubseqCmdHandler,[this.eUi,{success:[this.success,this,[]],error:[this.error,this,[]]}]),i){case"expose":this.cmd01.addCmd(this.eUi.e.detector.command.arm,["Put","",!0]),this.cmd01.addCmd(this.eUi.e.detector.command.trigger,["Put","",!0]),this.cmd01.addCmd(this.eUi.e.detector.command.disarm,["Put","",!0]),this.endView="Data";break;case"advExpose":var n=this.eUi.e.detector.config.trigger_mode.value.value,a=this.eUi.e.detector.config.ntrigger.value.value;if(console.log(sprintf("Starting %s series with %s triggers...",n,a)),this.cmd01.addCmd(this.eUi.e.detector.command.arm,["Put","",!0]),String(n).startsWith("int"))for(var h=0;a>h;h++)this.cmd01.addCmd(this.eUi.e.detector.command.trigger,["Put","",!0],this.cmd01.EXEC_CLICK);this.cmd01.addCmd(this.eUi.e.detector.command.disarm,["Put","",!0],this.cmd01.EXEC_ICLICK,this.cmd01.ENDING_COMMAND),this.endView="Data";break;case"initialize":this.cmd01.addCmd(this.eUi.e.detector.command.initialize,["Put","",!0]),this.endView="Acquire";break;case"disarm":this.cmd01.addCmd(this.eUi.e.detector.command.disarm,["Put","",!0]),this.endView="Acquire";break;case"abort":this.cmd01.addCmd(this.eUi.e.detector.command.abort,["Put","",!0]),this.endView="Acquire"}this.cmd01.exec(this.cmd01)}function EIGERData(t,e,i,s,n,a){ContainerArea.call(this,t,e,i,s),this.ui=n,this.eUi=a,this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h2"),this.ttl01.setText("EIGER Data"),this.addNewLine(),this.lgh01=this.addWidget(EIGERDataLogger,[this.eUi])}function EIGERAcq(t,e,i,s,n,a){ContainerArea.call(this,t,e,i,s),this.ui=n,this.eUi=a,this.type="AcquireSettings",this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h4"),this.ttl01.setText("Acquisition")}function EIGERLog(t,e,i,s,n,a){ContainerArea.call(this,t,e,i,s),this.ui=n,this.ui.log=this,this.eUi=a,this.type="ConnectionWidget";var h=this;this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h2"),this.ttl01.setText("EIGER Logs and Command Overview"),this.addNewLine(),this.ttl02=this.addWidget(Title,[]),this.ttl02.setLvl("h4"),this.ttl02.setText("Overview"),this.addNewLine(this),this.ttl02.lbl01=this.addWidget(Label,[]),this.ttl02.lbl01.setText("Active Commands:"),this.ttl02.lbl02=this.addWidget(Label,[]),this.ttl02.lbl02.setText("n/a"),this.ttl02.lbl02.setWidth("50px"),n.uiConnect(this.ttl02.lbl02,function(){return Object.keys(h.eUi.eHandler.activeQueries).length},50),this.ttl02.lbl03=this.addWidget(Label,[]),this.ttl02.lbl03.setText("History:"),this.ttl02.lbl04=this.addWidget(Label,[]),this.ttl02.lbl04.setText("n/a"),this.ttl02.lbl04.setWidth("50px"),n.uiConnect(this.ttl02.lbl04,function(){return h.eUi.eHandler.history},50),this.addNewLine(),this.ttl03=this.addWidget(Title,[]),this.ttl03.setLvl("h4"),this.ttl03.setText("Active Commands"),this.lgh01=this.addWidget(EIGERCmdLogger,[this.eUi])}function EIGERHelp(t,e,i,s,n,a){ContainerArea.call(this,t,e,i,s),this.ui=n,this.eUi=a,this.type="AcquireSettings",this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h4"),this.ttl01.setText("Support"),this.getJElement().append($('<p>We want to be your partner and find solutions for your needs. <br> 								We can support you with our broad technical expertise and application know-how.<br><br> 								Questions and inquiries - please contact us:<br><br> 								E-mail<br> 								<a href="mailto:support@dectris.com">support@dectris.com</a><br><br> 								Telephone<br> 								+41 56 500 21 02</p> ')),this.addNewLine(),this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h4"),this.ttl01.setText("Help"),this.addNewLine(),this.img01=this.addWidget(Image,[]),this.img01.setSrc("im/help/Connect.jpeg"),this.img01.setWidth("600px"),this.getJElement().append($("<p>1. Please enter the detectors address (name or IP).<br>The port is configured to be 80 when the input is left empty <br> 							2. Click on the connect button to set up the client.</p> ")),this.img01=this.addWidget(Image,[]),this.img01.setSrc("im/help/Settings.jpeg"),this.img01.setWidth("600px"),this.getJElement().append($("<p>1. Please adapt the settings to your needs. <br> 							2. Click on the acquire button to record a (series) of image(s).</p> ")),this.img01=this.addWidget(Image,[]),this.img01.setSrc("im/help/Download.jpeg"),this.img01.setWidth("600px"),this.getJElement().append($('<p>1. By clicking the download button you will start downloading a file. <br>Always make sure to download the master and the data file.<br> 							2. Clicking the "x" button will delete the resource on the DCU. You will be asked to confirm.</p> ')),this.img01=this.addWidget(Image,[]),this.img01.setSrc("im/help/ExpertMode.jpeg"),this.img01.setWidth("600px"),this.getJElement().append($("<p>Advanced users might chose to use the advanced mode. Please only use this mode if you are an expert.</p> "))}function EIGERDataLogger(t,e,i,s,n){BlockArea.call(this,t,e,i,s),this.eUi=n,this.table=this.addWidget(Table,[]),this.table.setWidth("865px"),this.setHeight("320px"),this.jElement.css("overflow-y","scroll"),this.jElement.css("overflow-x","hidden"),this.ids=0,this.rows={};for(var a in this.eUi.eHandler.activeQueries)this.newQItem(this.eUi.eHandler.activeQueries[a]);this.eUi.uiConnect(this,this.eUi.e.filewriter.files,2)}function EIGERCmdLogger(t,e,i,s,n){BlockArea.call(this,t,e,i,s),this.eUi=n,this.table=this.addWidget(Table,[]),this.table.setWidth("865px"),this.setHeight("320px"),this.jElement.css("overflow-y","scroll"),this.jElement.css("overflow-x","hidden"),this.rows={};for(var a in this.eUi.eHandler.activeQueries)this.newQItem(this.eUi.eHandler.activeQueries[a]);this.eUi.addQueryStatusListener(this.updateQItem,this.newQItem,this)}function EIGERCmdDisplay(t,e,i,s,n){EIGERCmdLogger.call(this,t,e,i,s,n)}function EIGERCustomCmdPrompt(t,e,i,s,n){OverlayDisplay.call(this,t,e,i,s),this.eUi=n,this.closeDone=!1,this.jElement.css("cursor","default"),this.tlt01=this.addWidget(Title,[]),this.tlt01.setLvl("h3"),this.eUi.ui.resizer.resizeOffset(this.setOffset,this,"top",["mid",-200],0),this.eUi.ui.resizer.resizeOffset(this.setOffset,this,"left",["mid",-400],0),this.eUi.ui.resizer.trigger(),this.tlt01.setText("Custom Command Queue Builder"),this.addNewLine();var a=this;this.frm01=this.addWidget(Form,[]),this.frm01.submit(this.submit,this),this.sel01=this.frm01.addWidget(Select,[]),this.sel01.setTitle("Method"),this.sel01.setWidth("80px"),this.sel01.addOptions(["GET","PUT","DELETE"]),this.sel01.jInput.change(function(t){a.changeMethod.apply(a,[t])}),this.sel02=this.frm01.addWidget(Select,[]),this.sel02.setTitle("Module"),this.sel02.setWidth("80px"),this.addOptions(this.sel02,this.eUi.e.children),this.sel02.jInput.change(function(t){a.changeModule.apply(a,[t])}),this.sel03=this.frm01.addWidget(Select,[]),this.sel03.setTitle("Task"),this.sel03.setWidth("87px"),this.sel03.jInput.change(function(t){a.changeTask.apply(a,[t])}),this.sel03.setDisabled(!0),this.sel04=this.frm01.addWidget(Select,[]),this.sel04.setTitle("Key"),this.sel04.setWidth("247px"),this.sel04.jInput.change(function(t){a.changeKey.apply(a,[t])}),this.sel04.setDisabled(!0),this.inp01=this.frm01.addWidget(Input,[]),this.inp01.setTitle("Value"),this.inp01.setWidth("150px"),this.inp01.setDisabled(!0),this.frm01.addNewLine(),this.lbl01=this.frm01.addWidget(Label,[]),this.lbl01.setWidth("500px"),this.lbl01.setText(" "),this.chk01=this.frm01.addWidget(CheckBox,[]),this.chk01.setWidth("150px"),this.chk01.setTitle("Execute manually"),this.btn01=this.frm01.addWidget(SubmitButton,["Add To Queue"]),this.btn01.setDisabled(!0),this.addNewLine(),this.cmd01=this.addWidget(EIGERSubseqCmdHandler,[this.eUi,{success:[this._done,this,[]],error:[this._fail,this,[]]}]),this.cmd01.setHeight("100px"),this.addNewLine(),this.chk02=this.addWidget(CheckBox,[]),this.chk02.setTitle("Close when finished"),this.chk02.jInput.change(function(){a.closeDone=a.chk02.getValue()}),this.btn02=this.addWidget(Button,["Execute"]),this.btn02.click(this.startQ,this),this.btn02.setDisabled(!0),this.btn03=this.addWidget(Button,["Close"]),this.btn03.click(this.close,this)}function EIGERCmdInformation(t,e,i,s,n){OverlayDisplay.call(this,t,e,i,s),this.eUi=n,this.qInstance=void 0,this.jElement.css("cursor","default"),this.eUi.ui.resizer.resizeOffset(this.setOffset,this,"top",["mid",-200],0),this.eUi.ui.resizer.resizeOffset(this.setOffset,this,"left",["mid",-400],0),this.eUi.ui.resizer.trigger(),this.tlt01=this.addWidget(Title,[]),this.tlt01.setLvl("h3"),this.tlt01.setText("Command Information"),this.addNewLine(),this.lbl01=this.addWidget(Label,[]),this.lbl01.setText("Request URI"),this.addNewLine(),this.table=this.addWidget(Table,[]),this.table.setWidth("700px"),this.tbr01=this.table.addWidget(TableRow,[]),this.tbr01.tfd01=this.tbr01.addWidget(TableField),this.tbr01.tfd01.setWidth("120px"),this.tbr01.tlt02=this.tbr01.tfd01.addWidget(Title,[]),this.tbr01.tlt02.setLvl("h3"),this.tbr01.tlt02.setText("Request"),this.tbr01.tfd02=this.tbr01.addWidget(TableField),this.tbr01.tfd02.setWidth("230px"),this.tbr01.tfd03=this.tbr01.addWidget(TableField),this.tbr01.tfd03.setWidth("120px"),this.tbr01.tlt03=this.tbr01.tfd03.addWidget(Title,[]),this.tbr01.tlt03.setLvl("h3"),this.tbr01.tlt03.setText("Response"),this.tbr01.tfd04=this.tbr01.addWidget(TableField),this.tbr01.tfd04.setWidth("230px"),this.tbr02=this.table.addWidget(TableRow,[]),this.tbr02.tfd01=this.tbr02.addWidget(TableField),this.tbr02.tfd01.setText("Address"),this.tbr02.tfd02=this.tbr02.addWidget(TableField),this.tbr02.tfd02.setText("DCU_Addr"),this.tbr02.tfd03=this.tbr02.addWidget(TableField),this.tbr02.tfd03.setText("Code"),this.tbr02.tfd04=this.tbr02.addWidget(TableField),this.tbr02.tfd04.setText("RESPONSE_CODE"),this.tbr03=this.table.addWidget(TableRow,[]),this.tbr03.tfd01=this.tbr03.addWidget(TableField),this.tbr03.tfd01.setText("Port"),this.tbr03.tfd02=this.tbr03.addWidget(TableField),this.tbr03.tfd02.setText("DCU_Port"),this.tbr03.tfd03=this.tbr03.addWidget(TableField),this.tbr03.tfd03.setText("Status"),this.tbr03.tfd04=this.tbr03.addWidget(TableField),this.tbr03.tfd04.setText("RESPONSE_Status"),this.tbr04=this.table.addWidget(TableRow,[]),this.tbr04.tfd01=this.tbr04.addWidget(TableField),this.tbr04.tfd01.setText("Module"),this.tbr04.tfd02=this.tbr04.addWidget(TableField),this.tbr04.tfd02.setText("Module"),this.tbr05=this.table.addWidget(TableRow,[]),this.tbr05.tfd01=this.tbr05.addWidget(TableField),this.tbr05.tfd01.setText("API Version"),this.tbr05.tfd02=this.tbr05.addWidget(TableField),this.tbr05.tfd02.setText("DCU_APIVER"),this.tbr06=this.table.addWidget(TableRow,[]),this.tbr06.tfd01=this.tbr06.addWidget(TableField),this.tbr06.tfd01.setText("Task"),this.tbr06.tfd02=this.tbr06.addWidget(TableField),this.tbr06.tfd02.setText("Task"),this.tbr07=this.table.addWidget(TableRow,[]),this.tbr07.tfd01=this.tbr07.addWidget(TableField),this.tbr07.tfd01.setText("Key"),this.tbr07.tfd02=this.tbr07.addWidget(TableField),this.tbr07.tfd02.setText("Key"),this.tbr08=this.table.addWidget(TableRow,[]),this.tbr08.tfd01=this.tbr08.addWidget(TableField),this.tbr08.tfd01.setText("Payload"),this.tbr08.tfd02=this.tbr08.addWidget(TableField),this.tbr08.tfd02.setText("REQ_Value"),this.tbr08.tfd03=this.tbr08.addWidget(TableField),this.tbr08.tfd03.setText("Payload"),this.tbr08.tfd04=this.tbr08.addWidget(TableField),this.tbr08.tfd04.setText("RESPONSE_Payload"),this.tbr09=this.table.addWidget(TableRow,[]),this.tbr09.tfd01=this.tbr09.addWidget(TableField),this.tbr09.tlt02=this.tbr09.tfd01.addWidget(Title,[]),this.tbr09.tlt02.setLvl("h3"),this.tbr09.tlt02.setText("Meta"),this.tbr09.tfd02=this.tbr09.addWidget(TableField),this.tbr09.tfd03=this.tbr09.addWidget(TableField),this.tbr09.tfd04=this.tbr09.addWidget(TableField),this.tbr10=this.table.addWidget(TableRow,[]),this.tbr10.tfd01=this.tbr10.addWidget(TableField),this.tbr10.tfd01.setText("Start Time"),this.tbr10.tfd02=this.tbr10.addWidget(TableField),this.tbr10.tfd02.setText("REQ_Time"),this.tbr10.tfd03=this.tbr10.addWidget(TableField),this.tbr10.tfd03.setText("Done Time"),this.tbr10.tfd04=this.tbr10.addWidget(TableField),this.tbr10.tfd04.setText("RESPONSE_Time"),this.tbr11=this.table.addWidget(TableRow,[]),this.tbr11.tfd01=this.tbr11.addWidget(TableField),this.tbr11.tfd01.setText("Duration"),this.tbr11.tfd02=this.tbr11.addWidget(TableField),this.tbr11.tfd02.setText("REQ_Duration"),this.addNewLine(),this.btn01=this.addWidget(Button,["Update"]),this.btn01.click(this.update,this),this.btn02=this.addWidget(Button,["Close"]),this.btn02.click(this.remove,this),this.setClickClose(!0)}function EIGERSubseqCmdPrompt(t,e,i,s,n,a){OverlayDisplay.call(this,t,e,i,s),this.eUi=n,this.closeDone=!0,this.callback=a,this.tlt01=this.addWidget(Title,[]),this.tlt01.setLvl("h3"),this.eUi.ui.resizer.resizeOffset(this.setOffset,this,"top",["mid",-200],0),this.eUi.ui.resizer.resizeOffset(this.setOffset,this,"left",["mid",-400],0),this.eUi.ui.resizer.trigger(),this.addNewLine();this.cmd01=this.addWidget(EIGERSubseqCmdHandler,[this.eUi,{success:[this._done,this,[]],error:[this._fail,this,[]]}])}function EIGERSubseqCmdHandler(t,e,i,s,n,a){BlockArea.call(this,t,e,i,s),this.listOfQueues=[],this.callbackList=a,this.eUi=n,this.status=0,this.statusText="",this.table=this.addWidget(Table,[]),this.table.setWidth("865px"),this.btn01=this.parent.addWidget(Button,["Cancel"]),this.btn01.click(this.cancel,this),this.setHeight("400px"),this.jElement.css("overflow-y","scroll"),this.jElement.css("overflow-x","hidden"),this.rows={},this.eUi.addQueryStatusListener(this.updateQItem,this.newQItem,this),this.mQIter=0,this.eIter=0}function EIGERTableRow(t,e,i,s){TableRow.call(this,t,e,i,s),this.tfd01=this.addWidget(TableField,[]),this.tfd01.setText("ID"),this.tfd01.setWidth("40px"),this.tfd02=this.addWidget(TableField,[]),this.tfd02.setText("Path : Key"),this.tfd02.setWidth("640px"),this.tfd03=this.addWidget(TableField,[]),this.tfd03.setWidth("110px"),this.tfd03.ind01=this.tfd03.addWidget(Indicator,[]),this.tfd03.ind01.setText("Status"),this.tfd03.ind01.setWidth("100px"),this.tfd04=this.addWidget(TableField,[]),this.tfd04.setText("Error"),this.tfd04.setWidth("70px")}function EIGERTableMCRow(t,e,i,s){EIGERTableRow.call(this,t,e,i,s),this.tfd02.setText(""),this.tfd02.prb01=this.tfd02.addWidget(Progressbar,[]),this.tfd02.prb01.setProgress(0)}function EIGERDataTableRow(t,e,i,s){EIGERTableRow.call(this,t,e,i,s),this.tfd02.setWidth("590px"),this.tfd03.setWidth("120px"),this.tfd03.ind01.setWidth("80px"),this.tfd04.setWidth("110px")}function EIGERUiHandler(t){this.ui=t,this.fu=fu++,this.uiInstInt=0,this.uiConnections={},this.listOfSyncedKeys=[],this.eHandler=new EIGERHandler,this.e=new EIGER("","",this.eHandler),this.refInterval=1e3}function EIGERUiConnector(t,e,i,s,n,a){this.eUi=t,this.id=e,this.interval=n,this.form=a,this.formAction=[],this.widget=i,this.eigerValue=s,this.setUpWidgetListners(this),this.setDisabled(!0)}AreaResizer.prototype={resizeOffset:function(t,e,i,s,n){this.offsetList.push([t,e,i,s,n])},resized:function(t,e){for(var i=0;i<this.offsetList.length;i++)if("abs"===this.offsetList[i][3][0]){var s="top"===this.offsetList[i][2]?"height":"width",n=e[s]+this.offsetList[i][3][1];n=n>this.offsetList[i][4]?n:this.offsetList[i][4];var a={};a[this.offsetList[i][2]]=n,this.offsetList[i][0].apply(this.offsetList[i][1],[a])}else if("mid"===this.offsetList[i][3][0]){var s="top"===this.offsetList[i][2]?"height":"width",n=e[s]/2+this.offsetList[i][3][1];n=n>this.offsetList[i][4]?n:this.offsetList[i][4];var a={};a[this.offsetList[i][2]]=n,this.offsetList[i][0].apply(this.offsetList[i][1],[a])}},addResizeListener:function(t){var e=this;$(window).resize(function(i){t.apply(e,[i,{width:$(window).width(),height:$(window).height()}])})},trigger:function(){this.resized("",{width:$(window).width(),height:$(window).height()})}},LineBreak.prototype={getJElement:function(){return this.jElement},setVisibility:function(t){t?this.getJElement().show():this.getJElement().hide()}},Area.prototype={getParent:function(){return this.parent()},getId:function(){return this.id},getName:function(){return this.name},getDescription:function(){return this.description},getJElement:function(){return this.jElement},addClickListener:function(t,e){var i=this;$(t).click(function(t){t.stopPropagation(),e&&e.apply(i,[t])})},addHoverListener:function(t,e,i){var s=this;$(t).mouseenter(function(t){t.stopPropagation(),e&&e.apply(s,[t])}),$(t).mouseleave(function(t){t.stopPropagation(),i&&i.apply(s,[t])})},setWidth:function(t){this.getJElement().width(t)},setHeight:function(t){this.getJElement().height(t)},setVisibility:function(t){t?this.getJElement().show():this.getJElement().hide()},remove:function(){this.getJElement().remove()}},BodyArea.prototype={},PlacementArea.prototype={setWidth:function(t){this.getJElement().width(t)},setHeight:function(t){this.getJElement().height(t)},setOffset:function(t){this.getJElement().offset(t)}},BlockArea.prototype={addWidget:function(){defaultArgs=[this,uniId++,arguments[0].type,"ToDo"];var t=construct(arguments[0],defaultArgs.concat(arguments[1]));return this.widgetList.push(t),t},addNewLine:function(){var t=new LineBreak;return t.getJElement().appendTo(this.jElement),t}},WidgetArea.prototype={},ContainerArea.prototype={addWidget:function(){defaultArgs=[this,uniId++,arguments[0].type,"ToDo"];var t=construct(arguments[0],defaultArgs.concat(arguments[1]));return this.widgetList.push(t),t},addNewLine:function(){var t=new LineBreak;return t.getJElement().appendTo(this.jElement),t}},Input.prototype={setWidth:function(t){this.getJElement().width(t),this.label.setWidth(t);var e=t.length-2,i=t.substr(0,e);this.jInput.width(sprintf("%spx",parseInt(i)-12))},setValue:function(t){this.jInput.val(t)},getValue:function(){return this.jInput.val()},setDisabled:function(t){this.jInput.prop("disabled",t)},getDisabled:function(){this.jInput.prop("disabled")},setTitle:function(){this.label.setText.apply(this.label,arguments)},getTitle:function(){this.label.getText.apply(this.label,arguments)}},CheckBox.prototype={setValue:function(t){this.jInput.prop("checked",t)},getValue:function(){return this.jInput.prop("checked")},setDisabled:function(t){this.jInput.prop("disabled",t)},getDisabled:function(){this.jInput.prop("disabled")},setTitle:function(){this.label.setText.apply(this.label,arguments)},getTitle:function(){this.label.getText.apply(this.label,arguments)}},Select.prototype={addOptions:function(t){for(var e=t.length,i=0;e>i;i++)this.length++,this.jInput.append($("<option>",{value:t[i],text:t[i]}))},empty:function(){this.jInput.empty(arguments)},setValue:function(t){this.jInput.val(t)},getValue:function(){return this.jInput.val()},setDisabled:function(t){this.jInput.prop("disabled",t)},getDisabled:function(){this.jInput.prop("disabled")},setTitle:function(){this.label.setText.apply(this.label,arguments)},getTitle:function(){this.label.getText.apply(this.label,arguments)}},_Label.prototype={setText:function(t){this.text=t,this.getJElement().text(t)},getText:function(){return this.text}},Label.prototype={setText:function(){this.label.setText.apply(this.label,arguments)
},getText:function(){this.label.getText.apply(this.label,arguments)},setWidth:function(t){this.getJElement().width(t),this.label.setWidth(t)}},_Title.prototype={setLvl:function(t){if(!($.inArray(t,["h1","h2","h3","h4","h5"])>-1))throw"Illegal Title Level";this.lvl=t,this.jTitle.detach(),this.jTitle=$(sprintf("<%s></%s>",t,t)).appendTo(this.jElement),this.jTitle.text(this.text)},getLvl:function(){return this.lvl},setText:function(t){this.text=t,this.jTitle.text(t)},getText:function(){return this.text}},Title.prototype={setLvl:function(){this.title.setLvl.apply(this.title,arguments)},getLvl:function(){this.title.getLvl.apply(this.title,arguments)},setText:function(){this.title.setText.apply(this.title,arguments)},getText:function(){this.title.getText.apply(this.title,arguments)}},Image.prototype={setSrc:function(){this.image.setSrc.apply(this.image,arguments)},setWidth:function(){this.image.setWidth.apply(this.image,arguments)}},_Image.prototype={setSrc:function(t){this.jImage.attr({src:t})}},_StatusIndicator.prototype={error:function(){this.getJElement().css("background-color","red")},ok:function(){this.getJElement().css("background-color","green")},warning:function(){this.getJElement().css("background-color","yellow")},grey:function(){this.getJElement().css("background-color","grey")}},Indicator.prototype={error:function(){this.statusIndicator.error.apply(this.statusIndicator,arguments)},ok:function(){this.statusIndicator.ok.apply(this.statusIndicator,arguments)},warning:function(){this.statusIndicator.warning.apply(this.statusIndicator,arguments)},grey:function(){this.statusIndicator.grey.apply(this.statusIndicator,arguments)},setText:function(){this.label.setText.apply(this.label,arguments)},setWidth:function(t){this.getJElement().width(t);var e=t.length-2,i=t.substr(0,e);this.label.setWidth(sprintf("%spx",parseInt(i)-20))}},Form.prototype={submit:function(t,e){this.submitListeners.push([t,e])},clearSubmit:function(){this.submitListeners=[]},getSubmit:function(){return this.submitListeners},submitted:function(t){if(!this.disabled)for(var e=0;e<this.submitListeners.length;e++)this.submitListeners[e][0].apply(this.submitListeners[e][1],[t])},addSubmitListener:function(t){var e=this;this.jForm.submit(function(i){return i.preventDefault(),t&&t.apply(e,[i]),!1})},setSubmitListeners:function(t){this.submitListeners=t},addWidget:function(){defaultArgs=[this,uniId++,arguments[0].type,"ToDo"];var t=construct(arguments[0],defaultArgs.concat(arguments[1]));return this.widgetList.push(t),t},addNewLine:function(){var t=new LineBreak;return t.getJElement().appendTo(this.jForm),t},getJElement:function(){return this.jForm}},_Button.prototype={setText:function(t){this.text=t,this.jButton.val(t)},getText:function(){return this.val()},setType:function(t){this.jButton.prop({type:t})},setDisabled:function(t){t?this.jButton.css("cursor","not-allowed"):this.jButton.css("cursor","pointer"),this.jButton.prop("disabled",t)}},Button.prototype={click:function(t,e){this.clickListeners.push([t,e])},clicked:function(t){if(!this.disabled)for(var e=0;e<this.clickListeners.length;e++)this.clickListeners[e][0].apply(this.clickListeners[e][1],[t])},setText:function(){this.button.setText.apply(this.button,arguments)},getText:function(){this.button.getText.apply(this.button,arguments)},setType:function(){this.button.setType.apply(this.button,arguments)},setDisabled:function(t){t?(this.disabled=t,this.button.setDisabled(!0)):(this.disabled=t,this.button.setDisabled(!1))}},SubmitButton.prototype={},Progressbar.prototype={setProgress:function(t){this.progressIndicator.css("width",sprintf("%s%%",Math.round(100*t)))}},NavButton.prototype={click:function(t,e){this.clickListeners.push([t,e])},clicked:function(t){if(!this.disabled)for(var e=0;e<this.clickListeners.length;e++)this.clickListeners[e][0].apply(this.clickListeners[e][1],[t])},setText:function(){this.label.setText.apply(this.label,arguments)},getText:function(){this.label.getText.apply(this.label,arguments)}},Overlay.prototype={click:function(){this.remove()},setClickClose:function(t){t?this.addClickListener(this.jElement,this.click):this.removeClickListener(this.jElement)},remove:function(){this.jElement.remove()}},OverlayDisplay.prototype={setClickClose:function(){this.overlay.setClickClose.apply(this.overlay,arguments)},remove:function(){this.overlay.remove.apply(this.overlay,arguments)},setOffset:function(t){this.getJElement().offset(t)}},extend(Area,BodyArea),extend(Area,BlockArea),extend(Area,WidgetArea),extend(Area,ContainerArea),extend(Area,PlacementArea),extend(Area,Progressbar),extend(Area,Overlay),extend(WidgetArea,_Button),extend(WidgetArea,_Label),extend(WidgetArea,_Title),extend(WidgetArea,_Image),extend(WidgetArea,_StatusIndicator),extend(ContainerArea,Form),extend(ContainerArea,Label),extend(ContainerArea,CheckBox),extend(ContainerArea,Title),extend(ContainerArea,Image),extend(ContainerArea,Input),extend(ContainerArea,Select),extend(ContainerArea,Indicator),extend(ContainerArea,Button),extend(Button,SubmitButton),extend(ContainerArea,NavButton),extend(ContainerArea,OverlayDisplay),Tabular.prototype={getParent:function(){return this.parent()},getId:function(){return this.id},getName:function(){return this.name},getDescription:function(){return this.description},getJElement:function(){return this.jElement},addClickListener:function(t,e){var i=this;$(t).click(function(t){t.stopPropagation(),e&&e.apply(i,[t])})},removeClickListener:function(t){$(t).unbind("click")},addHoverListener:function(t,e,i){var s=this;$(t).mouseenter(function(t){t.stopPropagation(),e&&e.apply(s,[t])}),$(t).mouseleave(function(t){t.stopPropagation(),i&&i.apply(s,[t])})},setWidth:function(t){this.getJElement().width(t)},setHeight:function(t){this.getJElement().height(t)},setVisibility:function(t){t?this.getJElement().show():this.getJElement().hide()},addWidget:function(){defaultArgs=[this,uniId++,arguments[0].type,"ToDo"];var t=construct(arguments[0],defaultArgs.concat(arguments[1]));return this.widgetList.push(t),t}},Table.prototype={},TableRow.prototype={},TableField.prototype={click:function(t,e){this.clickListeners.push([t,e])},clicked:function(t){if(!this.disabled)for(var e=0;e<this.clickListeners.length;e++)this.clickListeners[e][0].apply(this.clickListeners[e][1],[t])},setWidth:function(t){this.getJElement().width(t),this.getJElement().css({"max-width":t})},setText:function(t){this.text=t,this.getJElement().text(t)},setTitle:function(t){this.getJElement().attr("title",t)},getText:function(){return this.text},addWidget:function(){defaultArgs=[this,uniId++,arguments[0].type,"ToDo"];var t=construct(arguments[0],defaultArgs.concat(arguments[1]));return this.widgetList.push(t),t}},extend(Tabular,Table),extend(Tabular,TableRow),extend(Tabular,TableField),UiHandler.prototype={showOverlay:function(){var t=this.uiOLInt++,e=new Overlay(this.body,t,"Overlay","Overlay");return this.uiOverlays[t]=e,e},showOverlayDisp:function(){var t=this.uiOLInt++,e=new OverlayDisplay(this.body,t,"Overlay","Overlay");return this.uiOverlays[t]=e,e},uiConnect:function(t,e,i,s){var n=this.uiInstInt++,a=new UiConnector(n,t,e,i,s);this.uiConnections[n]=a},addView:function(){var t=this.viewID++;defaultArgs=[this.area,t];var e=construct(arguments[0],defaultArgs.concat(arguments[1]));return e.setVisibility(0==Object.keys(this.viewList).length?!0:!1),this.viewList[t]=e,e},addNavButton:function(t,e,i){var s=this.btnID++;void 0===e&&(e=this.area),void 0===i&&(i=NavButton);var n=construct(i,[e,s,t.name,t.describtion,t.name]);return n.click(this.selectView,this),this.btnList[s]=n,this.btnAssign[s]=t,n},selectView:function(t){for(var e in this.btnList)if(this.btnList[e].jElement.has(t.target).length){this.activateView(this.btnAssign[this.btnList[e].id]);break}},activateView:function(t){for(var e in this.viewList)this.viewList[e].id!==t.id&&this.viewList[e].setVisibility(!1);t.setVisibility(!0)}},UiConnector.prototype={setId:function(t){this.id=t},setDisabled:function(t){"function"==typeof this.widget.setDisabled&&this.widget.setDisabled(this.widget,t)},sync:function(){"Label"===this.widget.type||"_Label"===this.widget.type?this.widget.setText(this.fValue()):"Input"===this.widget.type?this.widget.setValue(this.fValue()):"Indicator"===this.widget.type&&this.widget.setText(this.fValue())},iFunction:function(){if(this.interval>0){var t=this;return window.setInterval(function(){t.sync.apply(t,[])},this.interval)}this.sync()},setUpWidgetListners:function(){"Label"===this.widget.type||"_Label"===this.widget.type||"Input"===this.widget.type},clearInterval:function(){window.clearInterval(this.iInst)},setInterval:function(){this.iInst=this.iFunction()}};var defaultVersion="1.0.0",domains=["detector","monitor","filewriter"],subdomains=["config","status","command"],detkeys={config:["keys","auto_summation","beam_center_x","beam_center_y","countrate_correction_applied","countrate_correction_bunch_mode","count_time","data_collection_date","detector_number","efficiency_correction_applied","element","flatfield_correction_applied","frame_time","nimages","number_of_excluded_pixels","photon_energy","pixel_mask_applied","sensor_material","sensor_thickness","software_version","threshold_energy","trigger_mode","virtual_pixel_correction_applied","ntrigger"],status:["keys","state"],command:["initialize","arm","disarm","trigger","cancel","abort"]},monkeys={config:["keys"],status:["keys"],command:[]},fwrkeys={config:["keys","transfer_mode","image_nr_start","mode","nimages_per_file","name_pattern","compression_enabled"],status:["keys","state","error","time","buffer_free"],command:["clear"]},stmkeys={config:["keys"],status:["keys"],command:[]},specialKeys=[{domain:"detector",subdomain:"version",versionInURI:!1},{domain:"monitor",subdomain:"version",versionInURI:!1},{domain:"filewriter",subdomain:"version",versionInURI:!1},{domain:"filewriter",subdomain:"files",versionInURI:!0},{domain:"monitor",subdomain:"images",versionInURI:!0}],keys={};keys[domains[0]]=detkeys,keys[domains[1]]=monkeys,keys[domains[2]]=fwrkeys;var excludedKeys=["clear","pixel_mask","flatfield"];EIGERQuery.prototype={setId:function(t){this.id=t},getId:function(){return this.id},getText:function(){return sprintf("[%s] %s:%s | %s | %s | %s",this.method,this.instance.superDet.address,this.instance.superDet.port,this.instance.domain.index,this.instance.subdomain.index,this.instance.index)},setStatus:function(t){this.status=t},exec:function(){0===this.status&&this.handler.execQuery(this)},deleteQ:function(){1===this.status?this.handler.abort(this):0===this.status&&this.handler.deleteQ(this),this.status=-2,this.handler.notifyQListenerUpdate(this)},setResponse:function(t){this.response=t},getResponse:function(){return this.response}},EIGERMQuery.prototype={getText:function(){return""},getProgress:function(){return this.qDone/this.qCount},getQDone:function(){return this.qDone},getQCount:function(){return this.qCount},setId:function(t){this.id=t},getId:function(){return sprintf("M%s",this.id)},setStatus:function(t){this.status=t},exec:function(){this.handler.addQueueListener(this,this.updateQ,this.newQ),this.status=1;for(var t in this.listOfQueues)this.listOfQueues[t].exec()},newQ:function(){},updateQ:function(t){this.checkQueued(t)&&(2===t.status?this.qDone++:-1===t.status&&(this.qDone++,this.status=-1),this.qDone===this.qCount&&1===this.status&&(this.status=2,this.handler.removeQueueListener(this)),this.qListener.updateCallback.apply(this.qListener.widget,[this]))},checkQueued:function(t){for(var e in this.listOfQueues)if(this.listOfQueues[e]===t)return!0;return!1},deleteQ:function(){this.status=-2;for(var t in this.listOfQueues)this.listOfQueues[t].deleteQ();this.handler.notifyQListenerUpdate(this)}},EIGERHandler.prototype={add2Queue:function(t,e){var i=this.qInstInt++;return t.setId(i),this.notifyQListenerNew(t),this.activeQueries[i]=t,e||t.exec(),t},addQueryListenerList:function(t){for(var e in t)this.qListenerList[this.qListerInt++]=t[e]},addQueueListener:function(t,e,i){var s=this.qListerInt++;this.qListenerList[s]={widget:t,newCallback:i,updateCallback:e}},abort:function(t){t.request.abort();for(var e in this.activeQueries)if(this.activeQueries[e]===t){delete this.activeQueries[e];break}},deleteQ:function(t){for(var e in this.activeQueries)if(this.activeQueries[e]===t){delete this.activeQueries[e];break}},abortAllKeyRequests:function(t){for(var e in this.activeQueries)this.activeQueries[e].instance===t&&(console.log("canceled request"),this.activeQueries[e].request.abort(),delete this.activeQueries[e])},getQueryStatusListeners:function(){return this.qListenerList},removeQueueListener:function(t){for(var e in this.qListenerList)this.qListenerList[e].widget===t&&delete this.qListenerList[e]},removeAllQueryStatusListeners:function(){this.qListenerList=[],this.qListerInt=0},notifyQListenerNew:function(t){for(var e in this.qListenerList)void 0!==this.qListenerList[e].newCallback&&this.qListenerList[e].newCallback.apply(this.qListenerList[e].widget,[t])},notifyQListenerUpdate:function(t){for(var e in this.qListenerList)this.qListenerList[e].updateCallback.apply(this.qListenerList[e].widget,[t])},execQuery:function(t){t.setStatus(1),this.notifyQListenerUpdate(t);var e=this;if(t.instance.versionInURI===!0)var i=sprintf("http://%s:%s/%s/api/%s/%s/%s",t.instance.superDet.address,t.instance.superDet.port,t.instance.domain.index,t.instance.superDet.version,t.instance.subdomain.index,t.instance.index);else var i=sprintf("http://%s:%s/%s/api/%s/%s",t.instance.superDet.address,t.instance.superDet.port,t.instance.domain.index,t.instance.subdomain.index,t.instance.index);switch(t.startTime=(new Date).getTime(),t.instance.index){case"trigger":var s=2e3*(t.instance.superDet.detector.config.frame_time.value.value*t.instance.superDet.detector.config.nimages.value.value+10);console.log(sprintf("Setting timeout %s ms (%s)...",s,t.instance.index));break;case"arm":case"initialize":var s=33e4;console.log(sprintf("Setting timeout %s ms (%s)...",s,t.instance.index));break;default:var s=6e4}t.request=$.ajax({url:i,type:t.method,contentType:"application/json",timeout:s,data:t.data}),t.request.done(function(i){e.sucess.apply(e,[t,i])}),t.request.fail(function(i){e.error.apply(e,[t,i])})},sucess:function(t,e){t.setStatus(2),t.endTime=(new Date).getTime(),t.setResponse(e),this.notifyQListenerUpdate(t),this.history++,delete this.activeQueries[t.id]},error:function(t,e){t.setResponse(e),t.setStatus(-1),this.notifyQListenerUpdate(t),this.history[t.id]=t,this.history++,delete this.activeQueries[t.id]}},EIGERContainer.prototype={addChilds:function(t){for(var e={},i=0;i<t.length;i++){var s=this.constructChild(t[i]);e[t[i]]=s,this[t[i]]=s}return e},refresh:function(t,e){this.refreshListeners.push([t,e])},refreshed:function(t){for(var e=0;e<this.refreshListeners.length;e++)this.refreshListeners[e][0].apply(this.refreshListeners[e][1],[t])},queueQuery:function(t,e,i){return this.superDet.handler.add2Queue(new EIGERQuery(this,this.superDet.handler,t,e),i)},queueGetQuery:function(t){return this.queueQuery("GET","",t)},queuePutQuery:function(t,e){return this.queueQuery("PUT",t,e)},queueDeleteQuery:function(t){return this.queueQuery("DELETE","",t)},update:function(t){if(!(this instanceof EIGERKey||this instanceof EIGERSpecialKey)){var e=[];for(var i in this.children){var s=this.children[i].update(t);void 0!==s&&(e=e.concat(s))}return e}return"w"!==this.access_mode.value?[this.queueGetQuery(t)]:void 0}},EIGER.prototype={constructChild:function(t){return new EIGERDomain(this,t)},setHost:function(t,e){this.address=t,this.port=e},setVersion:function(t){this.version=t},updateQItem:function(t){2===t.status&&t.instance.updateValues(t.getResponse(t))},unbind:function(){this.handler.removeQueueListener(this)}},EIGERDomain.prototype={constructChild:function(t){return new EIGERSubDomain(this.superDet,this,t)}},EIGERSubDomain.prototype={constructChild:function(t){return new EIGERKey(this.superDet,this.domain,this,t)}},EIGERKey.prototype={constructChild:function(t,e){var i=new EIGERValue(this.superDet,this.domain,this.subdomain,this,t,e);this.children[t]=i,this[t]=i},updateKey:function(t){return"w"!==this.access_mode.value?this.queueGetQuery(t):void 0},updateValues:function(t){if("keys"===this.index)for(var e in t){var i=!1;for(var s in keys[this.domain.index][this.subdomain.index])if(keys[this.domain.index][this.subdomain.index][s]===t[e]){i=!0;break}i||inExcludedKeys(t[e])||keys[this.domain.index][this.subdomain.index].push(t[e])}for(var n in t)void 0!==this[n]?this[n].value=t[n]:this.constructChild(n,t[n]);this.refreshed()},setValue:function(t,e){return this.queuePutQuery(JSON.stringify({value:t}),e)}},EIGERSpecialKey.prototype={constructChild:function(t,e){var i=new EIGERValue(this.superDet,this.domain,this.subdomain,this,t,e);this.children[t]=i,this[t]=i},updateKey:function(t){return"w"!==this.access_mode.value?this.queueGetQuery(t):void 0},updateValues:function(t){if("value"in t)for(var e in t)void 0!==this[e]?this[e].value=t[e]:this.constructChild(e,t[e]);else{var e="value";void 0!==this[e]?this[e].value=t:this.constructChild(e,t)}this.refreshed()},setValue:function(t,e){this.queuePutQuery(JSON.stringify({value:t}),e)}},EIGERValue.prototype={update:function(t){this.key.update(t)}},extend(EIGERContainer,EIGER),extend(EIGERContainer,EIGERDomain),extend(EIGERContainer,EIGERSubDomain),extend(EIGERContainer,EIGERKey),extend(EIGERContainer,EIGERSpecialKey),EIGERConSet.prototype={connect:function(){this.eUi.connect(this.inp01.getValue(),this.inp02.getValue())},disconnect:function(){alert("Not Implemented!")}},EIGERAcqSet.prototype={acquire:function(){"idle"!==this.eUi.e.detector.status.state.value.value?alert("Detector is not in idle state, will not start exposure.\n\nPlease disarm detector or abort exposure."):this.advMode?new EIGERExp(this.ui,this.eUi,"advExpose"):new EIGERExp(this.ui,this.eUi,"expose")},toggleAdvanced:function(){this.advMode||2!==this.eUi.e.connectionStateID?this.disableAdvMode():this.enableAdvMode()},enableAdvMode:function(){this.setAdvModeElVisibility(!0)},disableAdvMode:function(){this.cmd01=new EIGERSubseqCmdPrompt(this.ui.body,0,"EHC","EIGER Command Handler",this.eUi,{success:[this.success,this,[]],error:[function(){},this,[]]}),this.cmd01.setTitle("Preparing standard user mode..."),this.cmd01.setHeight("140px"),this.cmd01.addQObj(this.eUi.e.detector.config.ntrigger.setValue(1)),this.cmd01.addQObj(this.eUi.e.detector.config.flatfield_correction_applied.setValue(!0)),this.cmd01.addQObj(this.eUi.e.detector.config.countrate_correction_applied.setValue(!0)),this.cmd01.addQObj(this.eUi.e.detector.config.trigger_mode.setValue("ints")),this.cmd01.addQObj(this.eUi.e.filewriter.config.mode.setValue("enabled")),this.cmd01.addQObj(this.eUi.e.filewriter.config.name_pattern.setValue(sprintf("BRUENIG_%s_$id",(new Date).toISOString().slice(0,10)))),this.setAdvModeElVisibility(!1)},addAdvWidget:function(t){this.advWidgets.push(t)},setAdvModeElVisibility:function(t){this.advMode=t;for(var e in this.advWidgets)this.advWidgets[e].setVisibility(t);this.chk04.setValue(t)},init:function(){new EIGERExp(this.ui,this.eUi,"initialize")},disarm:function(){new EIGERExp(this.ui,this.eUi,"disarm")},abort:function(){new EIGERExp(this.ui,this.eUi,"abort")},customQ:function(){this.cmd01=new EIGERCustomCmdPrompt(this.ui.body,0,"EHC","EIGER Command Handler",this.eUi,{success:[this.success,this,[]],error:[function(){},this,[]]})},cmdI:function(){this.cmd02=new EIGERCmdInformation(this.ui.body,0,"EHC","EIGER Command Handler",this.eUi)},success:function(){this.cmd01=""}},EIGERExp.prototype={getView:function(t){for(var e in this.ui.viewList)if(this.ui.viewList[e].name===t)return this.ui.viewList[e]},switchView:function(t){this.ui.activateView(t)},success:function(){this.cmd01.getJElement().remove(),this.cmd01.btn01.getJElement().remove(),dView=this.getView(this.endView),this.switchView(dView)},abortSuccess:function(t){alert(sprintf("%s\n\n%s","Failed to execute an exposure.",t.statusText)),this.cmd01="",this.switchView(this.getView("Acquire"))},error:function(){this.cmd01.getJElement().remove(),this.cmd01.btn01.getJElement().remove(),this.cmd01=new EIGERSubseqCmdPrompt(this.ui.body,0,"EHC","EIGER Command Handler",this.eUi,{success:[this.abortSuccess,this,[]],error:[function(){},this,[]]}),this.cmd01.setTitle("Recovering detector state..."),this.cmd01.setHeight("35px"),this.cmd01.addCmd(this.eUi.e.detector.command.abort,["PUT",""])}},EIGERData.prototype={getView:function(t){for(var e in this.ui.viewList)if(this.ui.viewList[e].name===t)return this.ui.viewList[e]},switchView:function(t){this.ui.activateView(t)}},EIGERAcq.prototype={},EIGERLog.prototype={},EIGERHelp.prototype={},extend(ContainerArea,EIGERConSet),extend(ContainerArea,EIGERAcqSet),extend(ContainerArea,EIGERAcq),extend(ContainerArea,EIGERData),extend(ContainerArea,EIGERLog),extend(ContainerArea,EIGERHelp),EIGERDataLogger.prototype={setValue:function(t){var e=[];for(var i in this.rows)t.indexOf(this.rows[i].fileName)<0&&this.updateQItem(i,"deleted"),e.push(this.rows[i].fileName);for(var s in t)e.indexOf(t[s])<0&&this.newQItem(t[s])},updateQItem:function(t,e){switch(e){case"new":this.rows[t].tfd03.ind01.setText("new"),this.rows[t].tfd03.ind01.ok();break;case"downloaded":this.rows[t].tfd03.ind01.setText("downloaded"),this.rows[t].tfd03.ind01.grey();break;case"deleted":this.rows[t].tfd03.ind01.setText("deleted"),this.rows[t].tfd03.ind01.error();var i=this;this.rows[t].getJElement().delay(1e3).slideUp(200,function(){i.rows[t].getJElement().remove(),delete i.rows[t]});break;case"deleting":this.rows[t].tfd03.ind01.setText("deleting"),this.rows[t].tfd03.ind01.warning()}this.rows[t].status=e},newQItem:function(t){var e=this.ids++;this.rows[e]=this.table.addWidget(EIGERDataTableRow,[]),this.rows[e].fileName=t,this.rows[e].tfd01.setText(e),this.rows[e].tfd02.setText(t),this.rows[e].tfd04.setText("");var i=this;this.rows[e].tfd04.btn01=this.rows[e].tfd04.addWidget(Button,["download"]),this.rows[e].tfd04.btn01.click(function(){i.getData(e)},this),this.rows[e].tfd04.btn02=this.rows[e].tfd04.addWidget(Button,["x"]),this.rows[e].tfd04.btn02.click(function(){i.delData(e)},this),this.updateQItem(e,"new")},getData:function(t){window.location=sprintf("http://%s:%s/data/%s",this.eUi.e.address,this.eUi.e.port,this.rows[t].fileName),this.updateQItem(t,"downloaded")},delData:function(t){if(confirm(sprintf("Do you really want to delete the file %s on the detector control unit.",this.rows[t].fileName))){var e=this;$.ajax({url:sprintf("http://%s:%s/data/%s",this.eUi.e.address,this.eUi.e.port,this.rows[t].fileName),type:"delete",contentType:"application/json",success:function(){this.updateQItem.apply(e,[t,"deleting"])},error:function(){alert("Could not delete file.")}})}}},EIGERCmdLogger.prototype={updateQItem:function(t){var e=t.getId(),i=this;0===t.status?(this.rows[e].tfd03.ind01.setText("queued"),this.rows[e].tfd03.ind01.grey()):1===t.status?(this.rows[e].tfd03.ind01.setText("sent"),this.rows[e].tfd03.ind01.warning()):2===t.status?(this.rows[e].tfd03.ind01.setText("sucess"),this.rows[e].tfd03.ind01.ok(),this.rows[e].getJElement().delay(500).slideUp(100,function(){i.rows[e].getJElement().remove(),i.rows[e]=void 0,delete i.rows[e]})):t.status<0&&void 0!==this.rows[e]&&(this.rows[e].tfd03.ind01.setText("error"),this.rows[e].tfd03.ind01.error(),t.response&&(this.rows[e].tfd04.setText(t.response.statusText),this.rows[e].tfd04.setTitle(t.response.statusText)),this.rows[e].getJElement().delay(500).slideUp(100,function(){i.rows[e].getJElement().remove(),i.rows[e]=void 0,delete i.rows[e],t.deleteQ()}))},newQItem:function(t){var e=t.getId();this.rows[e]=this.table.addWidget(EIGERTableRow,[]);var i=this;this.rows[e].tfd01.setText(e),this.rows[e].tfd01.click(function(){i.showCmdInformation.apply(i,[t])},this),this.rows[e].tfd02.setText(t.getText()),this.rows[e].tfd02.click(function(){i.showCmdInformation.apply(i,[t])},this),this.rows[e].tfd04.setText(""),this.updateQItem(t)},showCmdInformation:function(t){var e=new EIGERCmdInformation(this.eUi.ui.body,0,"EHC","EIGER Command Information",this.eUi);e.setQ(t)}},EIGERCmdDisplay.prototype={newQItem:function(t){var e=t.getId();this.rows[e]=this.table.addWidget(EIGERTableRow,[]),this.rows[e].tfd01.setText(e),this.rows[e].tfd02.setText(t.getText()),this.rows[e].tfd04.setText("")}},EIGERCustomCmdPrompt.prototype={_done:function(){this.closeDone&&this.close()},_fail:function(){alert("Failed to execute queue...")},addOptions:function(t,e){var i=[];for(var s in e)i.push(e[s].name);t.addOptions(i),t.setValue("")},changeModule:function(){this.enableAllModes(),this.btn01.setDisabled(!0),this.sel03.empty(),this.sel03.setDisabled(!1),this.sel04.empty(),this.sel04.setDisabled(!0),this.addOptions(this.sel03,this.eUi.e[this.sel02.getValue()].children)},changeTask:function(){this.enableAllModes(),this.btn01.setDisabled(!0),this.sel04.setDisabled(!0),this.sel04.empty(),this.eUi.e[this.sel02.getValue()][this.sel03.getValue()]instanceof EIGERSubDomain?(this.addOptions(this.sel04,this.eUi.e[this.sel02.getValue()][this.sel03.getValue()].children),this.sel04.setDisabled(!1)):this.eUi.e[this.sel02.getValue()][this.sel03.getValue()]instanceof EIGERSpecialKey&&(this.enableMode(this.eUi.e[this.sel02.getValue()][this.sel03.getValue()].access_mode.value),this.sel04.setDisabled(!0),this.btn01.setDisabled(!1))},changeKey:function(){this.enableMode(this.eUi.e[this.sel02.getValue()][this.sel03.getValue()][this.sel04.getValue()].access_mode.value),"PUT"===this.sel01.getValue()&&this.inp01.setDisabled(!1),this.btn01.setDisabled(!1)},changeMethod:function(){switch(this.sel01.getValue()){case"PUT":this.inp01.setDisabled(!1);break;case"GET":default:this.inp01.setDisabled(!0)}},changeMode:function(){this.inp01.setDisabled(!1)},close:function(){1===this.cmd01.status?this.cmd01.cancel():this.remove()},enableAllModes:function(){var t=this.sel01.jInput.find("option");t.each(function(){$(this).prop("disabled",!1)})},enableMode:function(t){var e=this.sel01.jInput.find("option"),i=this;e.each(function(){var e=!0;if(t.search("r")>=0&&"GET"===$(this).text()&&(e=!1),t.search("w")>=0&&"PUT"===$(this).text()&&(e=!1),$(this).prop("disabled",e),e&&$(this).prop("selected")){var s=i.sel01.jInput.find("option:enabled").first();s.each(function(){i.sel01.setValue($(this).val()),i.changeMethod.apply(i,[])})}})},startQ:function(){this.btn02.setVisibility(!1),this.frm01.setVisibility(!1),this.cmd01.exec()},submit:function(){var t=this.eUi.e[this.sel02.getValue()][this.sel03.getValue()],e=t instanceof EIGERSpecialKey?t:t[this.sel04.getValue()],i=this.chk01.getValue()?this.cmd01.EXEC_CLICK:this.cmd01.EXEC_IMMED;switch(this.sel01.getValue()){case"GET":this.addQObj(e.updateKey(!0),i);break;case"PUT":this.addQObj(e.setValue(this.inp01.getValue(),!0),i)}this.btn02.setDisabled(!1)},addCmd:function(){this.cmd01.addCmd.apply(this.cmd01,arguments)},addQObj:function(){this.cmd01.addQObj.apply(this.cmd01,arguments)},addMCmd:function(){this.cmd01.addMCmd.apply(this.cmd01,arguments)},exec:function(){this.cmd01.exec.apply(this.cmd01,arguments)},setTitle:function(){this.tlt01.setText.apply(this.tlt01,arguments)},setHeight:function(){this.cmd01.setHeight.apply(this.cmd01,arguments)}},extend(OverlayDisplay,EIGERCustomCmdPrompt),EIGERCmdInformation.prototype={close:function(){this.remove()},setQ:function(t){if(this.qInstance=t,this.qInstance.instance.versionInURI===!0)var e=sprintf("http://%s:%s/%s/api/%s/%s/%s",this.qInstance.instance.superDet.address,this.qInstance.instance.superDet.port,this.qInstance.instance.domain.index,this.qInstance.instance.superDet.version,this.qInstance.instance.subdomain.index,this.qInstance.instance.index);else var e=sprintf("http://%s:%s/%s/api/%s/%s",this.qInstance.instance.superDet.address,this.qInstance.instance.superDet.port,this.qInstance.instance.domain.index,this.qInstance.instance.subdomain.index,this.qInstance.instance.index);this.lbl01.setText(e),this.update()},update:function(){this.tbr02.tfd02.setText(this.qInstance.instance.superDet.address),this.tbr03.tfd02.setText(this.qInstance.instance.superDet.port),this.tbr04.tfd02.setText(this.qInstance.instance.domain.index);try{this.tbr05.tfd02.setText(this.qInstance.instance.domain.version.value.value)}catch(t){this.tbr05.tfd02.setText("not yet available...")}switch(this.tbr06.tfd02.setText(this.qInstance.instance.subdomain.index),this.tbr07.tfd02.setText(this.qInstance.instance.index),this.tbr08.tfd02.setText(this.qInstance.data),this.tbr08.tfd02.setTitle(this.qInstance.data),this.qInstance.status){case 0:this.tbr02.tfd04.setText("n/a"),this.tbr03.tfd04.setText("Queued"),this.tbr08.tfd04.setText("n/a"),this.tbr10.tfd02.setText("n/a"),this.tbr10.tfd04.setText("n/a"),this.tbr11.tfd02.setText("n/a");break;case 1:this.tbr02.tfd04.setText("n/a"),this.tbr03.tfd04.setText("Sent"),this.tbr08.tfd04.setText("n/a"),this.tbr10.tfd02.setText(msToISO(this.qInstance.startTime)),this.tbr10.tfd04.setText("n/a"),this.tbr11.tfd02.setText("n/a");break;case 2:this.btn01.setDisabled(!0),this.tbr02.tfd04.setText(this.qInstance.request.status),this.tbr03.tfd04.setText(this.qInstance.request.statusText),this.tbr08.tfd04.setText(this.qInstance.request.responseText),this.tbr08.tfd04.setTitle(this.qInstance.request.responseText),this.tbr10.tfd02.setText(msToISO(this.qInstance.startTime)),this.tbr10.tfd04.setText(msToISO(this.qInstance.endTime)),this.tbr11.tfd02.setText(sprintf("%s ms",this.qInstance.endTime-this.qInstance.startTime));break;default:this.btn01.setDisabled(!0);try{this.tbr02.tfd04.setText(this.qInstance.request.status),this.tbr03.tfd04.setText(this.qInstance.request.statusText),this.tbr03.tfd04.setTitle(this.qInstance.request.statusText),this.tbr08.tfd04.setText(this.qInstance.request.responseText),this.tbr08.tfd04.setTitle(this.qInstance.request.responseText)}catch(t){this.tbr02.tfd04.setText("n/a"),this.tbr03.tfd04.setText("error"),this.tbr08.tfd04.setText("n/a")}try{this.tbr10.tfd02.setText(msToISO(this.qInstance.startTime))}catch(t){this.tbr10.tfd02.setText("n/a")}try{this.tbr10.tfd04.setText(msToISO(this.qInstance.endTime)),this.tbr11.tfd02.setText(sprintf("%s ms",this.qInstance.endTime-this.qInstance.startTime))}catch(t){this.tbr10.tfd04.setText("n/a"),this.tbr11.tfd02.setText("n/a")}}},setTitle:function(){this.tlt01.setText.apply(this.tlt01,arguments)},setHeight:function(){this.cmd01.setHeight.apply(this.cmd01,arguments)}},extend(OverlayDisplay,EIGERCmdInformation),EIGERSubseqCmdPrompt.prototype={addCmd:function(){this.cmd01.addCmd.apply(this.cmd01,arguments)},addQObj:function(){this.cmd01.addQObj.apply(this.cmd01,arguments)},addMCmd:function(){this.cmd01.addMCmd.apply(this.cmd01,arguments)},exec:function(){this.cmd01.exec.apply(this.cmd01,arguments)},setTitle:function(){this.tlt01.setText.apply(this.tlt01,arguments)},setHeight:function(){this.cmd01.setHeight.apply(this.cmd01,arguments)},_done:function(t){this.callback.success[0].apply(this.callback.success[1],[t].concat(this.callback.success[2])),this.closeDone&&this.remove()},_fail:function(t){this.callback.error[0].apply(this.callback.error[1],[t].concat(this.callback.error[2])),this.closeDone&&this.remove()}},extend(OverlayDisplay,EIGERSubseqCmdPrompt),EIGERSubseqCmdHandler.prototype={EXEC_IMMED:0,EXEC_EXT:1,EXEC_CLICK:2,EXEC_ICLICK:3,ENDING_COMMAND:!0,NONENDING_COMMAND:!1,addCmd:function(t,e,i,s){void 0===i&&(i=this.EXEC_IMMED),this.addQObj(t.queueQuery.apply(t,e),i,s)},addQObj:function(t,e,i){this.listOfQueues.push({qObject:t,execStyle:e,endingCommand:i}),this.newQItem(t)},addMCmd:function(t,e,i){void 0===e&&(e=this.EXEC_IMMED);var s=new EIGERMQuery(this.eUi.eHandler,t,this,this.newMQItem,this.updateMQItem);s.setId(this.mQIter++),this.listOfQueues.push({qObject:s,execStyle:e,endingCommand:i}),this.newMQItem(s)},cancel:function(){confirm('Do you really want to cancel current operation, this might cause invalid states. Press "ok" to cancel.')&&(this.status=-2,this.end())},exec:function(){var t=this.eIter++;if(void 0===this.listOfQueues[t]){var e=!0;
for(var i in this.listOfQueues)if(2!==this.listOfQueues[i].qObject.status){e=!1;break}e&&this.end()}else if(0===this.listOfQueues[t].qObject.status)switch(this.listOfQueues[t].execStyle){default:case this.EXEC_IMMED:this.listOfQueues[t].qObject.exec();break;case this.EXEC_CLICK:case this.EXEC_ICLICK:var s=this.listOfQueues[t].qObject.getId();this.rows[s].btn01.setDisabled(!1)}else this.exec()},end:function(){if(this.eUi.removeQueryStatusListener(this),this.status<0){console.log("Aborting Queue due to previous error.");for(t in this.listOfQueues)this.listOfQueues[t].qObject.deleteQ()}if(this.status<0)this.callbackList.error[0].apply(this.callbackList.error[1],[this].concat(this.callbackList.error[2]));else{for(var t in this.listOfQueues)2!==this.listOfQueues[t].qObject.status&&this.listOfQueues[t].qObject.deleteQ();this.callbackList.success[0].apply(this.callbackList.success[1],[this].concat(this.callbackList.success[2]))}for(t in this.rows)delete this.rows[t]},updateQItem:function(t){var e=this.checkQueued(t);if(e){var i=t.getId();0===t.status?(this.rows[i].tfd03.ind01.setText("queued"),this.rows[i].tfd03.ind01.grey()):1===t.status?(this.status>-1&&(this.status=1),this.rows[i].tfd03.ind01.setText("sent"),this.rows[i].tfd03.ind01.warning(),(e.execStyle===this.EXEC_CLICK||e.execStyle===this.EXEC_ICLICK)&&this.rows[i].btn01.remove()):2===t.status?(this.rows[i].tfd03.ind01.setText("sucess"),this.rows[i].tfd03.ind01.ok(),e.endingCommand===this.ENDING_COMMAND?this.end():(this.status=2,this.exec())):t.status<0&&this.status>=0&&(this.statusText=t.response.statusText,this.status=t.status,this.rows[i].tfd03.ind01.setText("error"),this.rows[i].tfd03.ind01.error(),this.rows[i].tfd04.setText(this.statusText),this.rows[i].tfd04.setTitle(this.statusText),this.end())}},newQItem:function(t){var e=this.checkQueued(t);if(e){var i=t.getId();this.rows[i]=this.table.addWidget(EIGERTableRow,[]),this.rows[i].tfd01.setText(i);var s=this;this.rows[i].tfd01.click(function(){s.showCmdInformation.apply(s,[t])},this),this.rows[i].tfd02.setText(t.getText()),this.rows[i].tfd02.click(function(){s.showCmdInformation.apply(s,[t])},this),this.rows[i].tfd04.setText(""),(e.execStyle===this.EXEC_CLICK||e.execStyle===this.EXEC_ICLICK)&&(this.rows[i].btn01=this.rows[i].tfd04.addWidget(Button,["exec"]),this.rows[i].btn01.click(t.exec,t),e.execStyle===this.EXEC_CLICK&&this.rows[i].btn01.setDisabled(!0)),this.updateQItem(t)}},showCmdInformation:function(t){var e=new EIGERCmdInformation(this.eUi.ui.body,0,"EHC","EIGER Command Information",this.eUi);e.setQ(t)},updateMQItem:function(t){var e=t.getId();0===t.status?(this.rows[e].tfd03.ind01.setText("queued"),this.rows[e].tfd03.ind01.grey()):1===t.status?(this.status>-1&&(this.status=1),this.rows[e].tfd03.ind01.setText(sprintf("%s/%s",t.getQDone(),t.getQCount())),this.rows[e].tfd02.prb01.setProgress(t.getProgress()),this.rows[e].tfd03.ind01.warning()):2===t.status?(this.rows[e].tfd03.ind01.setText("sucess"),this.rows[e].tfd03.ind01.ok(),this.exec()):t.status<0&&this.status>=0&&(this.rows[e].tfd02.prb01.setProgress(t.getProgress()),this.rows[e].tfd03.ind01.setText("error"),this.rows[e].tfd03.ind01.error(),this.rows[e].tfd04.setText("An error occured."),this.rows[e].tfd04.setTitle("An error occured."),this.status=t.status,this.end())},newMQItem:function(t){var e=t.getId();this.rows[e]=this.table.addWidget(EIGERTableMCRow,[t]),this.rows[e].tfd01.setText(t.getId()),this.rows[e].tfd04.setText(""),this.updateMQItem(t)},checkQueued:function(t){for(var e in this.listOfQueues)if(this.listOfQueues[e].qObject===t)return this.listOfQueues[e];return!1}},extend(BlockArea,EIGERDataLogger),extend(BlockArea,EIGERCmdLogger),extend(EIGERCmdLogger,EIGERCmdDisplay),extend(EIGERCmdLogger,EIGERSubseqCmdHandler),EIGERTableRow.prototype={},EIGERTableMCRow.prototype={},EIGERTableMCRow.prototype={},extend(TableRow,EIGERTableRow),extend(EIGERTableRow,EIGERTableMCRow),extend(EIGERTableRow,EIGERDataTableRow);var fu=0;EIGERUiHandler.prototype={_checkConnection:function(t,e,i,s){console.log(sprintf("Checking connection to %s:%s...",t,e)),""==e&&(e=80),""!=t&&this.e.setHost(t,e);var n={success:[this._checkConSuccess,this,[t,e,s]],error:[this._checkConError,this,[]]};this.cmd01=new EIGERSubseqCmdPrompt(this.ui.body,0,"EHC","EIGER Command Handler",this,n),this.cmd01.setTitle(sprintf("Trying to connect to %s:%s",t,e)),this.cmd01.setHeight("180px"),this.cmd01.addCmd(this.e.detector.config.keys,["GET",""]),this.cmd01.addCmd(this.e.detector.status.keys,["GET",""]),this.cmd01.addCmd(this.e.filewriter.config.keys,["GET",""]),this.cmd01.addCmd(this.e.filewriter.status.keys,["GET",""]),this.cmd01.addCmd(this.e.monitor.config.keys,["GET",""]),this.cmd01.addCmd(this.e.monitor.status.keys,["GET",""])},_checkConSuccess:function(t,e,i,s){var n=t.listOfQueues[1].qObject.endTime-t.listOfQueues[0].qObject.startTime;this.refInterval=3*(n+1e3),console.log(sprintf("Requests took %s ms to complete. Using %s ms as reference interval setting.",n,this.refInterval)),this.cmd01="",this.e.unbind(),this.e=new EIGER(e,i,this.eHandler),this.updateUiConnections(),this._connect(e,i,s)},_checkConError:function(t){this.cmd01="",alert(sprintf("%s\n\n%s","Failed to connect to detector.",t.statusText))},_connect:function(t,e,i){var s=sprintf("Connecting to %s:%s...",t,e);if(console.log(s),i&&console.log(sprintf("Retrying after initalize...")),i){var n={success:[this.connectSuccess,this,[]],error:[this.connectError,this,[]]};cmdHeight="70px"}else{var n={success:[this.connectSuccess,this,[]],error:[this.connectErrorInit,this,[t,e,i]]};cmdHeight="40px"}this.cmd01=new EIGERSubseqCmdPrompt(this.ui.body,0,"EHC","EIGER Command Handler",this,n),this.cmd01.setTitle(s),this.cmd01.setHeight(cmdHeight),i===!0&&this.cmd01.addCmd(this.e.detector.command.initialize,["Put","",!0]),this.cmd01.addMCmd([this.e.update,[this.e,!0]]),this.cmd01.exec()},connect:function(t,e,i){""==e&&(e=80),""!=t&&this.e.setHost(t,e),this._checkConnection(t,e,!0,i)},connectSuccess:function(){this.cmd01="",this.setUpInterval(),this.e.connectionStateID=2;var t=this.getView("Acquire");this.switchView(t),this.ui.acq.disableAdvMode(),this.ui.acq.chk04.setDisabled(!1)},connectError:function(t){alert(sprintf("%s\n\n%s","Failed to connect to detector.",t.statusText)),this.cmd01=""},connectErrorInit:function(t,e,i){this.cmd01="",confirm("Could not connect to detector system.\n\nThis can be caused by the detector not being initialized. Would you like initializing the detector system and retry?")&&this._connect(e,i,!0)},getView:function(t){for(var e in this.ui.viewList)if(this.ui.viewList[e].name===t)return this.ui.viewList[e]},switchView:function(t){this.ui.activateView(t)},sync:function(){for(var t in this.uiConnections)this.uiConnections[t].sync()},setUpInterval:function(){for(var t in this.uiConnections)this.uiConnections[t].setInterval()},uiConnect:function(t,e,i,s){var n=this.uiInstInt++,a=new EIGERUiConnector(this,n,t,e,i,s);this.uiConnections[n]=a},updateUiConnections:function(){for(var t in this.uiConnections){var e=this.uiConnections[t].eigerValue.refreshListeners;this.uiConnections[t].eigerValue=this.uiConnections[t].eigerValue instanceof EIGERKey?this.e[this.uiConnections[t].eigerValue.domain.index][this.uiConnections[t].eigerValue.subdomain.index][this.uiConnections[t].eigerValue.index]:this.e[this.uiConnections[t].eigerValue.domain.index][this.uiConnections[t].eigerValue.subdomain.index],this.uiConnections[t].eigerValue.refreshListeners=e}},addQueryStatusListener:function(t,e,i){this.eHandler.addQueueListener(i,t,e)},addQueryListenerList:function(t){this.eHandler.addQueryListenerList(t)},getQueryStatusListeners:function(){return this.eHandler.getQueryStatusListeners()},removeQueryStatusListener:function(t){this.eHandler.removeQueueListener(t)},removeAllQueryStatusListeners:function(){this.eHandler.removeAllQueryStatusListeners()}},EIGERUiConnector.prototype={setId:function(t){this.id=t},setDisabled:function(t){"function"==typeof this.widget.setDisabled&&this.widget.setDisabled(t)},sync:function(){switch(this.widget.type){case"Label":case"_Label":this.widget.setText(this.eigerValue.value.value);break;case"Select":0===this.widget.length&&this.widget.addOptions(this.eigerValue.allowed_values.value);case"Input":this.widget.setValue(this.eigerValue.value.value);break;case"Indicator":this.widget.setText(this.eigerValue.value.value),$.inArray(this.eigerValue.value.value,this.eigerValue.critical_values.value.push("error"))>-1?this.widget.error():$.inArray(this.eigerValue.value.value,["initialize","configure","acquire","test"])>-1?this.widget.warning():$.inArray(this.eigerValue.value.value,["ready","idle"])>-1?this.widget.ok():this.widget.grey();break;default:this.widget.setValue(this.eigerValue.value.value)}},clearInterval:function(){window.clearInterval(this.iInst);for(var t in this.eUi.listOfSyncedKeys)if(this.eUi.listOfSyncedKeys[t][0]===this.eigerValue){delete this.eUi.listOfSyncedKeys[t];break}},setInterval:function(){this.iInst=this.iFunction(),this.setDisabled(!1)},iFunction:function(){var t=this;for(var e in this.eUi.listOfSyncedKeys)if(this.eUi.listOfSyncedKeys[e][0]===this.eigerValue){var i=e;break}if(void 0===i){var s=window.setInterval(function(){t.eigerValue.update.apply(t.eigerValue,[])},this.interval*this.eUi.refInterval);return this.eUi.listOfSyncedKeys.push([this.eigerValue,s]),s}return this.eUi.listOfSyncedKeys[i][1]},setUpWidgetListners:function(){var t=this;this.eigerValue.refresh(this.sync,this),"Label"===this.widget.type||"_Label"===this.widget.type||("Input"===this.widget.type?(this.widget.jInput.focus(function(){t.clearInterval(),t.eUi.eHandler.abortAllKeyRequests(t.eigerValue),void 0!==t.form&&(t.formAction=t.form.getSubmit(),t.form.clearSubmit(),t.form.submit(t.setValueSubmit,t))}),this.widget.jInput.focusout(function(){t.setValue.apply(t,[]),t.form.setSubmitListeners(t.formAction)})):("CheckBox"===this.widget.type||"Select"===this.widget.type)&&this.widget.jInput.change(function(){t.setValue.apply(t,[])}))},setValueSubmit:function(){this.setValue(!0)},setValue:function(t){var e=this.widget.getValue()==this.eigerValue.value.value?!1:!0;e?(console.log(sprintf("Changed %s to: %s (from: %s)",this.eigerValue.index,this.widget.getValue(),this.eigerValue.value.value)),this.cmd01=new EIGERSubseqCmdPrompt(this.eUi.ui.body,0,"EHC","EIGER Command Handler",this.eUi,{success:[this.putSuccess,this,[t]],error:[this.putError,this,[]]}),this.cmd01.setTitle(sprintf("Updating value %s...",this.eigerValue.index)),this.cmd01.setHeight("35px"),this.cmd01.addQObj(this.eigerValue.setValue(this.widget.getValue()))):(console.log(sprintf("Unchanged value %s (%s, from: %s)",this.eigerValue.index,this.widget.getValue(),this.eigerValue.value.value)),t&&(this.reattachSubmit(),this.form.submitted())),this.setInterval()},getSuccess:function(t,e){this.cmd01="",e&&(this.reattachSubmit(),this.form.submitted())},reattachSubmit:function(){this.formAction.length>0&&void 0!==this.form&&this.form.setSubmitListeners(this.formAction)},putError:function(t){alert(sprintf("Error while executing request.\n\n%s"),t.statusText),this.cmd01="",this.cmd01=new EIGERSubseqCmdPrompt(this.eUi.ui.body,0,"EHC","EIGER Command Handler",this.eUi,{success:[this.error,this,[]],error:[this.error,this,[]]}),this.cmd01.setTitle(sprintf("Recovering value %s...",this.eigerValue.index)),this.cmd01.setHeight("35px"),this.cmd01.addCmd(t.listOfQueues[0].qObject.instance,["GET",""])},error:function(){this.cmd01="",this.reattachSubmit()},putSuccess:function(t,e){this.cmd01="";var i=t.listOfQueues[0].qObject.response,s=t.listOfQueues[0].qObject.instance.domain.index,n=t.listOfQueues[0].qObject.instance.subdomain.index;if(!isNaN(Number(i.length))&&i.length>0){console.log(sprintf("Refreshing dependent keys %s:%s:%s...",s,n,i.join())),this.cmd01=new EIGERSubseqCmdPrompt(this.eUi.ui.body,0,"EHC","EIGER Command Handler",this.eUi,{success:[this.getSuccess,this,[e]],error:[this.error,this,[]]}),this.cmd01.setTitle(sprintf("Refreshing dependent keys (%s)...",this.eigerValue.index));var a=sprintf("%spx",30*i.length);this.cmd01.setHeight(a);for(var h=0;h<i.length;h++)inExcludedKeys(i[h])||this.cmd01.addCmd(this.eUi.e[s][n][i[h]],["GET",""])}}};var clientVersion="1.3.0T1",uniId=0;$(document).ready(function(){var t=new BodyArea(uniId++),e=new AreaResizer,i=new PlacementArea(t,uniId++,"xx","xx");i.setWidth("900px"),i.setHeight("223px"),i.setOffset({top:"10",left:"10"}),e.resizeOffset(i.setOffset,i,"left",["mid",-457],-7);var s=new PlacementArea(t,uniId++,"xx","xx");s.setWidth("173px"),s.setHeight("40px"),s.setOffset({top:"3",left:"30"}),e.resizeOffset(s.setOffset,s,"left",["mid",-437],13);var n=new PlacementArea(t,uniId++,"xx","xx");n.setWidth("440px"),n.setHeight("40px"),n.setOffset({top:"3",left:"470"}),e.resizeOffset(n.setOffset,n,"left",["mid",3],453);var a=new PlacementArea(t,uniId++,"xx","xx");a.setWidth("900px"),a.setHeight("270px"),a.setOffset({top:"0",left:"18"}),a.jElement.addClass("header-area"),e.resizeOffset(a.setOffset,a,"left",["mid",-449],1);var h=new PlacementArea(t,uniId++,"xx","xx");h.setWidth("130px"),h.setHeight("50px"),h.setOffset({top:"205",left:"780"}),e.resizeOffset(h.setOffset,h,"left",["mid",317],767);var d=new PlacementArea(t,uniId++,"xx","xx");d.setWidth("900px"),d.setHeight("30px"),d.setOffset({top:"235",left:"25"}),e.resizeOffset(d.setOffset,d,"left",["mid",-442],8);var r=new PlacementArea(t,uniId++,"xx","xx");r.setWidth("300px"),r.setHeight("100px"),r.setOffset({top:"600",left:"600"}),e.resizeOffset(r.setOffset,r,"left",["mid",133],583),e.resizeOffset(r.setOffset,r,"top",["abs",-100],390);var o=new PlacementArea(t,uniId++,"xx","xx");o.setWidth("295px"),o.setHeight("7px"),o.setOffset({top:"800",left:"605"}),o.getJElement().addClass("dectris-background"),e.resizeOffset(o.setOffset,o,"left",["mid",138],588),e.resizeOffset(o.setOffset,o,"top",["abs",-7],390);var l=new PlacementArea(t,uniId++,"xx","xx");l.jElement.addClass("main-area"),l.setWidth("900px"),l.setOffset({top:"290",left:"18"}),e.resizeOffset(l.setOffset,l,"left",["mid",-449],1),e.trigger();var c=new BlockArea(i,uniId++,"xx","xx"),u=c.addWidget(Image,[]);u.setSrc("im/Banner_BRUENIG_WEBCLIENT.jpg"),u.setWidth("900px");var f=new BlockArea(s,uniId++,"xx","xx"),p=f.addWidget(Image,[]);p.setSrc("im/dectris_logo_1x.jpg"),p.setWidth("173px");var m=new BlockArea(n,uniId++,"xx","xx"),g=m.addWidget(Image,[]);g.setSrc("im/dectris_claim.png"),g.setWidth("440px");var b=new BlockArea(r,uniId++,"xx","xx"),E=b.addWidget(Label,[]);E.getJElement().addClass("dectris"),E.getJElement().html("<b>DECTRIS Ltd.</b><br>5400 Baden<br>Switzerland<br><b>www.dectris.com<b>");var x=new BlockArea(h,uniId++,"xx","xx"),I=new UiHandler(t,l,T,e),y=new EIGERUiHandler(I),v=x.addWidget(Label,[]);v.setText("No S/N Found"),v.setWidth("100px"),y.uiConnect(v,y.e.detector.config.detector_number,10),x.addNewLine();var w=x.addWidget(Indicator,[]);w.setText("Not Connected"),w.setWidth("120px"),y.uiConnect(w,y.e.detector.status.state,1);var T=new BlockArea(d,1,"xx","xx"),C=I.addView(BlockArea,"Settings","Detector Settings"),L=I.addView(BlockArea,"Acquire","Aquisition Settings"),W=I.addView(BlockArea,"Exposure","Exposure Information"),k=I.addView(BlockArea,"Data","Data Information"),R=I.addView(BlockArea,"Log","Logs and Information"),A=I.addView(BlockArea,"Help & Support","Information about DECTRIS Ltd. support and help."),Q=(I.addNavButton(C,T),I.addNavButton(L,T),I.addNavButton(W,T),I.addNavButton(k,T),I.addNavButton(R,T),I.addNavButton(A,T),C.addWidget(EIGERConSet,[I,y]),L.addWidget(EIGERAcqSet,[I,y]),W.addWidget(EIGERAcq,[I,y]),k.addWidget(EIGERData,[I,y]),R.addWidget(EIGERLog,[I,y]),A.addWidget(EIGERHelp,[I,y]),new BlockArea(l,uniId++,"xx","xx")),D=Q.addWidget(Label,[]);D.getJElement().addClass("main-footer"),D.setText(sprintf("EIGER Quick Start Client, %s, Copyright: DECTRIS Ltd., Author: Andy Moesch",clientVersion))});