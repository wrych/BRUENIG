function msToISO(t){if(isNaN(t))throw"NaN";return toLocalISO(new Date(t))}function toLocalISO(t){var e=-t.getTimezoneOffset(),i=e>=0?"+":"-",s=function(t){var e=Math.abs(Math.floor(t));return(10>e?"0":"")+e};return t.getFullYear()+"-"+s(t.getMonth()+1)+"-"+s(t.getDate())+"T"+s(t.getHours())+":"+s(t.getMinutes())+":"+s(t.getSeconds())+"."+s(t.getMilliseconds())+i+s(e/60)}function filterInt(t){return/^(\-|\+)?([0-9]+|Infinity)$/.test(t)?Number(t):0/0}function prettyJSON(t){if("string"==typeof t){try{var e=JSON.parse(t)}catch(i){return t}t=JSON.stringify(e,void 0,2)}return t=t.replace(/&/g,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;"),t.replace(/("(\\u[a-zA&'-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(t){var e="number";return/^"/.test(t)?e=/:$/.test(t)?"key":"string":/true|false/.test(t)?e="boolean":/null/.test(t)&&(e="null"),'<span class="'+e+'">'+t+"</span>"})}function extend(t,e){var i=e.prototype;e.prototype=Object.create(t.prototype);for(var s in i)e.prototype[s]=i[s];e.prototype.constructor=e,Object.defineProperty(e.prototype,"constructor",{enumerable:!1,value:e})}function construct(t,e){function i(){return t.apply(this,e)}return i.prototype=t.prototype,new i}function AreaResizer(){this.addResizeListener(this.resized),this.offsetList=[]}function LineBreak(){this.jElement=$("<br>")}function Area(t,e,i,s){this.parent=t,this.id=e,this.name=i,this.description=s,this.jElement=$('<div class="area"></div>').appendTo(this.parent.getJElement())}function BodyArea(t){this.parentJElement=null,this.parent=null,this.id=t,this.name="Body",this.description="Body",this.jElement=$("body")}function PlacementArea(t,e,i,s){Area.call(this,t,e,i,s),this.jElement.addClass("placement")}function BlockArea(t,e,i,s){Area.call(this,t,e,i,s),this.jElement.addClass("block"),this.widgetList=[]}function ViewArea(t,e,i,s){BlockArea.call(this,t,e,i,s),this.active=!0}function WidgetArea(t,e,i,s){Area.call(this,t,e,i,s),this.jElement.addClass("widget")}function ContainerArea(t,e,i,s){Area.call(this,t,e,i,s),this.jElement.addClass("container"),this.widgetList=[]}function Pre(t,e,i,s){ContainerArea.call(this,t,e,i,s),this.type="Pre",this.jPre=$("<pre/>").appendTo(this.jElement),this.jPre.appendTo(this.jElement)}function Input(t,e,i,s){ContainerArea.call(this,t,e,i,s),this.type="Input",this.label=new _Label(this,this.id,this.name,this.description),this.nwl01=this.addNewLine(),this.jInput=$("<input>").prop({type:"Text"}).appendTo(this.jElement)}function CheckBox(t,e,i,s){ContainerArea.call(this,t,e,i,s),this.type="CheckBox",this.label=new _Label(this,this.id,this.name,this.description),$("<br>").appendTo(this.jElement),this.jInput=$("<input type='checkbox'>").appendTo(this.jElement)}function Select(t,e,i,s){ContainerArea.call(this,t,e,i,s),this.type="Select",this.length=0,this.label=new _Label(this,this.id,this.name,this.description),$("<br>").appendTo(this.jElement),this.jInput=$("<select></select>").appendTo(this.jElement)}function Extendable(t,e,i,s){ContainerArea.call(this,t,e,i,s),this.jElement.addClass("expandable"),this.expanded=!1,this.clickListeners=[],this.tlt01=this.addWidget(Title,[]),this.tlt01.setLvl("h3"),this.tlt01.setWidth("800px"),this._img01=this.addWidget(Image,[]),this._img01.setSrc("im/expand.png"),this._img01.setWidth("12px"),this.addNewLine(),this.containerArea=this.addWidget(ContainerArea,[]),this.containerArea.setVisibility(!1),this.addClickListener(this.tlt01.jElement,this.clicked),this.addClickListener(this._img01.jElement,this.clicked),this.click(this.toggle,this)}function _Label(t,e,i,s){WidgetArea.call(this,t,e,i,s),this.type="_Label",this.jElement.addClass("label"),this.setWidth("200px"),this.setHeight("18px")}function Label(t,e,i,s){ContainerArea.call(this,t,e,i,s),this.type="Label",this.label=new _Label(this,this.id,this.name,this.description)}function _Title(t,e,i,s){WidgetArea.call(this,t,e,i,s),this.type="_Label",this.jElement.addClass("label"),this.jTitle=$("<h1></h1>").appendTo(this.jElement)}function Title(t,e,i,s){ContainerArea.call(this,t,e,i,s),this.type="Label",this.title=new _Title(this,this.id,this.name,this.description)}function Image(t,e,i,s){ContainerArea.call(this,t,e,i,s),this.type="Image",this.image=new _Image(this,this.id,this.name,this.description)}function _Image(t,e,i,s){WidgetArea.call(this,t,e,i,s),this.type="_Image",this.jElement.addClass("image"),this.jImage=$('<img src="">').appendTo(this.getJElement()),this.jImage.addClass("imageDisp")}function _StatusIndicator(t,e,i,s){WidgetArea.call(this,t,e,i,s),this.type="StatusIndicator",this.jElement.addClass("statusIndicator"),this.setWidth("18px"),this.setHeight("18px"),this.jElement.css("background-color","red")}function Indicator(t,e,i,s){ContainerArea.call(this,t,e,i,s),this.type="Indicator",this.jElement.addClass("indicator"),this.statusIndicator=new _StatusIndicator(this,this.id,this.name,this.description),this.label=new _Label(this,this.id,this.name,this.description)}function Form(t,e,i,s){Area.call(this,t,e,i,s),this.jForm=$("<Form/>").appendTo(this.jElement),this.widgetList=[],this.submitListeners=[],this.addSubmitListener(this.submitted)}function _Button(t,e,i,s){WidgetArea.call(this,t,e,i,s),this.type="_Button",this.jElement.addClass("button"),this.jButton=$("<input/>").prop({type:"button"}).appendTo(this.jElement),this.jButton.css("cursor","pointer")}function Button(t,e,i,s,n,a){ContainerArea.call(this,t,e,i,s),this.type="Button","undefined"!=typeof a&&(this.image=$('<img class="buttonImage">').appendTo(this.jElement),this.image.attr("src",a)),this.button=new _Button(this,uniId++,this.name,this.description),this.setText(n),this.clickListeners=[],this.addClickListener(this.button.getJElement(),this.clicked),this.disabled=!1}function SubmitButton(t,e,i,s,n,a){Button.call(this,t,e,i,s,n,a),this.setType("submit")}function Progressbar(t,e,i,s){Area.call(this,t,e,i,s),this.jElement.addClass("progressbar-container"),this.progressIndicator=$("<div class='progressbar-progress container'></div>").appendTo(this.jElement)}function NavButton(t,e,i,s,n,a){ContainerArea.call(this,t,e,i,s),this.jElement.addClass("button"),"undefined"!=typeof a&&(this.image=$('<img class="buttonImage">').appendTo(this.jElement),this.image.attr("src",a)),this.label=new _Label(this,this.id,this.name,this.description),this.label.getJElement().addClass("nav-button"),this.label.setWidth("110px"),this.setText(n),this.clickListeners=[],this.addClickListener(this.jElement,this.clicked)}function Overlay(t,e,i,s){Area.call(this,t,e,i,s),this.jElement.addClass("overlay-background")}function OverlayDisplay(t,e,i,s,n){this.overlay=new Overlay(t,e,i,s,n),ContainerArea.call(this,this.overlay,e,i,s),this.jElement.addClass("overlay-display")}function Tabular(t,e,i,s){this.parent=t,this.id=e,this.name=i,this.description=s,this.widgetList=[]}function Table(t,e,i,s){Tabular.call(this,t,e,i,s),this.jElement=$('<table class="area"></table>').appendTo(this.parent.getJElement())}function TableRow(t,e,i,s){Tabular.call(this,t,e,i,s),this.jElement=$("<tr></tr>").appendTo(this.parent.getJElement()),this.jElement.addClass("table-row")}function TableField(t,e,i,s){Tabular.call(this,t,e,i,s),this.jElement=$("<td></td>").appendTo(this.parent.getJElement()),this.text="",this.clickListeners=[],this.addClickListener(this.jElement,this.clicked)}function UiHandler(t,e,i,s){this.area=e,this.navArea=i,this.resizer=s,this.body=t,this.uiOLInt=0,this.uiOverlays={},this.uiInstInt=0,this.uiConnections={},this.viewID=0,this.viewList={},this.btnID=0,this.btnList={},this.btnAssign={}}function UiConnector(t,e,i,s,n){this.id=t,this.interval=s,this.widget=e,this.form=n,this.formAction=void 0,this.setUpWidgetListners(this),this.fValue=i,this.setDisabled(!0),this.active=!1,this.setInterval()}function inExcludedKeys(t){for(var e in excludedKeys)if(excludedKeys[e]===t)return!0;return!1}function EIGERQuery(t,e,i,s){this.id=void 0,this.handler=e,this.method=i,this.instance=t,this.data=s,this.status=0,this.progressText=""}function EIGERMQuery(t,e,i,s,n){this.qListener={widget:i,newCallback:s,updateCallback:n},this.id=void 0,this.handler=t,this.status=0,this.progressText="",this.listOfQueues="function"==typeof e[0]?e[0].apply(e[1][0],e[1]):e,this.qDone=0,this.qCount=this.listOfQueues.length,this.progress=0}function EIGERHandler(){this.qInstInt=0,this.activeQueries={},this.history=0,this.qListerInt=0,this.qListenerList={}}function EIGERContainer(){this.versionInURI=!0,this.refreshListeners=[],this.children=[]}function EIGER(t,e,i,s){EIGERContainer.call(this),this.address=t,this.port=e,this.index="detector",this.connectionStateID=0,this.handler=i,this.setVersion(void 0===s?defaultVersion:s),console.log(this),this.handler.addQueueListener(this,this.updateQItem)}function EIGERDomain(t,e){EIGERContainer.call(this),this.superDet=t,this.index=e,this.name=e,this.superDet.isVersionOrHigher(1,0,0)?this.constructVersionedChilds(subdomains,specialKeys.concat([{domain:"monitor",subdomain:"version",versionInURI:!1},{domain:"monitor",subdomain:"images",versionInURI:!0}])):this.constructVersionedChilds(subdomains,specialKeys)}function EIGERSubDomain(t,e,i){EIGERContainer.call(this),this.superDet=t,this.domain=e,this.index=i,this.name=i,this.addChilds(this.superDet.isVersionOrHigher(1,5,0)?keys[this.domain.index][this.index].concat(["keys"]):"config"===this.index||"status"===this.index?keys[this.domain.index][this.index].concat(["keys"]):keys[this.domain.index][this.index])}function EIGERKey(t,e,i,s){EIGERContainer.call(this),this.superDet=t,this.domain=e,this.subdomain=i,this.index=s,this.name=s,"command"===this.subdomain.index?this.constructChild("access_mode","w"):"status"===this.subdomain.index||"keys"==this.index?this.constructChild("access_mode","r"):this.constructChild("access_mode","")}function EIGERSpecialKey(t,e,i,s){EIGERContainer.call(this),this.superDet=t,this.domain=e,this.subdomain={},this.subdomain.index=i,this.versionInURI=s,this.index="",this.name=i,this.constructChild("access_mode","r")}function EIGERValue(t,e,i,s,n,a){this.superDet=t,this.domain=e,this.subdomain=i,this.key=s,this.index=n,this.value=a}function EIGERConSet(t,e,i,s,n,a){ContainerArea.call(this,t,e,i,s),this.ui=n,this.ui.cset=this,this.eUi=a,this.type="ConnectionWidget",this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h2"),this.ttl01.setText("EIGER Connection Settings"),this.addNewLine(),this.frm01=this.addWidget(Form,[]),this.inp01=this.frm01.addWidget(Input,[]),this.inp01.setTitle("Address"),this.inp01.setValue(document.domain),this.inp02=this.frm01.addWidget(Input,[]),this.inp02.setTitle("Port"),this.btn01=this.frm01.addWidget(SubmitButton,["connect"]),this.frm01.submit(this.connect,this)}function EIGERAcqSet(t,e,i,s,n,a){ContainerArea.call(this,t,e,i,s),this.ui=n,this.ui.acq=this,this.eUi=a,this.type="Acquisition Settings",this.advWidgets=[],this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h4"),this.ttl01.setText("Commands"),this.addAdvWidget(this.ttl01),this.addAdvWidget(this.addNewLine()),this.btn01=this.addWidget(Button,["Initialize"]),this.btn01.click(this.init,this),this.addAdvWidget(this.btn01),this.btn02=this.addWidget(Button,["Disarm"]),this.btn02.click(this.disarm,this),this.addAdvWidget(this.btn02),this.btn03=this.addWidget(Button,["Abort"]),this.btn03.click(this.abort,this),this.addAdvWidget(this.btn03),this.btn04=this.addWidget(Button,["Check State"]),this.btn04.click(this.checkState,this),this.addAdvWidget(this.btn04),this.btn05=this.addWidget(Button,["Custom Queue"]),this.btn05.click(this.customQ,this),this.addAdvWidget(this.btn05),this.addAdvWidget(this.addNewLine()),this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h4"),this.ttl01.setText("Settings"),this.frm01=this.addWidget(Form,[]),this.inp01=this.frm01.addWidget(Input,[]),this.inp01.setTitle("Photon Energy [eV]"),this.addAdvWidget(this.inp01),this.inp02=this.frm01.addWidget(Input,[]),this.inp02.setTitle("Threshold Energy [eV]"),this.addAdvWidget(this.inp02),this.sel01=this.frm01.addWidget(Select,[]),this.sel01.setTitle("Elements"),this.frm01.addNewLine(),this.inp03=this.frm01.addWidget(Input,[]),this.inp03.setTitle("Count Time"),this.inp04=this.frm01.addWidget(Input,[]),this.inp04.setTitle("Frame Time"),this.inp05=this.frm01.addWidget(Input,[]),this.inp05.setTitle("Number of Images"),this.frm01.addNewLine(),this.chk01=this.frm01.addWidget(CheckBox,[]),this.chk01.setTitle("Apply Flatfield Correction"),this.addAdvWidget(this.chk01),this.chk02=this.frm01.addWidget(CheckBox,[]),this.chk02.setTitle("Apply Countrate Correction"),this.addAdvWidget(this.chk02),this.addAdvWidget(this.frm01.addNewLine()),this.inp06=this.frm01.addWidget(Input,[]),this.inp06.setTitle("Number of Triggers"),this.addAdvWidget(this.inp06),this.sel02=this.frm01.addWidget(Select,[]),this.sel02.setTitle("Trigger Mode"),this.addAdvWidget(this.sel02),this.addAdvWidget(this.frm01.addNewLine()),this.inp07=this.frm01.addWidget(Input,[]),this.inp07.setTitle("Name Pattern"),this.addAdvWidget(this.inp07),this.inp08=this.frm01.addWidget(Input,[]),this.inp08.setTitle("NImages per Data File"),this.addAdvWidget(this.inp08),this.sel03=this.frm01.addWidget(Select,[]),this.sel03.setTitle("FileWriter Mode"),this.addAdvWidget(this.sel03),this.frm01.addNewLine(),this.frm01.addNewLine(),this.chk04=this.frm01.addWidget(CheckBox,[]),this.chk04.setTitle("Expert Mode"),this.chk04.setDisabled(!0),this.chk05=this.frm01.addWidget(CheckBox,[]),this.chk05.setTitle("Execute Commands Manually"),this.addAdvWidget(this.chk05),this.setAdvModeElVisibility(!1);var h=this;this.chk04.jInput.change(function(){h.toggleAdvanced.apply(h,[])}),this.btn06=this.frm01.addWidget(SubmitButton,["Acquire"]),this.btn06.setDisabled(!0),this.frm01.submit(this.acquire,this)}function EIGERConvenienceFunctions(t,e,i){switch(this.ui=t,this.eUi=e,this.cmp01=new EIGERSubseqCmdPrompt(this.ui.body,0,"EHC","EIGER Command Handler",this.eUi,{success:[this.success,this,[]],error:[this.error,this,[]]}),this.cmp01.setCloseDone(!1),this.cmd01=this.cmp01.addCmdLog(),i){case"initialize":this.cmd01.addCmd(this.eUi.e.detector.command.initialize,["Put","",!0]),this.cmd01.setCmdHeight("35px"),this.cmd01.exec();break;case"disarm":this.cmd01.addCmd(this.eUi.e.detector.command.disarm,["Put","",!0]),this.cmd01.setCmdHeight("35px"),this.cmd01.exec();break;case"abort":this.cmd01.addCmd(this.eUi.e.detector.command.abort,["Put","",!0]),this.cmd01.setCmdHeight("35px"),this.cmd01.exec();break;case"checkstate":this.cmd01.addCmd(this.eUi.e.detector.command.initialize,["Put","",!0]),this.cmd01.addCmd(this.eUi.e.detector.status.state,["GET","",!0]),this.cmd01.addCmd(this.eUi.e.filewriter.status.state,["GET","",!0]);var s=3;this.eUi.e.monitor&&(this.cmd01.addCmd(this.eUi.e.monitor.status.state,["GET","",!0]),s++),this.eUi.e.stream&&(this.cmd01.addCmd(this.eUi.e.stream.status.state,["GET","",!0]),s++),this.cmd01.setCmdHeight(sprintf("%spx",30*s)),this.cmd01.exec()}}function EIGERExp(t,e,i,s){this.ui=t,this.ui.exp=this,this.eUi=e;var n=this.getView("Exposure");switch(this.switchView(n),this.cmd01=n.addWidget(EIGERSubseqCmdHandler,[this.eUi,{success:[this.success,this,[]],error:[this.error,this,[]]}]),i){case"expose":this.cmd01.addCmd(this.eUi.e.detector.command.arm,["Put","",!0]),this.cmd01.addCmd(this.eUi.e.detector.command.trigger,["Put","",!0]),this.cmd01.addCmd(this.eUi.e.detector.command.disarm,["Put","",!0]),this.endView="Data";break;case"advExpose":s?(execStyle1=this.cmd01.EXEC_CLICK,execStyle2=this.cmd01.EXEC_ICLICK):(execStyle1=this.cmd01.EXEC_IMMED,execStyle2=this.cmd01.EXEC_IMMED);var a=this.eUi.e.detector.config.trigger_mode.value.value,h=this.eUi.e.detector.config.ntrigger.value.value;if(console.log(sprintf("Starting %s series with %s triggers...",a,h)),this.cmd01.addCmd(this.eUi.e.detector.command.arm,["Put","",!0]),"ints"===a.toLowerCase())for(var r=0;h>r;r++)this.cmd01.addCmd(this.eUi.e.detector.command.trigger,["Put","",!0],execStyle1);else if("inte"===a.toLowerCase())for(var r=0;h>r;r++)this.cmd01.addCmd(this.eUi.e.detector.command.trigger,["Put","",!0],this.cmd01.EXEC_VCLICK);this.cmd01.addCmd(this.eUi.e.detector.command.disarm,["Put","",!0],execStyle2,this.cmd01.ENDING_COMMAND),this.endView="Data"}this.cmd01.exec(this.cmd01)}function EIGERData(t,e,i,s,n,a){ContainerArea.call(this,t,e,i,s),this.ui=n,this.eUi=a,this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h2"),this.ttl01.setText("EIGER Data"),this.addNewLine(),this.lgh01=this.addWidget(EIGERDataLogger,[this.eUi])}function EIGERAcq(t,e,i,s,n,a){ContainerArea.call(this,t,e,i,s),this.ui=n,this.eUi=a,this.type="AcquireSettings",this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h4"),this.ttl01.setText("Acquisition")}function EIGERLog(t,e,i,s,n,a){ContainerArea.call(this,t,e,i,s),this.ui=n,this.ui.log=this,this.eUi=a,this.type="ConnectionWidget";var h=this;this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h2"),this.ttl01.setText("EIGER Logs and Command Overview"),this.addNewLine(),this.chk01=this.addWidget(CheckBox,[]),this.chk01.setTitle("Enable Command Log"),this.chk01.jInput.change(function(){h.chk01.getValue()?h.activateLog.apply(h,[]):h.disableLog.apply(h,[])}),this.lbl01=this.addWidget(Label,[]),this.addNewLine(),this.ttl02=this.addWidget(Title,[]),this.ttl02.setLvl("h4"),this.ttl02.setText("Overview"),this.addNewLine(this),this.ttl02.lbl01=this.addWidget(Label,[]),this.ttl02.lbl01.setText("Active Commands:"),this.ttl02.lbl02=this.addWidget(Label,[]),this.ttl02.lbl02.setText("n/a"),this.ttl02.lbl02.setWidth("50px"),this.uic01=n.uiConnect(this.ttl02.lbl02,function(){return Object.keys(h.eUi.eHandler.activeQueries).length},500),this.ttl02.lbl03=this.addWidget(Label,[]),this.ttl02.lbl03.setText("History:"),this.ttl02.lbl04=this.addWidget(Label,[]),this.ttl02.lbl04.setText("n/a"),this.ttl02.lbl04.setWidth("50px"),this.uic02=n.uiConnect(this.ttl02.lbl04,function(){return h.eUi.eHandler.history},500),this.addNewLine(),this.ttl03=this.addWidget(Title,[]),this.ttl03.setLvl("h4"),this.ttl03.setText("Active Commands"),this.addNewLine(),this.lgh01=this.addWidget(EIGERCmdLogger,[this.eUi])}function EIGERHelp(t,e,i,s,n,a){ContainerArea.call(this,t,e,i,s),this.ui=n,this.eUi=a,this.type="AcquireSettings",this.ttl01=this.addWidget(Title,[]),this.ttl01.setLvl("h2"),this.ttl01.setText("Support"),this.addNewLine(),this.ext01=this.addWidget(Extendable,[]),this.ext01.setTitle("Support"),this.ext01.toggle(),this.ext01.containerArea.getJElement().append($('<p>We want to be your partner and find solutions for your needs. <br> 								We can support you with our broad technical expertise and application know-how.<br><br> 								Questions and inquiries - please contact us:<br><br> 								E-mail<br> 								<a href="mailto:support@dectris.com">support@dectris.com</a><br><br> 								Homepage<br> 								<a href="http://www.dectris.com" target="_blank">www.dectris.com</a><br><br> 								Telephone<br> 								+41 56 500 21 02</p> ')),this.addNewLine(),this.ttl02=this.addWidget(Title,[]),this.ttl02.setLvl("h2"),this.ttl02.setText("Help"),this.addNewLine(),this.ext02=this.addWidget(Extendable,[]),this.ext02.setTitle("Connect"),this.ext02.img01=this.ext02.addContent(Image,[]),this.ext02.img01.setSrc("im/help/Connect.jpeg"),this.ext02.img01.setWidth("600px"),this.ext02.containerArea.getJElement().append($("<p>1. Please enter the detectors address (name or IP).<br>The port is configured to be 80 when the input is left empty <br> 							2. Click on the connect button to set up the client.</p> ")),this.addNewLine(),this.ext03=this.addWidget(Extendable,[]),this.ext03.setTitle("Settings"),this.ext03.img01=this.ext03.addContent(Image,[]),this.ext03.img01.setSrc("im/help/Settings.jpeg"),this.ext03.img01.setWidth("600px"),this.ext03.containerArea.getJElement().append($("<p>1. Please adapt the settings to your needs. <br> 							2. Click on the acquire button to record a (series) of image(s).</p> ")),this.ext03.img01=this.ext03.addContent(Image,[]),this.ext03.img01.setSrc("im/help/ExpertMode.jpeg"),this.ext03.img01.setWidth("600px"),this.ext03.containerArea.getJElement().append($("<p>Advanced users might chose to use the advanced mode. Please only use this mode if you are an expert.</p> ")),this.addNewLine(),this.ext04=this.addWidget(Extendable,[]),this.ext04.setTitle("Data Downloader"),this.ext04.img01=this.ext04.addContent(Image,[]),this.ext04.img01.setSrc("im/help/Download.jpeg"),this.ext04.img01.setWidth("600px"),this.ext04.containerArea.getJElement().append($('<p>1. By clicking the download button you will start downloading a file. <br>Always make sure to download the master and the data file.<br> 							2. Clicking the "x" button will delete the resource on the DCU. You will be asked to confirm.</p> '))}function EIGERDataLogger(t,e,i,s,n){BlockArea.call(this,t,e,i,s),this.eUi=n,this.table=this.addWidget(Table,[]),this.table.setWidth("865px"),this.setHeight("320px"),this.jElement.css("overflow-y","scroll"),this.jElement.css("overflow-x","hidden"),this.ids=0,this.rows={};for(var a in this.eUi.eHandler.activeQueries)this.newQItem(this.eUi.eHandler.activeQueries[a]);this.eUi.uiConnect(this,this.eUi.e.filewriter.files,2)}function EIGERCmdLogger(t,e,i,s,n){BlockArea.call(this,t,e,i,s),this.eUi=n,this.table=this.addWidget(Table,[]),this.table.setWidth("865px"),this.setHeight("320px"),this.jElement.css("overflow-y","scroll"),this.jElement.css("overflow-x","hidden"),this.rows={}}function EIGERCmdDisplay(t,e,i,s,n){EIGERCmdLogger.call(this,t,e,i,s,n)}function EIGERCustomCmdPrompt(t,e,i,s,n){OverlayDisplay.call(this,t,e,i,s),this.eUi=n,this.closeDone=!1,this.jElement.css("cursor","default"),this.tlt01=this.addWidget(Title,[]),this.tlt01.setLvl("h3"),this.eUi.ui.resizer.resizeOffset(this.setOffset,this,"top",["mid",-200],0),this.eUi.ui.resizer.resizeOffset(this.setOffset,this,"left",["mid",-410],0),this.eUi.ui.resizer.trigger(),this.tlt01.setText("Custom Command Queue Builder"),this.addNewLine();var a=this;this.frm01=this.addWidget(Form,[]),this.frm01.submit(this.submit,this),this.sel01=this.frm01.addWidget(Select,[]),this.sel01.setTitle("Method"),this.sel01.setWidth("80px"),this.sel01.addOptions(["GET","PUT","DELETE"]),this.sel01.jInput.change(function(t){a.changeMethod.apply(a,[t])}),this.sel02=this.frm01.addWidget(Select,[]),this.sel02.setTitle("Module"),this.sel02.setWidth("80px"),this.addOptions(this.sel02,this.eUi.e.children),this.sel02.jInput.change(function(t){a.changeModule.apply(a,[t])}),this.sel03=this.frm01.addWidget(Select,[]),this.sel03.setTitle("Task"),this.sel03.setWidth("87px"),this.sel03.jInput.change(function(t){a.changeTask.apply(a,[t])}),this.sel03.setDisabled(!0),this.sel04=this.frm01.addWidget(Select,[]),this.sel04.setTitle("Key"),this.sel04.setWidth("247px"),this.sel04.jInput.change(function(t){a.changeKey.apply(a,[t])}),this.sel04.setDisabled(!0),this.vaa01=this.frm01.addWidget(ContainerArea,[]),this.vaa01.setWidth("150px"),this.frm01.addNewLine(),this.lbl01=this.frm01.addWidget(Label,[]),this.lbl01.setWidth("500px"),this.lbl01.setText(" "),this.chk01=this.frm01.addWidget(CheckBox,[]),this.chk01.setWidth("150px"),this.chk01.setTitle("Execute manually"),this.btn01=this.frm01.addWidget(SubmitButton,["Add To Queue"]),this.btn01.setDisabled(!0),this.addNewLine(),this.cmd01=this.addWidget(EIGERSubseqCmdHandler,[this.eUi,{success:[this._done,this,[]],error:[this._fail,this,[]]}]),this.cmd01.setCmdHeight("100px"),this.cmd01.btn01.setDisabled(!0),this.addNewLine(),this.chk02=this.addWidget(CheckBox,[]),this.chk02.setTitle("Close when finished"),this.chk02.jInput.change(function(){a.closeDone=a.chk02.getValue()}),this.btn02=this.addWidget(Button,["Execute"]),this.btn02.click(this.startQ,this),this.btn02.setDisabled(!0),this.btn03=this.addWidget(Button,["Close"]),this.btn03.click(this.close,this)}function EIGERCmdInformation(t,e,i,s,n){OverlayDisplay.call(this,t,e,i,s),this.eUi=n,this.qInstance=void 0,this.reqPayload=!1,this.resPayload=!1;var a=this;this.jElement.css("cursor","default"),this.jElement.css("max-height","600px"),this.jElement.css("overflow-y","scroll"),this.jElement.css("overflow-x","hidden"),this.addClickListener(this.getJElement(),function(){}),this.eUi.ui.resizer.resizeOffset(this.setOffset,this,"top",["mid",-300],0),this.eUi.ui.resizer.resizeOffset(this.setOffset,this,"left",["mid",-400],0),this.eUi.ui.resizer.trigger(),this.img01=this.addWidget(Image,[]),this.img01.setSrc("im/wait.gif"),this.img01.setWidth("24px"),this.img01.getJElement().css("vertical-align","top"),this.tlt01=this.addWidget(Title,[]),this.tlt01.setLvl("h3"),this.tlt01.setText("Command Information"),this.addNewLine(),this.lbl01=this.addWidget(Label,[]),this.lbl01.setText("Request URI"),this.addNewLine(),this.table=this.addWidget(Table,[]),this.table.setWidth("700px"),this.tbr01=this.table.addWidget(TableRow,[]),this.tbr01.tfd01=this.tbr01.addWidget(TableField),this.tbr01.tfd01.setWidth("120px"),this.tbr01.tlt02=this.tbr01.tfd01.addWidget(Title,[]),this.tbr01.tlt02.setLvl("h3"),this.tbr01.tlt02.setText("Request"),this.tbr01.tfd02=this.tbr01.addWidget(TableField),this.tbr01.tfd02.setWidth("230px"),this.tbr01.tfd03=this.tbr01.addWidget(TableField),this.tbr01.tfd03.setWidth("120px"),this.tbr01.tlt03=this.tbr01.tfd03.addWidget(Title,[]),this.tbr01.tlt03.setLvl("h3"),this.tbr01.tlt03.setText("Response"),this.tbr01.tfd04=this.tbr01.addWidget(TableField),this.tbr01.tfd04.setWidth("230px"),this.tbr02=this.table.addWidget(TableRow,[]),this.tbr02.setHeight("22px"),this.tbr02.tfd01=this.tbr02.addWidget(TableField),this.tbr02.tfd01.setText("Address"),this.tbr02.tfd02=this.tbr02.addWidget(TableField),this.tbr02.tfd02.setText("DCU_Addr"),this.tbr02.tfd03=this.tbr02.addWidget(TableField),this.tbr02.tfd03.setText("Code"),this.tbr02.tfd04=this.tbr02.addWidget(TableField),this.tbr02.tfd04.setText("RESPONSE_CODE"),this.tbr03=this.table.addWidget(TableRow,[]),this.tbr03.setHeight("22px"),this.tbr03.tfd01=this.tbr03.addWidget(TableField),this.tbr03.tfd01.setText("Port"),this.tbr03.tfd02=this.tbr03.addWidget(TableField),this.tbr03.tfd02.setText("DCU_Port"),this.tbr03.tfd03=this.tbr03.addWidget(TableField),this.tbr03.tfd03.setText("Status"),this.tbr03.tfd04=this.tbr03.addWidget(TableField),this.tbr03.tfd04.setText("RESPONSE_Status"),this.tbr04=this.table.addWidget(TableRow,[]),this.tbr04.setHeight("22px"),this.tbr04.tfd01=this.tbr04.addWidget(TableField),this.tbr04.tfd01.setText("Module"),this.tbr04.tfd02=this.tbr04.addWidget(TableField),this.tbr04.tfd02.setText("Module"),this.tbr05=this.table.addWidget(TableRow,[]),this.tbr05.setHeight("22px"),this.tbr05.tfd01=this.tbr05.addWidget(TableField),this.tbr05.tfd01.setText("API Version"),this.tbr05.tfd02=this.tbr05.addWidget(TableField),this.tbr05.tfd02.setText("DCU_APIVER"),this.tbr06=this.table.addWidget(TableRow,[]),this.tbr06.setHeight("22px"),this.tbr06.tfd01=this.tbr06.addWidget(TableField),this.tbr06.tfd01.setText("Task"),this.tbr06.tfd02=this.tbr06.addWidget(TableField),this.tbr06.tfd02.setText("Task"),this.tbr07=this.table.addWidget(TableRow,[]),this.tbr07.setHeight("22px"),this.tbr07.tfd01=this.tbr07.addWidget(TableField),this.tbr07.tfd01.setText("Key"),this.tbr07.tfd02=this.tbr07.addWidget(TableField),this.tbr07.tfd02.setText("Key"),this.tbr08=this.table.addWidget(TableRow,[]),this.tbr08.tfd01=this.tbr08.addWidget(TableField),this.tbr08.tfd01.setText("Payload"),this.tbr08.tfd02=this.tbr08.addWidget(TableField),this.tbr08.tfd02.lbl01=this.tbr08.tfd02.addWidget(Label,[]),this.tbr08.tfd02.lbl01.setWidth("210px"),this.tbr08.tfd02.lbl01.getJElement().css("overflow-x","hidden"),this.tbr08.tfd02.lbl01.getJElement().css("overflow-y","hidden"),this.tbr08.tfd02.lbl01.getJElement().css("vertical-align","top"),this.tbr08.tfd02.lbl01.setText("RESPONSE_Payload"),this.tbr08.tfd02.img01=this.tbr08.tfd02.addWidget(Image,[]),this.tbr08.tfd02.img01.getJElement().css("vertical-align","top"),this.tbr08.tfd02.img01.setSrc("im/expand.png"),this.tbr08.tfd02.img01.setWidth("12px"),this.tbr08.tfd02.click(function(){a.toggleReqPayload.apply(a,[])}),this.tbr08.tfd03=this.tbr08.addWidget(TableField),this.tbr08.tfd03.setText("Payload"),this.tbr08.tfd04=this.tbr08.addWidget(TableField),this.tbr08.tfd04.lbl01=this.tbr08.tfd04.addWidget(Label,[]),this.tbr08.tfd04.lbl01.setWidth("210px"),this.tbr08.tfd04.lbl01.getJElement().css("overflow-x","hidden"),this.tbr08.tfd04.lbl01.getJElement().css("overflow-y","hidden"),this.tbr08.tfd04.lbl01.getJElement().css("vertical-align","top"),this.tbr08.tfd04.lbl01.setText("RESPONSE_Payload"),this.tbr08.tfd04.img01=this.tbr08.tfd04.addWidget(Image,[]),this.tbr08.tfd04.img01.getJElement().css("vertical-align","top"),this.tbr08.tfd04.img01.setSrc("im/expand.png"),this.tbr08.tfd04.img01.setWidth("12px"),this.tbr08.tfd04.click(function(){a.toggleResPayload.apply(a,[])}),this.pre01=this.addWidget(Pre,[]),this.pre01.getJElement().css("overflow-y","scroll"),this.pre01.setWidth("700px"),this.pre01.getJElement().css("max-height","200px"),this.pre01.setVisibility(!1),this.pre01.addClickListener(this.pre01.getJElement(),function(){}),this.tbl02=this.addWidget(Table,[]),this.tbl02.setWidth("700px"),this.tbr09=this.tbl02.addWidget(TableRow,[]),this.tbr09.tfd01=this.tbr09.addWidget(TableField),this.tbr09.tfd01.setWidth("120px"),this.tbr09.tlt02=this.tbr09.tfd01.addWidget(Title,[]),this.tbr09.tlt02.setLvl("h3"),this.tbr09.tlt02.setText("Meta"),this.tbr09.tfd02=this.tbr09.addWidget(TableField),this.tbr09.tfd02.setWidth("230px"),this.tbr09.tfd03=this.tbr09.addWidget(TableField),this.tbr09.tfd03.setWidth("120px"),this.tbr09.tfd04=this.tbr09.addWidget(TableField),this.tbr09.tfd04.setWidth("230px"),this.tbr10=this.tbl02.addWidget(TableRow,[]),this.tbr10.tfd01=this.tbr10.addWidget(TableField),this.tbr10.tfd01.setText("Start Time"),this.tbr10.tfd02=this.tbr10.addWidget(TableField),this.tbr10.tfd02.setText("REQ_Time"),this.tbr10.tfd03=this.tbr10.addWidget(TableField),this.tbr10.tfd03.setText("Done Time"),this.tbr10.tfd04=this.tbr10.addWidget(TableField),this.tbr10.tfd04.setText("RESPONSE_Time"),this.tbr11=this.tbl02.addWidget(TableRow,[]),this.tbr11.tfd01=this.tbr11.addWidget(TableField),this.tbr11.tfd01.setText("Duration"),this.tbr11.tfd02=this.tbr11.addWidget(TableField),this.tbr11.tfd02.setText("REQ_Duration"),this.addNewLine(),this.chk01=this.addWidget(CheckBox,[]),this.chk01.setTitle("Update automatically"),this.enableAutoUpdate(),this.chk01.getJElement().change(function(){a.chk01.getValue()?a.enableAutoUpdate.apply(a,[]):a.disableAutoUpdate.apply(a,[])}),this.btn01=this.addWidget(Button,["Close"]),this.btn01.click(this.remove,this),this.setClickClose(!0)}function EIGERSubseqCmdPrompt(t,e,i,s,n,a){OverlayDisplay.call(this,t,e,i,s),this.eUi=n,this.closeDone=!0,this.callback=a,this.img01=this.addWidget(Image,[]),this.img01.setSrc("im/wait.gif"),this.img01.setWidth("24px"),this.img01.getJElement().css("vertical-align","top"),this.tlt01=this.addWidget(Title,[]),this.tlt01.setLvl("h3"),this.eUi.ui.resizer.resizeOffset(this.setOffset,this,"top",["mid",-200],0),this.eUi.ui.resizer.resizeOffset(this.setOffset,this,"left",["mid",-410],0),this.eUi.ui.resizer.trigger(),this.cmdLogList=[],this.cmdLogCallback=[],this.cmdLogId=0}function EIGERSubseqCmdHandler(t,e,i,s,n,a){BlockArea.call(this,t,e,i,s),this.listOfQueues=[],this.callbackList=a,this.eUi=n,this.status=0,this.statusText="",this.tblContainer=this.addWidget(BlockArea,t,e,i,s),this.tblContainer.jElement.css("overflow-y","scroll"),this.tblContainer.jElement.css("overflow-x","hidden"),this.setHeight("400px"),this.table=this.tblContainer.addWidget(Table,[]),this.table.setWidth("865px"),this.btn01=this.addWidget(Button,["Cancel"]),this.btn01.click(this.cancel,this),this.rows={},this.eUi.addQueryStatusListener(this.updateQItem,this.newQItem,this),this.mQIter=0,this.eIter=0}function EIGERTableRow(t,e,i,s){TableRow.call(this,t,e,i,s),this.tfd01=this.addWidget(TableField,[]),this.tfd01.setText("ID"),this.tfd01.setWidth("40px"),this.tfd02=this.addWidget(TableField,[]),this.tfd02.setText("Path : Key"),this.tfd02.setWidth("640px"),this.tfd03=this.addWidget(TableField,[]),this.tfd03.setWidth("110px"),this.tfd03.ind01=this.tfd03.addWidget(Indicator,[]),this.tfd03.ind01.setText("Status"),this.tfd03.ind01.setWidth("100px"),this.tfd04=this.addWidget(TableField,[]),this.tfd04.setText("Error"),this.tfd04.setWidth("70px")
}function EIGERTableMCRow(t,e,i,s){TableRow.call(this,t,e,i,s),this.tfd01=this.addWidget(TableField,[]),this.tfd01.setText("ID"),this.tfd01.setWidth("40px"),this.tfd02=this.addWidget(TableField,[]),this.tfd02.setWidth("640px"),this.tfd02.prb01=this.tfd02.addWidget(Progressbar,[]),this.tfd02.prb01.setProgress(0),this.tfd03=this.addWidget(TableField,[]),this.tfd03.setText("Status"),this.tfd03.setWidth("100px"),this.tfd04=this.addWidget(TableField,[]),this.tfd04.setText("Error"),this.tfd04.setWidth("70px")}function EIGERDataTableRow(t,e,i,s){EIGERTableRow.call(this,t,e,i,s),this.tfd02.setWidth("590px"),this.tfd03.setWidth("120px"),this.tfd03.ind01.setWidth("80px"),this.tfd04.setWidth("110px")}function EIGERUiHandler(t){this.ui=t,this.fu=fu++,this.uiInstInt=0,this.uiConnections={},this.listOfSyncedKeys=[],this.eHandler=new EIGERHandler,this.e=new EIGER("","",this.eHandler),this.refInterval=1e3}function EIGERUiConnector(t,e,i,s,n,a){this.eUi=t,this.id=e,this.interval=n,this.form=a,this.formAction=[],this.widget=i,this.eigerValue=s,this.setUpWidgetListners(this),this.setDisabled(!0)}AreaResizer.prototype={resizeOffset:function(t,e,i,s,n){this.offsetList.push([t,e,i,s,n])},resized:function(t,e){for(var i=0;i<this.offsetList.length;i++)if("abs"===this.offsetList[i][3][0]){var s="top"===this.offsetList[i][2]?"height":"width",n=e[s]+this.offsetList[i][3][1];n=n>this.offsetList[i][4]?n:this.offsetList[i][4];var a={};a[this.offsetList[i][2]]=n,this.offsetList[i][0].apply(this.offsetList[i][1],[a])}else if("mid"===this.offsetList[i][3][0]){var s="top"===this.offsetList[i][2]?"height":"width",n=e[s]/2+this.offsetList[i][3][1];n=n>this.offsetList[i][4]?n:this.offsetList[i][4];var a={};a[this.offsetList[i][2]]=n,this.offsetList[i][0].apply(this.offsetList[i][1],[a])}},addResizeListener:function(t){var e=this;$(window).resize(function(i){t.apply(e,[i,{width:$(window).width(),height:$(window).height()}])})},trigger:function(){this.resized("",{width:$(window).width(),height:$(window).height()})}},LineBreak.prototype={getJElement:function(){return this.jElement},setVisibility:function(t){t?this.getJElement().show():this.getJElement().hide()}},Area.prototype={getParent:function(){return this.parent()},getId:function(){return this.id},getName:function(){return this.name},getDescription:function(){return this.description},getJElement:function(){return this.jElement},addClickListener:function(t,e){var i=this;$(t).click(function(t){t.stopPropagation(),e&&e.apply(i,[t])})},click:function(t,e){return this.clickListeners.push([t,e])-1},unbindClick:function(t){return delete this.clickListeners[t]},clicked:function(t){if(!this.disabled)for(var e in this.clickListeners)this.clickListeners[e][0].apply(this.clickListeners[e][1],[t])},addHoverListener:function(t,e,i){var s=this;$(t).mouseenter(function(t){t.stopPropagation(),e&&e.apply(s,[t])}),$(t).mouseleave(function(t){t.stopPropagation(),i&&i.apply(s,[t])})},setWidth:function(t){this.getJElement().width(t)},setHeight:function(t){this.getJElement().height(t)},setVisibility:function(t){t?this.getJElement().show():this.getJElement().hide()},remove:function(){this.getJElement().remove()}},BodyArea.prototype={},PlacementArea.prototype={setWidth:function(t){this.getJElement().width(t)},setHeight:function(t){this.getJElement().height(t)},setOffset:function(t){this.getJElement().offset(t)}},BlockArea.prototype={addWidget:function(){defaultArgs=[this,uniId++,arguments[0].type,"ToDo"];var t=construct(arguments[0],defaultArgs.concat(arguments[1]));return this.widgetList.push(t),t},addNewLine:function(){var t=new LineBreak;return t.getJElement().appendTo(this.jElement),t}},ViewArea.prototype={setVisibility:function(t){t?(this.getJElement().show(),this.active=!0,this.activate()):(this.getJElement().hide(),this.active&&(this.active=!1,this.leave()))},activate:function(){},leave:function(){}},WidgetArea.prototype={},ContainerArea.prototype={addWidget:function(){defaultArgs=[this,uniId++,arguments[0].type,"ToDo"];var t=construct(arguments[0],defaultArgs.concat(arguments[1]));return this.widgetList.push(t),t},addNewLine:function(){var t=new LineBreak;return t.getJElement().appendTo(this.jElement),t}},Pre.prototype={setWidth:function(t){this.getJElement().width(t);var e=t.length-2,i=t.substr(0,e);this.jPre.width(sprintf("%spx",parseInt(i)-25))},setHeight:function(t){this.getJElement().height(t);var e=t.length-2,i=t.substr(0,e);this.jPre.height(sprintf("%spx",parseInt(i)-30))},html:function(){this.jPre.html.apply(this.jPre,arguments)},empty:function(){this.jPre.empty.apply(this.jPre,arguments)}},Input.prototype={setWidth:function(t){this.getJElement().width(t),this.label.setWidth(t);var e=t.length-2,i=t.substr(0,e);this.jInput.width(sprintf("%spx",parseInt(i)-12))},setValue:function(t){this.jInput.val(t)},getValue:function(){return this.jInput.val()},setDisabled:function(t){this.jInput.prop("disabled",t)},getDisabled:function(){this.jInput.prop("disabled")},setTitle:function(){this.label.setText.apply(this.label,arguments)},getTitle:function(){this.label.getText.apply(this.label,arguments)}},CheckBox.prototype={setValue:function(t){this.jInput.prop("checked",t)},getValue:function(){return this.jInput.prop("checked")},setDisabled:function(t){this.jInput.prop("disabled",t)},getDisabled:function(){this.jInput.prop("disabled")},setTitle:function(){this.label.setText.apply(this.label,arguments)},getTitle:function(){this.label.getText.apply(this.label,arguments)}},Select.prototype={addOptions:function(t){for(var e=t.length,i=0;e>i;i++)this.length++,this.jInput.append($("<option>",{value:t[i],text:t[i]}))},empty:function(){this.jInput.empty(arguments)},setValue:function(t){this.jInput.val(t)},getValue:function(){return this.jInput.val()},setDisabled:function(t){this.jInput.prop("disabled",t)},getDisabled:function(){this.jInput.prop("disabled")},setTitle:function(){this.label.setText.apply(this.label,arguments)},getTitle:function(){this.label.getText.apply(this.label,arguments)}},Extendable.prototype={toggle:function(){(this.expanded=!this.expanded)?(this.containerArea.getJElement().slideDown(300),this._img01.setSrc("im/collapse.png")):(this.containerArea.getJElement().slideUp(300),this._img01.setSrc("im/expand.png"))},addContent:function(){return this.containerArea.addWidget.apply(this.containerArea,arguments)},setTitle:function(){this.tlt01.setText.apply(this.tlt01,arguments)}},_Label.prototype={setText:function(t){this.getJElement().text(t)},getText:function(){return this.getJElement().text()}},Label.prototype={setText:function(){this.label.setText.apply(this.label,arguments)},getText:function(){return this.label.getText.apply(this.label,arguments)},setWidth:function(t){this.getJElement().width(t),this.label.setWidth(t)}},_Title.prototype={setLvl:function(t){if(!($.inArray(t,["h1","h2","h3","h4","h5"])>-1))throw"Illegal Title Level";this.lvl=t,this.jTitle.detach(),this.jTitle=$(sprintf("<%s></%s>",t,t)).appendTo(this.jElement),this.jTitle.text(this.text)},getLvl:function(){return this.lvl},setText:function(t){this.text=t,this.jTitle.text(t)},getText:function(){return this.text}},Title.prototype={setLvl:function(){this.title.setLvl.apply(this.title,arguments)},getLvl:function(){this.title.getLvl.apply(this.title,arguments)},setText:function(){this.title.setText.apply(this.title,arguments)},getText:function(){this.title.getText.apply(this.title,arguments)}},Image.prototype={setSrc:function(){this.image.setSrc.apply(this.image,arguments)},setWidth:function(){this.image.setWidth.apply(this.image,arguments)}},_Image.prototype={setSrc:function(t){this.jImage.attr({src:t})}},_StatusIndicator.prototype={error:function(){this.getJElement().css("background-color","red")},ok:function(){this.getJElement().css("background-color","green")},warning:function(){this.getJElement().css("background-color","yellow")},grey:function(){this.getJElement().css("background-color","grey")}},Indicator.prototype={error:function(){this.statusIndicator.error.apply(this.statusIndicator,arguments)},ok:function(){this.statusIndicator.ok.apply(this.statusIndicator,arguments)},warning:function(){this.statusIndicator.warning.apply(this.statusIndicator,arguments)},grey:function(){this.statusIndicator.grey.apply(this.statusIndicator,arguments)},setText:function(){this.label.setText.apply(this.label,arguments)},setWidth:function(t){this.getJElement().width(t);var e=t.length-2,i=t.substr(0,e);this.label.setWidth(sprintf("%spx",parseInt(i)-20))}},Form.prototype={submit:function(t,e){this.submitListeners.push([t,e])},clearSubmit:function(){this.submitListeners=[]},getSubmit:function(){return this.submitListeners},submitted:function(t){if(!this.disabled)for(var e=0;e<this.submitListeners.length;e++)this.submitListeners[e][0].apply(this.submitListeners[e][1],[t])},addSubmitListener:function(t){var e=this;this.jForm.submit(function(i){return i.preventDefault(),t&&t.apply(e,[i]),!1})},setSubmitListeners:function(t){this.submitListeners=t},addWidget:function(){defaultArgs=[this,uniId++,arguments[0].type,"ToDo"];var t=construct(arguments[0],defaultArgs.concat(arguments[1]));return this.widgetList.push(t),t},addNewLine:function(){var t=new LineBreak;return t.getJElement().appendTo(this.jForm),t},getJElement:function(){return this.jForm}},_Button.prototype={setText:function(t){this.text=t,this.jButton.val(t)},getText:function(){return this.val()},setType:function(t){this.jButton.prop({type:t})},setDisabled:function(t){t?this.jButton.css("cursor","not-allowed"):this.jButton.css("cursor","pointer"),this.jButton.prop("disabled",t)}},Button.prototype={setText:function(){this.button.setText.apply(this.button,arguments)},getText:function(){this.button.getText.apply(this.button,arguments)},setType:function(){this.button.setType.apply(this.button,arguments)},setDisabled:function(t){t?(this.disabled=t,this.button.setDisabled(!0)):(this.disabled=t,this.button.setDisabled(!1))}},SubmitButton.prototype={},Progressbar.prototype={setProgress:function(t){this.progressIndicator.css("width",sprintf("%s%%",Math.round(100*t)))}},NavButton.prototype={setText:function(){this.label.setText.apply(this.label,arguments)},getText:function(){this.label.getText.apply(this.label,arguments)}},Overlay.prototype={clickClose:function(){this.remove()},setClickClose:function(t){t?this.addClickListener(this.jElement,this.clickClose):this.removeClickListener(this.jElement)},remove:function(){this.jElement.remove()}},OverlayDisplay.prototype={setClickClose:function(){this.overlay.setClickClose.apply(this.overlay,arguments)},remove:function(){this.overlay.remove.apply(this.overlay,arguments)},setOffset:function(t){this.getJElement().offset(t)}},extend(Area,BodyArea),extend(Area,BlockArea),extend(BlockArea,ViewArea),extend(Area,WidgetArea),extend(Area,ContainerArea),extend(Area,PlacementArea),extend(Area,Progressbar),extend(Area,Overlay),extend(WidgetArea,_Button),extend(WidgetArea,_Label),extend(WidgetArea,_Title),extend(WidgetArea,_Image),extend(WidgetArea,_StatusIndicator),extend(ContainerArea,Form),extend(ContainerArea,Label),extend(ContainerArea,CheckBox),extend(ContainerArea,Extendable),extend(ContainerArea,Title),extend(ContainerArea,Image),extend(ContainerArea,Pre),extend(ContainerArea,Input),extend(ContainerArea,Select),extend(ContainerArea,Indicator),extend(ContainerArea,Button),extend(Button,SubmitButton),extend(ContainerArea,NavButton),extend(ContainerArea,OverlayDisplay),Tabular.prototype={getParent:function(){return this.parent()},getId:function(){return this.id},getName:function(){return this.name},getDescription:function(){return this.description},getJElement:function(){return this.jElement},addClickListener:function(t,e){var i=this;$(t).click(function(t){t.stopPropagation(),e&&e.apply(i,[t])})},removeClickListener:function(t){$(t).unbind("click")},click:function(t,e){return this.clickListeners.push([t,e])-1},unbindClick:function(t){return delete this.clickListeners[t]},clicked:function(t){if(!this.disabled)for(var e in this.clickListeners)this.clickListeners[e][0].apply(this.clickListeners[e][1],[t])},addHoverListener:function(t,e,i){var s=this;$(t).mouseenter(function(t){t.stopPropagation(),e&&e.apply(s,[t])}),$(t).mouseleave(function(t){t.stopPropagation(),i&&i.apply(s,[t])})},setWidth:function(t){this.getJElement().width(t)},setHeight:function(t){this.getJElement().height(t)},setVisibility:function(t){t?this.getJElement().show():this.getJElement().hide()},addWidget:function(){defaultArgs=[this,uniId++,arguments[0].type,"ToDo"];var t=construct(arguments[0],defaultArgs.concat(arguments[1]));return this.widgetList.push(t),t}},Table.prototype={},TableRow.prototype={},TableField.prototype={setWidth:function(t){this.getJElement().width(t),this.getJElement().css({"max-width":t})},setText:function(t){this.text=t,this.getJElement().text(t)},setTitle:function(t){this.getJElement().attr("title",t)},getText:function(){return this.text},addWidget:function(){defaultArgs=[this,uniId++,arguments[0].type,"ToDo"];var t=construct(arguments[0],defaultArgs.concat(arguments[1]));return this.widgetList.push(t),t},addNewLine:function(){var t=new LineBreak;return t.getJElement().appendTo(this.jElement),t}},extend(Tabular,Table),extend(Tabular,TableRow),extend(Tabular,TableField),UiHandler.prototype={showOverlay:function(){var t=this.uiOLInt++,e=new Overlay(this.body,t,"Overlay","Overlay");return this.uiOverlays[t]=e,e},showOverlayDisp:function(){var t=this.uiOLInt++,e=new OverlayDisplay(this.body,t,"Overlay","Overlay");return this.uiOverlays[t]=e,e},uiConnect:function(t,e,i,s){var n=this.uiInstInt++,a=new UiConnector(n,t,e,i,s);return this.uiConnections[n]=a,a},addView:function(){var t=this.viewID++;defaultArgs=[this.area,t];var e=construct(arguments[0],defaultArgs.concat(arguments[1]));return e.setVisibility(0==Object.keys(this.viewList).length?!0:!1),this.viewList[t]=e,e},addNavButton:function(t,e,i){var s=this.btnID++;void 0===e&&(e=this.area),void 0===i&&(i=NavButton);var n=construct(i,[e,s,t.name,t.describtion,t.name]);return n.click(this.selectView,this),this.btnList[s]=n,this.btnAssign[s]=t,n},selectView:function(t){for(var e in this.btnList)if(this.btnList[e].jElement.has(t.target).length){this.activateView(this.btnAssign[this.btnList[e].id]);break}},activateView:function(t){for(var e in this.viewList)this.viewList[e].id!==t.id&&this.viewList[e].setVisibility(!1);t.setVisibility(!0)}},UiConnector.prototype={setId:function(t){this.id=t},setDisabled:function(t){"function"==typeof this.widget.setDisabled&&this.widget.setDisabled(this.widget,t)},sync:function(){"Label"===this.widget.type||"_Label"===this.widget.type?this.widget.setText(this.fValue()):"Input"===this.widget.type?this.widget.setValue(this.fValue()):"Indicator"===this.widget.type&&this.widget.setText(this.fValue())},iFunction:function(){if(this.interval>0&&!this.active){var t=this;return this.active=!0,window.setInterval(function(){t.sync.apply(t,[])},this.interval)}return this.sync(),this.iInst},setUpWidgetListners:function(){"Label"===this.widget.type||"_Label"===this.widget.type||"Input"===this.widget.type},clearInterval:function(){window.clearInterval(this.iInst),this.active=!1},setInterval:function(){this.iInst=this.iFunction()}};var defaultVersion="1.0.0",domains=["detector","filewriter"],subdomains=["config","status","command"],detkeys={config:["auto_summation","beam_center_x","beam_center_y","countrate_correction_applied","countrate_correction_bunch_mode","count_time","data_collection_date","detector_number","efficiency_correction_applied","element","flatfield_correction_applied","frame_time","nimages","number_of_excluded_pixels","photon_energy","pixel_mask_applied","sensor_material","sensor_thickness","software_version","threshold_energy","trigger_mode","virtual_pixel_correction_applied","ntrigger"],status:["state"],command:["initialize","arm","disarm","trigger","cancel","abort"]},fwrkeys={config:["transfer_mode","image_nr_start","mode","nimages_per_file","name_pattern","compression_enabled"],status:["state","error","time","buffer_free"],command:["clear"]},monkeys={config:[],status:[],command:[]},stmkeys={config:[],status:[],command:[]},specialKeys=[{domain:"detector",subdomain:"version",versionInURI:!1},{domain:"filewriter",subdomain:"version",versionInURI:!1},{domain:"filewriter",subdomain:"files",versionInURI:!0}],keys={};keys.detector=detkeys,keys.filewriter=fwrkeys,keys.monitor=monkeys,keys.stream=stmkeys;var excludedKeys=["clear","pixel_mask","flatfield"];EIGERQuery.prototype={setId:function(t){this.id=t},getId:function(){return this.id},getText:function(){return sprintf("[%s] %s:%s | %s | %s | %s",this.method,this.instance.superDet.address,this.instance.superDet.port,this.instance.domain.index,this.instance.subdomain.index,this.instance.index)},setStatus:function(t){this.status=t},exec:function(){0===this.status&&this.handler.execQuery(this)},deleteQ:function(){1===this.status?this.handler.abort(this):0===this.status&&this.handler.deleteQ(this),this.status=-2,this.handler.notifyQListenerUpdate(this)},setResponse:function(t){this.response=t},getResponse:function(){return this.response}},EIGERMQuery.prototype={getText:function(){return""},getProgress:function(){return this.qDone/this.qCount},getQDone:function(){return this.qDone},getQCount:function(){return this.qCount},setId:function(t){this.id=t},getId:function(){return sprintf("M%s",this.id)},setStatus:function(t){this.status=t},exec:function(){this.handler.addQueueListener(this,this.updateQ,this.newQ),this.status=1;for(var t in this.listOfQueues)this.listOfQueues[t].exec()},newQ:function(){},updateQ:function(t){this.checkQueued(t)&&(2===t.status?this.qDone++:-1===t.status&&(this.qDone++,this.status=-1),this.qDone===this.qCount&&1===this.status&&(this.status=2,this.handler.removeQueueListener(this)),this.qListener.updateCallback.apply(this.qListener.widget,[this]))},checkQueued:function(t){for(var e in this.listOfQueues)if(this.listOfQueues[e]===t)return!0;return!1},deleteQ:function(){this.status=-2;for(var t in this.listOfQueues)this.listOfQueues[t].deleteQ();this.handler.notifyQListenerUpdate(this)}},EIGERHandler.prototype={add2Queue:function(t,e){var i=this.qInstInt++;return t.setId(i),this.notifyQListenerNew(t),this.activeQueries[i]=t,t.progressText="Quered",e||t.exec(),t},addQueryListenerList:function(t){for(var e in t)this.qListenerList[this.qListerInt++]=t[e]},addQueueListener:function(t,e,i){var s=this.qListerInt++;this.qListenerList[s]={widget:t,newCallback:i,updateCallback:e}},abort:function(t){t.request.abort();for(var e in this.activeQueries)if(this.activeQueries[e]===t){delete this.activeQueries[e];break}},deleteQ:function(t){for(var e in this.activeQueries)if(this.activeQueries[e]===t){delete this.activeQueries[e];break}},abortAllKeyRequests:function(t){for(var e in this.activeQueries)this.activeQueries[e].instance===t&&(console.log("canceled request"),this.activeQueries[e].request.abort(),delete this.activeQueries[e])},getQueryStatusListeners:function(){return this.qListenerList},removeQueueListener:function(t){for(var e in this.qListenerList)this.qListenerList[e].widget===t&&delete this.qListenerList[e]},removeAllQueryStatusListeners:function(){this.qListenerList=[],this.qListerInt=0},notifyQListenerNew:function(t){for(var e in this.qListenerList)void 0!==this.qListenerList[e].newCallback&&this.qListenerList[e].newCallback.apply(this.qListenerList[e].widget,[t])},notifyQListenerUpdate:function(t){for(var e in this.qListenerList)this.qListenerList[e].updateCallback.apply(this.qListenerList[e].widget,[t])},execQuery:function(t){t.setStatus(1),t.progressText="Sent",this.notifyQListenerUpdate(t);var e=this;if(t.instance.versionInURI===!0)var i=sprintf("http://%s:%s/%s/api/%s/%s/%s",t.instance.superDet.address,t.instance.superDet.port,t.instance.domain.index,t.instance.superDet.version,t.instance.subdomain.index,t.instance.index);else var i=sprintf("http://%s:%s/%s/api/%s/%s",t.instance.superDet.address,t.instance.superDet.port,t.instance.domain.index,t.instance.subdomain.index,t.instance.index);t.startTime=(new Date).getTime(),t.request=$.ajax({url:i,type:t.method,contentType:"application/json",timeout:0,data:t.data}),t.request.done(function(i){e.sucess.apply(e,[t,i])}),t.request.fail(function(i){e.error.apply(e,[t,i])})},sucess:function(t,e){t.setResponse(e),"PUT"===t.method&&"config"===t.instance.subdomain.index&&"detector"===t.instance.domain.index?this._putSuccess(t,e):this._success(t,e)},_success:function(t){t.setStatus(2),t.progressText="Done",t.endTime=(new Date).getTime(),this.notifyQListenerUpdate(t),this.history++,delete this.activeQueries[t.id]},_putSuccess:function(t,e){var i=e,s=(t.instance.domain,t.instance.subdomain);if(!isNaN(Number(i.length))&&i.length>0){for(var n=[],a=0;a<i.length;a++)if(!inExcludedKeys(i[a])){var h=this.add2Queue(new EIGERQuery(s[i[a]],this,"GET"));n.push(h)}var r=new EIGERMQuery(this,n,this,function(){},this._updateMQ);r.mainQ=t,this.add2Queue(r)}},_updateMQ:function(t){t.mainQ.progressText=sprintf("UD %3.1f%%",100*t.getProgress()),this.notifyQListenerUpdate(t.mainQ),2===t.status&&(this.history++,delete this.activeQueries[t.id],this._success(t.mainQ,t.mainQ.response))},error:function(t,e){if(504==t.request.status||"timeout"===t.request.statusText)switch(t.instance.index){case"trigger":this.stateListener(t,["idle","ready"],["acquire"]);break;case"arm":this.stateListener(t,["idle","ready"],["configure"]);break;case"initialize":this.stateListener(t,["idle"],["initialize"]);break;default:this._error(t,e)}else this._error(t,e)},_error:function(t,e){t.setResponse(e),t.progressText="Error",t.setStatus(-1),this.notifyQListenerUpdate(t),this.history[t.id]=t,this.history++,delete this.activeQueries[t.id]},stateListener:function(t,e,i){t.progressText="StateMode",console.log(sprintf("Request timedout, changing to state listener mode...",t.instance.index)),this.notifyQListenerUpdate(t);var s=this,n=t.instance.superDet.detector.status.state.refresh(function(){s.stateChange.apply(s,[t,e,i])},this);t.listenerIndex=n},stateChange:function(t,e,i){var s=t.instance.superDet.detector.status.state.value.value,n=!1;for(h in e)if(s===e[h]){n=!0;break}if(console.log(sprintf("Checking state: %s (value: %s, expected: [%s])",n,s,e.join())),n)t.instance.superDet.detector.status.state.unbindRefresh(t.listenerIndex),this.sucess(t);else{var a=!0;for(var h in i)if(i[h]===s){a=!1;break}a&&(t.instance.superDet.detector.status.state.unbindRefresh(t.listenerIndex),this._error(t))}}},EIGERContainer.prototype={addChilds:function(t){for(var e in t){var i=this.constructChild(t[e]);this[t[e]]=i,this.children[t[e]]=i}},refresh:function(t,e){return this.refreshListeners.push([t,e])-1},unbindRefresh:function(t){return delete this.refreshListeners[t]},refreshed:function(t){for(var e in this.refreshListeners)this.refreshListeners[e][0].apply(this.refreshListeners[e][1],[t])},queueQuery:function(t,e,i){return this.superDet.handler.add2Queue(new EIGERQuery(this,this.superDet.handler,t,e),i)},queueGetQuery:function(t){return this.queueQuery("GET","",t)},queuePutQuery:function(t,e){return this.queueQuery("PUT",t,e)},queueDeleteQuery:function(t){return this.queueQuery("DELETE","",t)},update:function(t){if(!(this instanceof EIGERKey||this instanceof EIGERSpecialKey)){var e=[];for(var i in this.children){var s=this.children[i].update(t);void 0!==s&&(e=e.concat(s))}return e}return"w"!==this.access_mode.value?[this.queueGetQuery(t)]:void 0}},EIGER.prototype={reconstruct:function(){var t=[];this.isVersionOrHigher(1,0,0)&&t.push("monitor"),this.isVersionOrHigher(1,5,0)&&t.push("stream"),this.addChilds(domains.concat(t))},constructChild:function(t){return new EIGERDomain(this,t)},setHost:function(t,e){this.address=t,this.port=e},setVersion:function(t){this.version=t;var e=this.version.split(".");this.versionArr=[];for(var i in e)this.versionArr.push(e[i]);this.reconstruct()},updateQItem:function(t){2===t.status&&t.instance.updateValues(t.getResponse())},isVersionOrHigher:function(t,e,i){return t<this.versionArr[0]||(e<this.versionArr[1]||i<=this.versionArr[2]&&e==this.versionArr[1])&&t==this.versionArr[0]?!0:!1},unbind:function(){this.handler.removeQueueListener(this)}},EIGERDomain.prototype={constructChild:function(t){return new EIGERSubDomain(this.superDet,this,t)},constructVersionedChilds:function(t,e){this.addChilds(t);for(var i in e)e[i].domain===this.index&&(this.children[e[i].subdomain]=new EIGERSpecialKey(this.superDet,this,e[i].subdomain,e[i].versionInURI),this[e[i].subdomain]=this.children[e[i].subdomain])}},EIGERSubDomain.prototype={constructChild:function(t){return new EIGERKey(this.superDet,this.domain,this,t)}},EIGERKey.prototype={constructChild:function(t,e){var i=new EIGERValue(this.superDet,this.domain,this.subdomain,this,t,e);this.children[t]=i,this[t]=i},updateKey:function(t){return"w"!==this.access_mode.value?this.queueGetQuery(t):void 0},updateValues:function(t){var e=[];if("keys"===this.index){for(var i in t){var s=!1;for(var n in keys[this.domain.index][this.subdomain.index])if(keys[this.domain.index][this.subdomain.index][n]===t[i]){s=!0;break}s||inExcludedKeys(t[i])||e.push(t[i])}this.subdomain.children.concat(this.subdomain.addChilds(e))}for(var a in t)void 0!==this[a]?this[a].value=t[a]:this.constructChild(a,t[a]);this.refreshed()},setValue:function(t,e){return this.queuePutQuery(JSON.stringify({value:t}),e)}},EIGERSpecialKey.prototype={constructChild:function(t,e){var i=new EIGERValue(this.superDet,this.domain,this.subdomain,this,t,e);this.children[t]=i,this[t]=i},updateKey:function(t){return"w"!==this.access_mode.value?this.queueGetQuery(t):void 0},updateValues:function(t){if("value"in t)for(var e in t)void 0!==this[e]?this[e].value=t[e]:this.constructChild(e,t[e]);else{var e="value";void 0!==this[e]?this[e].value=t:this.constructChild(e,t)}this.refreshed()},setValue:function(t,e){this.queuePutQuery(JSON.stringify({value:t}),e)}},EIGERValue.prototype={update:function(t){this.key.update(t)}},extend(EIGERContainer,EIGER),extend(EIGERContainer,EIGERDomain),extend(EIGERContainer,EIGERSubDomain),extend(EIGERContainer,EIGERKey),extend(EIGERContainer,EIGERSpecialKey),EIGERConSet.prototype={connect:function(){this.eUi.connect(this.inp01.getValue(),this.inp02.getValue())},disconnect:function(){alert("Not Implemented!")}},EIGERAcqSet.prototype={connect:function(){this.eUi.uiConnect(this.inp01,this.eUi.e.detector.config.photon_energy,1,this.frm01),this.eUi.uiConnect(this.inp02,this.eUi.e.detector.config.threshold_energy,1,this.frm01),this.eUi.uiConnect(this.sel01,this.eUi.e.detector.config.element,1,this.frm01),this.eUi.uiConnect(this.inp03,this.eUi.e.detector.config.count_time,1,this.frm01),this.eUi.uiConnect(this.inp04,this.eUi.e.detector.config.frame_time,1,this.frm01),this.eUi.uiConnect(this.inp05,this.eUi.e.detector.config.nimages,1,this.frm01),this.eUi.uiConnect(this.chk01,this.eUi.e.detector.config.flatfield_correction_applied,1,this.frm01),this.eUi.uiConnect(this.chk02,this.eUi.e.detector.config.countrate_correction_applied,1,this.frm01),this.eUi.uiConnect(this.inp06,this.eUi.e.detector.config.ntrigger,1,this.frm01),this.eUi.uiConnect(this.sel02,this.eUi.e.detector.config.trigger_mode,1,this.frm01),this.eUi.uiConnect(this.inp07,this.eUi.e.filewriter.config.name_pattern,1,this.frm01),this.eUi.uiConnect(this.inp08,this.eUi.e.filewriter.config.nimages_per_file,1,this.frm01),this.eUi.uiConnect(this.sel03,this.eUi.e.filewriter.config.mode,1,this.frm01),this.eUi.setUpInterval(),this.btn06.setDisabled(!1)},acquire:function(){"idle"!==this.eUi.e.detector.status.state.value.value?alert("Detector is not in idle state, will not start exposure.\n\nPlease disarm detector or abort exposure."):this.advMode?new EIGERExp(this.ui,this.eUi,"advExpose",this.chk05.getValue()):(this.cmp01=new EIGERSubseqCmdPrompt(this.ui.body,0,"EHC","EIGER Command Handler",this.eUi,{success:[this.expose,this,[]],error:[function(){},this,[]]}),this.cmp01.setTitle("Preparing standard user mode..."),this.cmd01=this.cmp01.addCmdLog(),this.cmd01.setCmdHeight("180px"),this.cmd01.addQObj(this.eUi.e.detector.config.ntrigger.setValue(1)),this.cmd01.addQObj(this.eUi.e.detector.config.flatfield_correction_applied.setValue(!0)),this.cmd01.addQObj(this.eUi.e.detector.config.countrate_correction_applied.setValue(!0)),this.cmd01.addQObj(this.eUi.e.detector.config.trigger_mode.setValue("ints")),this.cmd01.addQObj(this.eUi.e.filewriter.config.mode.setValue("enabled")),this.cmd01.addQObj(this.eUi.e.filewriter.config.name_pattern.setValue(sprintf("BRUENIG_%s_$id",(new Date).toISOString().slice(0,10)))))},expose:function(){new EIGERExp(this.ui,this.eUi,"expose")},toggleAdvanced:function(){this.advMode||2!==this.eUi.e.connectionStateID?this.disableAdvMode():this.enableAdvMode()},enableAdvMode:function(){this.setAdvModeElVisibility(!0)},disableAdvMode:function(){this.setAdvModeElVisibility(!1)},addAdvWidget:function(t){this.advWidgets.push(t)},setAdvModeElVisibility:function(t){this.advMode=t;for(var e in this.advWidgets)this.advWidgets[e].setVisibility(t);this.chk04.setValue(t)},init:function(){new EIGERConvenienceFunctions(this.ui,this.eUi,"initialize")},disarm:function(){new EIGERConvenienceFunctions(this.ui,this.eUi,"disarm")},abort:function(){new EIGERConvenienceFunctions(this.ui,this.eUi,"abort")},checkState:function(){new EIGERConvenienceFunctions(this.ui,this.eUi,"checkstate",!0)},customQ:function(){this.cmd01=new EIGERCustomCmdPrompt(this.ui.body,0,"EHC","EIGER Command Handler",this.eUi,{success:[this.success,this,[]],error:[function(){},this,[]]})},cmdI:function(){this.cmd02=new EIGERCmdInformation(this.ui.body,0,"EHC","EIGER Command Handler",this.eUi)},success:function(){this.cmd01=""}},EIGERConvenienceFunctions.prototype={success:function(){this._success.apply(this,arguments)},error:function(){this._error.apply(this,arguments)},_success:function(){},_error:function(){}},EIGERExp.prototype={getView:function(t){for(var e in this.ui.viewList)if(this.ui.viewList[e].name===t)return this.ui.viewList[e]},switchView:function(t){this.ui.activateView(t)},success:function(){this.cmd01.remove(),dView=this.getView(this.endView),this.switchView(dView)},abortSuccess:function(t){alert(sprintf("%s\n\n%s","Failed to execute an exposure.",t.statusText)),this.switchView(this.getView("Acquire"))},error:function(){this.cmp01=new EIGERSubseqCmdPrompt(this.ui.body,0,"EHC","EIGER Command Handler",this.eUi,{success:[this.abortSuccess,this,[]],error:[function(){},this,[]]}),this.cmp01.setTitle("Recovering detector state..."),this.cmd01=this.cmp01.addCmdLog(),this.cmd01.setCmdHeight("35px"),this.cmd01.addCmd(this.eUi.e.detector.command.abort,["PUT",""])}},EIGERData.prototype={getView:function(t){for(var e in this.ui.viewList)if(this.ui.viewList[e].name===t)return this.ui.viewList[e]},switchView:function(t){this.ui.activateView(t)}},EIGERAcq.prototype={},EIGERLog.prototype={activateLog:function(){this.chk01.setValue(!0),this.uic01.setInterval(),this.uic02.setInterval(),this.lgh01.activate();var t=this;this.iInst=window.setTimeout(function(){t.disableLog.apply(t,[])},6e4),this.lbl01.getJElement().html("Please be aware that logging will automatically be disabled<br> after 60 seconds for performance consideratons.")},disableLog:function(){this.chk01.setValue(!1),this.uic01.clearInterval(),this.ttl02.lbl02.setText("n/a"),this.uic02.clearInterval(),this.ttl02.lbl04.setText("n/a"),this.lgh01.disable(),window.clearTimeout(this.iInst),this.lbl01.getJElement().html("")}},EIGERHelp.prototype={},extend(ContainerArea,EIGERConSet),extend(ContainerArea,EIGERAcqSet),extend(ContainerArea,EIGERAcq),extend(ContainerArea,EIGERData),extend(ContainerArea,EIGERLog),extend(ContainerArea,EIGERHelp),EIGERDataLogger.prototype={setValue:function(t){var e=[];for(var i in this.rows)t.indexOf(this.rows[i].fileName)<0&&this.updateQItem(i,"deleted"),e.push(this.rows[i].fileName);for(var s in t)e.indexOf(t[s])<0&&this.newQItem(t[s])},updateQItem:function(t,e){switch(e){case"new":this.rows[t].tfd03.ind01.setText("new"),this.rows[t].tfd03.ind01.ok();
break;case"downloaded":this.rows[t].tfd03.ind01.setText("downloaded"),this.rows[t].tfd03.ind01.grey();break;case"deleted":this.rows[t].tfd03.ind01.setText("deleted"),this.rows[t].tfd03.ind01.error();var i=this;this.rows[t].getJElement().delay(1e3).slideUp(200,function(){i.rows[t].getJElement().remove(),delete i.rows[t]});break;case"deleting":this.rows[t].tfd03.ind01.setText("deleting"),this.rows[t].tfd03.ind01.warning()}this.rows[t].status=e},newQItem:function(t){var e=this.ids++;this.rows[e]=this.table.addWidget(EIGERDataTableRow,[]),this.rows[e].fileName=t,this.rows[e].tfd01.setText(e),this.rows[e].tfd02.setText(t),this.rows[e].tfd04.setText("");var i=this;this.rows[e].tfd04.btn01=this.rows[e].tfd04.addWidget(Button,["download"]),this.rows[e].tfd04.btn01.click(function(){i.getData(e)},this),this.rows[e].tfd04.btn02=this.rows[e].tfd04.addWidget(Button,["x"]),this.rows[e].tfd04.btn02.click(function(){i.delData(e)},this),this.updateQItem(e,"new")},getData:function(t){window.location=sprintf("http://%s:%s/data/%s",this.eUi.e.address,this.eUi.e.port,this.rows[t].fileName),this.updateQItem(t,"downloaded")},delData:function(t){if(confirm(sprintf("Do you really want to delete the file %s on the detector control unit.",this.rows[t].fileName))){var e=this;this.updateQItem(t,"deleted"),$.ajax({url:sprintf("http://%s:%s/data/%s",this.eUi.e.address,this.eUi.e.port,this.rows[t].fileName),type:"delete",contentType:"application/json",success:function(){e.updateQItem.apply(e,[t,"deleted"])},error:function(){alert("Could not delete file."),e.updateQItem.apply(e,[t,"new"])}})}}},EIGERCmdLogger.prototype={activate:function(){this.eUi.addQueryStatusListener(this.updateQItem,this.newQItem,this);for(var t in this.eUi.eHandler.activeQueries)this.newQItem(this.eUi.eHandler.activeQueries[t])},disable:function(){this.eUi.removeQueryStatusListener(this);for(var t in this.rows)this.rows[t].getJElement().remove(),this.rows[t]=void 0,delete this.rows[t];this.rows=[]},updateQItem:function(t){var e=t.getId(),i=this;0===t.status?(this.rows[e].tfd03.ind01.setText(t.progressText),this.rows[e].tfd03.ind01.grey()):1===t.status?(this.rows[e].tfd03.ind01.setText(t.progressText),this.rows[e].tfd03.ind01.warning()):2===t.status?(this.rows[e].tfd03.ind01.setText(t.progressText),this.rows[e].tfd03.ind01.ok(),this.rows[e].getJElement().delay(500).slideUp(100,function(){i.rows[e].getJElement().remove(),i.rows[e]=void 0,delete i.rows[e]})):t.status<0&&void 0!==this.rows[e]&&(this.rows[e].tfd03.ind01.setText(t.progressText),this.rows[e].tfd03.ind01.error(),t.response&&(this.rows[e].tfd04.setText(t.response.statusText),this.rows[e].tfd04.setTitle(t.response.statusText)),this.rows[e].getJElement().delay(500).slideUp(100,function(){i.rows[e].getJElement().remove(),i.rows[e]=void 0,delete i.rows[e],t.deleteQ()}))},newQItem:function(t){var e=t.getId();this.rows[e]=this.table.addWidget(EIGERTableRow,[]);var i=this;this.rows[e].tfd01.setText(e),this.rows[e].tfd01.click(function(){i.showCmdInformation.apply(i,[t])},this),this.rows[e].tfd02.setText(t.getText()),this.rows[e].tfd02.click(function(){i.showCmdInformation.apply(i,[t])},this),this.rows[e].tfd04.setText(""),this.updateQItem(t)},showCmdInformation:function(t){var e=new EIGERCmdInformation(this.eUi.ui.body,0,"EHC","EIGER Command Information",this.eUi);e.setQ(t)}},EIGERCmdDisplay.prototype={newQItem:function(t){var e=t.getId();this.rows[e]=this.table.addWidget(EIGERTableRow,[]),this.rows[e].tfd01.setText(e),this.rows[e].tfd02.setText(t.getText()),this.rows[e].tfd04.setText("")}},EIGERCustomCmdPrompt.prototype={_done:function(){this.closeDone&&this.close()},_fail:function(){alert("Failed to execute queue...")},addOptions:function(t,e){var i=[];for(var s in e)i.push(e[s].name);t.addOptions(i),t.setValue("")},getDataType:function(t){try{var e=t.value_type.value}catch(i){if("command"===t.subdomain.index)if("trigger"===t.index)var e="float";else var e="command"}return e},addValueField:function(t){var e=this.getDataType(t);try{var i=t.allowed_values.value}catch(s){}if(void 0!==i)this.val01=this.vaa01.addWidget(Select,[]),this.val01.setTitle("Value"),this.val01.addOptions(i),this.val01.setValue(t.value.value);else switch(e){case"bool":this.val01=this.vaa01.addWidget(CheckBox,[]),this.val01.setTitle("Value"),this.val01.setValue(t.value.value);break;case"uint":case"float":case"string":this.val01=this.vaa01.addWidget(Input,[]),this.val01.setTitle("Value"),this.val01.setValue(t.value.value)}},removeValueField:function(){this.vaa01.getJElement().empty()},getValue:function(t){var e=this.getDataType(t);switch(e){case"command":var i=void 0;break;case"bool":var i=this.val01.getValue();break;case"uint":var i=filterInt(this.val01.getValue());if(isNaN(i))throw sprintf("Failed to cast '%s' to %s...",this.val01.getValue(),e);break;case"float":var i=parseFloat(this.val01.getValue());if(isNaN(i))throw sprintf("Failed to cast '%s' to %s...",this.val01.getValue(),e);break;default:var i=this.val01.getValue()}return i},changeModule:function(){this.removeValueField(),this.enableAllModes(),this.btn01.setDisabled(!0),this.sel03.empty(),this.sel03.setDisabled(!1),this.sel04.empty(),this.sel04.setDisabled(!0),this.addOptions(this.sel03,this.eUi.e[this.sel02.getValue()].children)},changeTask:function(){this.removeValueField(),this.enableAllModes(),this.btn01.setDisabled(!0),this.sel04.setDisabled(!0),this.sel04.empty(),this.eUi.e[this.sel02.getValue()][this.sel03.getValue()]instanceof EIGERSubDomain?(this.addOptions(this.sel04,this.eUi.e[this.sel02.getValue()][this.sel03.getValue()].children),this.sel04.setDisabled(!1)):this.eUi.e[this.sel02.getValue()][this.sel03.getValue()]instanceof EIGERSpecialKey&&(this.enableMode(this.eUi.e[this.sel02.getValue()][this.sel03.getValue()].access_mode.value),this.sel04.setDisabled(!0),this.btn01.setDisabled(!1))},changeKey:function(){this.removeValueField();try{var t=this.eUi.e[this.sel02.getValue()][this.sel03.getValue()][this.sel04.getValue()];switch(this.enableMode(t.access_mode.value),this.sel01.getValue()){case"PUT":this.addValueField(t);break;case"GET":default:this.removeValueField()}this.btn01.setDisabled(!1)}catch(e){console.log(e)}},changeMethod:function(){this.changeKey()},changeMode:function(){this.inp01.setDisabled(!1)},close:function(){1===this.cmd01.status?this.cmd01.cancel():this.remove()},enableAllModes:function(){var t=this.sel01.jInput.find("option");t.each(function(){$(this).prop("disabled",!1)})},enableMode:function(t){var e=this.sel01.jInput.find("option"),i=this;e.each(function(){var e=!0;if(t.search("r")>=0&&"GET"===$(this).text()&&(e=!1),t.search("w")>=0&&"PUT"===$(this).text()&&(e=!1),$(this).prop("disabled",e),e&&$(this).prop("selected")){var s=i.sel01.jInput.find("option:enabled").first();s.each(function(){i.sel01.setValue($(this).val()),i.changeMethod.apply(i,[])})}})},startQ:function(){this.btn02.setVisibility(!1),this.frm01.setVisibility(!1),this.cmd01.btn01.setDisabled(!1),this.cmd01.exec()},submit:function(){var t=this.eUi.e[this.sel02.getValue()][this.sel03.getValue()],e=t instanceof EIGERSpecialKey?t:t[this.sel04.getValue()],i=this.chk01.getValue()?this.cmd01.EXEC_CLICK:this.cmd01.EXEC_IMMED;switch(this.sel01.getValue()){case"GET":this.addQObj(e.updateKey(!0),i);break;case"PUT":try{var s=this.getValue(e);this.addQObj(e.setValue(s,!0),i)}catch(n){alert(sprintf("Error in parsing value.\n\n%s",n))}}this.btn02.setDisabled(!1)},addCmd:function(){this.cmd01.addCmd.apply(this.cmd01,arguments)},addQObj:function(){this.cmd01.addQObj.apply(this.cmd01,arguments)},addMCmd:function(){this.cmd01.addMCmd.apply(this.cmd01,arguments)},setTitle:function(){this.tlt01.setText.apply(this.tlt01,arguments)},setCmdHeight:function(){this.cmd01.setCmdHeight.apply(this.cmd01,arguments)}},extend(OverlayDisplay,EIGERCustomCmdPrompt),EIGERCmdInformation.prototype={enableAutoUpdate:function(){this.chk01.setValue(!0),this.eUi.addQueryStatusListener(this.updateQItem,this.newQItem,this)},disableAutoUpdate:function(){this.chk01.setValue(!1),this.eUi.removeQueryStatusListener(this)},updateQItem:function(t){this.qInstance===t&&this.update()},newQItem:function(){},close:function(){this.remove()},toggleReqPayload:function(){if(this.reqPayload)this.tbr08.tfd02.img01.setSrc("im/expand.png"),this.tbr08.tfd02.getJElement().css("border-bottom","0px"),this.pre01.getJElement().slideUp(300);else{this.resPayload&&(this.tbr08.tfd04.img01.setSrc("im/expand.png"),this.tbr08.tfd04.getJElement().css("border-bottom","0px"),this.resPayload=!this.resPayload),this.tbr08.tfd02.img01.setSrc("im/collapse.png"),this.tbr08.tfd02.getJElement().css("border-bottom","1px solid white");var t=this.tbr08.tfd02.lbl01.getText();this.pre01.html(""===t?"not available":prettyJSON(t)),this.pre01.getJElement().slideDown(300)}this.reqPayload=!this.reqPayload},toggleResPayload:function(){if(this.resPayload)this.tbr08.tfd04.img01.setSrc("im/expand.png"),this.tbr08.tfd04.getJElement().css("border-bottom","0px"),this.pre01.getJElement().slideUp(300);else{this.reqPayload&&(this.tbr08.tfd02.img01.setSrc("im/expand.png"),this.tbr08.tfd02.getJElement().css("border-bottom","0px"),this.reqPayload=!this.reqPayload),this.tbr08.tfd04.img01.setSrc("im/collapse.png"),this.tbr08.tfd04.getJElement().css("border-bottom","1px solid white");var t=this.tbr08.tfd04.lbl01.getText();this.pre01.html(""===t||"n/a"===t?"not available":prettyJSON(t)),this.pre01.getJElement().slideDown(300)}this.resPayload=!this.resPayload},setQ:function(t){if(this.qInstance=t,this.qInstance.instance.versionInURI===!0)var e=sprintf("http://%s:%s/%s/api/%s/%s/%s",this.qInstance.instance.superDet.address,this.qInstance.instance.superDet.port,this.qInstance.instance.domain.index,this.qInstance.instance.superDet.version,this.qInstance.instance.subdomain.index,this.qInstance.instance.index);else var e=sprintf("http://%s:%s/%s/api/%s/%s",this.qInstance.instance.superDet.address,this.qInstance.instance.superDet.port,this.qInstance.instance.domain.index,this.qInstance.instance.subdomain.index,this.qInstance.instance.index);this.lbl01.setText(sprintf("[%s] %s",t.method.toUpperCase(),e)),this.update()},update:function(){this.tbr02.tfd02.setText(this.qInstance.instance.superDet.address),this.tbr03.tfd02.setText(this.qInstance.instance.superDet.port),this.tbr04.tfd02.setText(this.qInstance.instance.domain.index);try{this.tbr05.tfd02.setText(this.qInstance.instance.domain.version.value.value)}catch(t){this.tbr05.tfd02.setText("not yet available...")}switch(this.tbr06.tfd02.setText(this.qInstance.instance.subdomain.index),this.tbr07.tfd02.setText(this.qInstance.instance.index),this.tbr08.tfd02.lbl01.setText(this.qInstance.data),this.tbr08.tfd02.setTitle(this.qInstance.data),this.qInstance.status){case 0:this.tbr02.tfd04.setText("n/a"),this.tbr03.tfd04.setText("Queued"),this.tbr08.tfd04.lbl01.setText("n/a"),this.tbr10.tfd02.setText("n/a"),this.tbr10.tfd04.setText("n/a"),this.tbr11.tfd02.setText("n/a");break;case 1:this.tbr02.tfd04.setText("n/a"),this.tbr03.tfd04.setText("Sent"),this.tbr08.tfd04.lbl01.setText("n/a"),this.tbr10.tfd02.setText(msToISO(this.qInstance.startTime)),this.tbr10.tfd04.setText("n/a"),this.tbr11.tfd02.setText("n/a");break;case 2:this.disableAutoUpdate(),this.img01.remove(),this.chk01.setDisabled(!0),this.tbr02.tfd04.setText(this.qInstance.request.status),this.tbr03.tfd04.setText(this.qInstance.request.statusText),this.tbr08.tfd04.lbl01.setText(this.qInstance.request.responseText),this.tbr08.tfd04.setTitle(this.qInstance.request.responseText),this.tbr10.tfd02.setText(msToISO(this.qInstance.startTime)),this.tbr10.tfd04.setText(msToISO(this.qInstance.endTime)),this.tbr11.tfd02.setText(sprintf("%s ms",this.qInstance.endTime-this.qInstance.startTime));break;default:this.disableAutoUpdate(),this.img01.remove(),this.chk01.setDisabled(!0);try{this.tbr02.tfd04.setText(this.qInstance.request.status),this.tbr03.tfd04.setText(this.qInstance.request.statusText),this.tbr03.tfd04.setTitle(this.qInstance.request.statusText),this.tbr08.tfd04.lbl01.setText(this.qInstance.request.responseText),this.tbr08.tfd04.setTitle(this.qInstance.request.responseText)}catch(t){this.tbr02.tfd04.setText("n/a"),this.tbr03.tfd04.setText("error"),this.tbr08.tfd04.lbl01.setText("n/a")}try{this.tbr10.tfd02.setText(msToISO(this.qInstance.startTime))}catch(t){this.tbr10.tfd02.setText("n/a")}try{this.tbr10.tfd04.setText(msToISO(this.qInstance.endTime)),this.tbr11.tfd02.setText(sprintf("%s ms",this.qInstance.endTime-this.qInstance.startTime))}catch(t){this.tbr10.tfd04.setText("n/a"),this.tbr11.tfd02.setText("n/a")}}},setTitle:function(){this.tlt01.setText.apply(this.tlt01,arguments)}},extend(OverlayDisplay,EIGERCmdInformation),EIGERSubseqCmdPrompt.prototype={addCmdLog:function(t,e){this.addNewLine();var i=this.addWidget(EIGERSubseqCmdHandler,[this.eUi,{success:[this._step,this,[this.cmdLogId,"success"]],error:[this._step,this,[this.cmdLogId,"error"]]}]);return this.cmdLogList[this.cmdLogId]=i,this.cmdLogCallback[this.cmdLogId]=t,this.cmdLogId++,this.endAfter=void 0===e?!0:!1,i},addCmd:function(){this.cmd01.addCmd.apply(this.cmd01,arguments)},addQObj:function(){this.cmd01.addQObj.apply(this.cmd01,arguments)},addMCmd:function(){this.cmd01.addMCmd.apply(this.cmd01,arguments)},exec:function(){this.cmd01.exec.apply(this.cmd01,arguments)},setCloseDone:function(t){this.closeDone=t},setTitle:function(){this.tlt01.setText.apply(this.tlt01,arguments)},setCmdHeight:function(){this.cmd01.setCmdHeight.apply(this.cmd01,arguments)},_step:function(t,e,i){if(void 0!==this.cmdLogCallback[e]&&this.cmdLogCallback[e][i][0].apply(this.cmdLogCallback[e][i][1],[t].concat(this.cmdLogCallback[e][i][2])),e===this.cmdLogId-1&&this.endAfter)if(this.callback[i][0].apply(this.callback[i][1],[t].concat(this.callback[i][2])),this.closeDone)this.remove();else{var s=this,n=this.addWidget(Button,["Close"]);n.click(function(){s.remove.apply(s,[])})}}},extend(OverlayDisplay,EIGERSubseqCmdPrompt),EIGERSubseqCmdHandler.prototype={EXEC_IMMED:0,EXEC_EXT:1,EXEC_CLICK:2,EXEC_ICLICK:3,EXEC_VCLICK:4,ENDING_COMMAND:!0,NONENDING_COMMAND:!1,addCmd:function(t,e,i,s){void 0===i&&(i=this.EXEC_IMMED),this.addQObj(t.queueQuery.apply(t,e),i,s)},addQObj:function(t,e,i){this.listOfQueues.push({qObject:t,execStyle:e,endingCommand:i}),this.newQItem(t)},addMCmd:function(t,e,i){void 0===e&&(e=this.EXEC_IMMED);var s=new EIGERMQuery(this.eUi.eHandler,t,this,this.newMQItem,this.updateMQItem);s.setId(this.mQIter++),this.listOfQueues.push({qObject:s,execStyle:e,endingCommand:i}),this.newMQItem(s)},cancel:function(){confirm('Do you really want to cancel current operation, this might cause invalid states. Press "ok" to cancel.')&&(this.status=-2,this.end())},exec:function(){var t=this.eIter++;if(void 0===this.listOfQueues[t]){var e=!0;for(var i in this.listOfQueues)if(2!==this.listOfQueues[i].qObject.status){e=!1;break}e&&this.end()}else if(0===this.listOfQueues[t].qObject.status)switch(this.listOfQueues[t].execStyle){default:case this.EXEC_IMMED:this.listOfQueues[t].qObject.exec();break;case this.EXEC_CLICK:case this.EXEC_ICLICK:case this.EXEC_VCLICK:var s=this.listOfQueues[t].qObject.getId();this.rows[s].btn01.setDisabled(!1)}else this.exec()},end:function(){if(this.btn01.remove(),this.eUi.removeQueryStatusListener(this),this.status<0){console.log("Aborting Queue due to previous error.");for(t in this.listOfQueues)this.listOfQueues[t].qObject.deleteQ()}if(this.status<0)this.callbackList.error[0].apply(this.callbackList.error[1],[this].concat(this.callbackList.error[2]));else{for(var t in this.listOfQueues)2!==this.listOfQueues[t].qObject.status&&this.listOfQueues[t].qObject.deleteQ();this.callbackList.success[0].apply(this.callbackList.success[1],[this].concat(this.callbackList.success[2]))}for(t in this.rows)delete this.rows[t]},updateQItem:function(t){var e=this.checkQueued(t);if(e){var i=t.getId();if(0===t.status)this.rows[i].tfd03.ind01.setText(t.progressText),this.rows[i].tfd03.ind01.grey();else if(1===t.status)this.status>-1&&(this.status=1),this.rows[i].tfd03.ind01.setText(t.progressText),this.rows[i].tfd03.ind01.warning(),e.execStyle===this.EXEC_CLICK||e.execStyle===this.EXEC_ICLICK?this.rows[i].btn01.remove():e.execStyle===this.EXEC_VCLICK&&(this.rows[i].btn01.remove(),this.rows[i].inp01.remove());else if(2===t.status){if(this.rows[i].tfd03.ind01.setText(t.progressText),this.rows[i].tfd03.ind01.ok(),"GET"===t.method)try{this.rows[i].tfd04.setText(t.response.value)}catch(s){}e.endingCommand===this.ENDING_COMMAND?this.end():(this.status=2,this.exec())}else t.status<0&&this.status>=0&&(this.statusText=t.request.statusText,this.status=t.status,this.rows[i].tfd03.ind01.setText(t.progressText),this.rows[i].tfd03.ind01.error(),this.rows[i].tfd04.setText(this.statusText),this.rows[i].tfd04.setTitle(this.statusText),this.end())}},newQItem:function(t){var e=this.checkQueued(t);if(e){var i=t.getId();this.rows[i]=this.table.addWidget(EIGERTableRow,[]),this.rows[i].tfd01.setText(i);var s=this;this.rows[i].tfd01.click(function(){s.showCmdInformation.apply(s,[t])},this),this.rows[i].tfd02.setText(t.getText()),this.rows[i].tfd02.click(function(){s.showCmdInformation.apply(s,[t])},this),this.rows[i].tfd04.setText(""),e.execStyle===this.EXEC_CLICK||e.execStyle===this.EXEC_ICLICK?(this.rows[i].btn01=this.rows[i].tfd04.addWidget(Button,["exec"]),this.rows[i].btn01.click(t.exec,t),e.execStyle===this.EXEC_CLICK&&this.rows[i].btn01.setDisabled(!0)):e.execStyle===this.EXEC_VCLICK&&(this.rows[i].inp01=this.rows[i].tfd04.addWidget(Input,[]),this.rows[i].inp01.label.remove(),this.rows[i].inp01.nwl01.setVisibility(!1),this.rows[i].tfd04.addNewLine(),this.rows[i].btn01=this.rows[i].tfd04.addWidget(Button,["exec"]),this.rows[i].btn01.setDisabled(!0),this.rows[i].inp01.setWidth("50px"),this.rows[i].btn01.click(function(){var e=parseFloat(s.rows[i].inp01.getValue());isNaN(e)?alert("Failed casting to float..."):(t.data=JSON.stringify({value:e}),t.exec())},t)),this.updateQItem(t)}},showCmdInformation:function(t){var e=new EIGERCmdInformation(this.eUi.ui.body,0,"EHC","EIGER Command Information",this.eUi);e.setQ(t)},updateMQItem:function(t){var e=t.getId();0===t.status?this.rows[e].tfd03.setText("queued"):1===t.status?(this.status>-1&&(this.status=1),this.rows[e].tfd03.setText(sprintf("%3.1f%%",100*t.getProgress())),this.rows[e].tfd02.prb01.setProgress(t.getProgress())):2===t.status?(this.rows[e].tfd03.setText("sucess"),this.exec()):t.status<0&&this.status>=0&&(this.rows[e].tfd02.prb01.setProgress(t.getProgress()),this.rows[e].tfd03.setText("error"),this.rows[e].tfd04.setText("An error occured."),this.rows[e].tfd04.setTitle("An error occured."),this.status=t.status,this.end())},newMQItem:function(t){var e=t.getId();this.rows[e]=this.table.addWidget(EIGERTableMCRow,[t]),this.rows[e].tfd01.setText(t.getId()),this.rows[e].tfd04.setText(""),this.updateMQItem(t)},checkQueued:function(t){for(var e in this.listOfQueues)if(this.listOfQueues[e].qObject===t)return this.listOfQueues[e];return!1},remove:function(){this.getJElement().remove()},setCmdHeight:function(t){var e=t.length-2,i=t.substr(0,e);this.getJElement().height(sprintf("%spx",parseInt(i)+30)),this.tblContainer.setHeight(t)},setHeight:function(t){this.getJElement().height(t);var e=t.length-2,i=t.substr(0,e);this.tblContainer.setHeight(sprintf("%spx",parseInt(i)-30))}},extend(BlockArea,EIGERDataLogger),extend(BlockArea,EIGERCmdLogger),extend(EIGERCmdLogger,EIGERCmdDisplay),extend(EIGERCmdLogger,EIGERSubseqCmdHandler),EIGERTableRow.prototype={},EIGERTableMCRow.prototype={},EIGERTableMCRow.prototype={},extend(TableRow,EIGERTableRow),extend(TableRow,EIGERTableMCRow),extend(EIGERTableRow,EIGERDataTableRow);var fu=0;EIGERUiHandler.prototype={_checkConnection:function(t,e,i,s){console.log(sprintf("Checking connection to %s:%s...",t,e)),""==e&&(e=80),""!=t&&this.e.setHost(t,e);var n={success:[this._checkConSuccess,this,[t,e,s]],error:[this._checkConError,this,[]]};this.cmp01=new EIGERSubseqCmdPrompt(this.ui.body,0,"EHC","EIGER Command Handler",this,n),this.cmp01.setTitle(sprintf("Trying to connect to %s:%s",t,e)),this.cmd01=this.cmp01.addCmdLog({success:[this._getKeys,this,[t,e,s]],error:[this._checkConError,this,[]]},!1),this.cmd01.setCmdHeight("35px"),this.cmd01.addCmd(this.e.detector.version,["GET",""])},_getKeys:function(){var t=this.e.detector.version.value.value;this.e.setVersion(t),this.updateUiConnections(),this.cmd02=this.cmp01.addCmdLog();var e=4;this.cmd02.addCmd(this.e.detector.config.keys,["GET",""]),this.cmd02.addCmd(this.e.detector.status.keys,["GET",""]),this.e.detector.command.keys&&(this.cmd02.addCmd(this.e.detector.command.keys,["GET",""]),e++),this.cmd02.addCmd(this.e.filewriter.config.keys,["GET",""]),this.cmd02.addCmd(this.e.filewriter.status.keys,["GET",""]),this.e.filewriter.command.keys&&(this.cmd02.addCmd(this.e.filewriter.command.keys,["GET",""]),e++),this.e.monitor&&(this.cmd02.addCmd(this.e.monitor.config.keys,["GET",""]),e++,this.cmd02.addCmd(this.e.monitor.status.keys,["GET",""]),e++,this.e.monitor.command.keys&&(this.cmd02.addCmd(this.e.monitor.command.keys,["GET",""]),e++)),this.e.stream&&(this.cmd02.addCmd(this.e.stream.config.keys,["GET",""]),e++,this.cmd02.addCmd(this.e.stream.status.keys,["GET",""]),e++,this.e.stream.command.keys&&(this.cmd02.addCmd(this.e.stream.command.keys,["GET",""]),e++)),this.cmd02.setCmdHeight(sprintf("%spx",30*e))},_checkConSuccess:function(t,e,i,s){this.e.reconstruct();var n=t.listOfQueues[1].qObject.endTime-t.listOfQueues[0].qObject.startTime;this.refInterval=5*(n+1e3),console.log(sprintf("Requests took %s ms to complete. Using %s ms as reference interval setting.",n,this.refInterval)),this._connect(e,i,s)},_checkConError:function(t){this.cmp01.remove(),alert(sprintf("%s\n\n%s","Failed to connect to detector.",t.statusText))},_connect:function(t,e,i){this.e.reconstruct(),this.updateUiConnections();var s=sprintf("Connecting to %s:%s...",t,e);if(console.log(s),i&&console.log(sprintf("Retrying after initalize...")),i){var n={success:[this.connectSuccess,this,[]],error:[this.connectError,this,[]]};cmdHeight="70px"}else{var n={success:[this.connectSuccess,this,[]],error:[this.connectErrorInit,this,[t,e,i]]};cmdHeight="40px"}this.cmp01=new EIGERSubseqCmdPrompt(this.ui.body,0,"EHC","EIGER Command Handler",this,n),this.cmp01.setTitle(s),this.cmd01=this.cmp01.addCmdLog(),this.cmd01.setCmdHeight(cmdHeight),i===!0&&this.cmd01.addCmd(this.e.detector.command.initialize,["Put","",!0]),this.cmd01.addMCmd([this.e.update,[this.e,!0]]),this.cmd01.exec()},connect:function(t,e,i){""==e&&(e=80),""!=t&&this.e.setHost(t,e),this._checkConnection(t,e,!0,i)},connectSuccess:function(){this.cmd01="",this.e.connectionStateID=2;var t=this.getView("Acquire");this.switchView(t),this.ui.acq.connect(),this.ui.acq.disableAdvMode(),this.ui.acq.chk04.setDisabled(!1)},connectError:function(t){alert(sprintf("%s\n\n%s","Failed to connect to detector.",t.statusText)),this.cmd01=""},connectErrorInit:function(t,e,i){this.cmd01="",confirm("Could not connect to detector system.\n\nThis can be caused by the detector not being initialized. Would you like initializing the detector system and retry?")&&this._connect(e,i,!0)},getView:function(t){for(var e in this.ui.viewList)if(this.ui.viewList[e].name===t)return this.ui.viewList[e]},switchView:function(t){this.ui.activateView(t)},sync:function(){for(var t in this.uiConnections)this.uiConnections[t].sync()},setUpInterval:function(){for(var t in this.uiConnections)this.uiConnections[t].setInterval(),this.uiConnections[t].eigerValue.refreshed()},uiConnect:function(t,e,i,s){var n=this.uiInstInt++,a=new EIGERUiConnector(this,n,t,e,i,s);return this.uiConnections[n]=a,a},updateUiConnections:function(){for(var t in this.uiConnections){var e=this.uiConnections[t].eigerValue.refreshListeners;this.uiConnections[t].eigerValue=this.uiConnections[t].eigerValue instanceof EIGERKey?this.e[this.uiConnections[t].eigerValue.domain.index][this.uiConnections[t].eigerValue.subdomain.index][this.uiConnections[t].eigerValue.index]:this.e[this.uiConnections[t].eigerValue.domain.index][this.uiConnections[t].eigerValue.subdomain.index],this.uiConnections[t].eigerValue.refreshListeners=e}},addQueryStatusListener:function(t,e,i){this.eHandler.addQueueListener(i,t,e)},addQueryListenerList:function(t){this.eHandler.addQueryListenerList(t)},getQueryStatusListeners:function(){return this.eHandler.getQueryStatusListeners()},removeQueryStatusListener:function(t){this.eHandler.removeQueueListener(t)},removeAllQueryStatusListeners:function(){this.eHandler.removeAllQueryStatusListeners()}},EIGERUiConnector.prototype={setId:function(t){this.id=t},setDisabled:function(t){"function"==typeof this.widget.setDisabled&&this.widget.setDisabled(t)},sync:function(){switch(this.widget.type){case"Label":case"_Label":this.widget.setText(this.eigerValue.value.value);break;case"Select":0===this.widget.length&&this.widget.addOptions(this.eigerValue.allowed_values.value);case"Input":this.widget.setValue(this.eigerValue.value.value);break;case"Indicator":this.widget.setText(this.eigerValue.value.value),$.inArray(this.eigerValue.value.value,this.eigerValue.critical_values.value.push("error"))>-1?this.widget.error():$.inArray(this.eigerValue.value.value,["initialize","configure","acquire","test"])>-1?this.widget.warning():$.inArray(this.eigerValue.value.value,["ready","idle"])>-1?this.widget.ok():this.widget.grey();break;default:this.widget.setValue(this.eigerValue.value.value)}},clearInterval:function(){window.clearInterval(this.iInst);for(var t in this.eUi.listOfSyncedKeys)if(this.eUi.listOfSyncedKeys[t][0]===this.eigerValue){delete this.eUi.listOfSyncedKeys[t];break}},setInterval:function(){this.iInst=this.iFunction(),this.setDisabled(!1)},iFunction:function(){var t=this;for(var e in this.eUi.listOfSyncedKeys)if(this.eUi.listOfSyncedKeys[e][0]===this.eigerValue){var i=e;break}if(void 0===i){var s=window.setInterval(function(){t.eigerValue.update.apply(t.eigerValue,[])},this.interval*this.eUi.refInterval);return this.eUi.listOfSyncedKeys.push([this.eigerValue,s]),s}return this.eUi.listOfSyncedKeys[i][1]},setUpWidgetListners:function(){var t=this;this.eigerValue.refresh(this.sync,this),"Label"===this.widget.type||"_Label"===this.widget.type||("Input"===this.widget.type?(this.widget.jInput.focus(function(){t.clearInterval(),t.eUi.eHandler.abortAllKeyRequests(t.eigerValue),void 0!==t.form&&(t.formAction=t.form.getSubmit(),t.form.clearSubmit(),t.form.submit(t.setValueSubmit,t))}),this.widget.jInput.focusout(function(){t.setValue.apply(t,[]),t.form.setSubmitListeners(t.formAction)})):("CheckBox"===this.widget.type||"Select"===this.widget.type)&&this.widget.jInput.change(function(){t.setValue.apply(t,[])}))},setValueSubmit:function(){this.setValue(!0)},setValue:function(t){var e=this.widget.getValue()==this.eigerValue.value.value?!1:!0;e?(console.log(sprintf("Changed %s to: %s (from: %s)",this.eigerValue.index,this.widget.getValue(),this.eigerValue.value.value)),this.cmp01=new EIGERSubseqCmdPrompt(this.eUi.ui.body,0,"EHC","EIGER Command Handler",this.eUi,{success:[this.success,this,[t]],error:[this.putError,this,[]]}),this.cmp01.setTitle(sprintf("Updating value %s...",this.eigerValue.index)),this.cmd01=this.cmp01.addCmdLog(),this.cmd01.setCmdHeight("35px"),this.cmd01.addQObj(this.eigerValue.setValue(this.widget.getValue()))):(console.log(sprintf("Unchanged value %s (%s, from: %s)",this.eigerValue.index,this.widget.getValue(),this.eigerValue.value.value)),t&&(this.reattachSubmit(),this.form.submitted())),this.setInterval()},success:function(t,e){e&&(this.reattachSubmit(),this.form.submitted())},reattachSubmit:function(){this.formAction.length>0&&void 0!==this.form&&this.form.setSubmitListeners(this.formAction)},putError:function(t){alert(sprintf("Error while executing request.\n\n%s"),t.statusText),this.cmp01=new EIGERSubseqCmdPrompt(this.eUi.ui.body,0,"EHC","EIGER Command Handler",this.eUi,{success:[this.error,this,[]],error:[this.error,this,[]]}),this.cmp01.setTitle(sprintf("Recovering value %s...",this.eigerValue.index)),this.cmd01=this.cmp01.addCmdLog(),this.cmd01.setCmdHeight("35px"),this.cmd01.addCmd(t.listOfQueues[0].qObject.instance,["GET",""])},error:function(){this.cmd01="",this.reattachSubmit()}};var clientVersion="1.3.0T3",uniId=0;$(document).ready(function(){var t=new BodyArea(uniId++),e=new AreaResizer,i=new PlacementArea(t,uniId++,"xx","xx");i.setWidth("900px"),i.setHeight("223px"),i.setOffset({top:"10",left:"10"}),e.resizeOffset(i.setOffset,i,"left",["mid",-457],-7);var s=new PlacementArea(t,uniId++,"xx","xx");s.setWidth("173px"),s.setHeight("40px"),s.setOffset({top:"3",left:"30"}),e.resizeOffset(s.setOffset,s,"left",["mid",-437],13);var n=new PlacementArea(t,uniId++,"xx","xx");n.setWidth("440px"),n.setHeight("40px"),n.setOffset({top:"3",left:"470"}),e.resizeOffset(n.setOffset,n,"left",["mid",3],453);var a=new PlacementArea(t,uniId++,"xx","xx");a.setWidth("900px"),a.setHeight("270px"),a.setOffset({top:"0",left:"18"}),a.jElement.addClass("header-area"),e.resizeOffset(a.setOffset,a,"left",["mid",-449],1);var h=new PlacementArea(t,uniId++,"xx","xx");h.setWidth("130px"),h.setHeight("50px"),h.setOffset({top:"205",left:"780"}),e.resizeOffset(h.setOffset,h,"left",["mid",317],767);var r=new PlacementArea(t,uniId++,"xx","xx");r.setWidth("900px"),r.setHeight("30px"),r.setOffset({top:"235",left:"25"}),e.resizeOffset(r.setOffset,r,"left",["mid",-442],8);var d=new PlacementArea(t,uniId++,"xx","xx");d.setWidth("300px"),d.setHeight("100px"),d.setOffset({top:"600",left:"600"}),e.resizeOffset(d.setOffset,d,"left",["mid",133],583),e.resizeOffset(d.setOffset,d,"top",["abs",-100],390);var o=new PlacementArea(t,uniId++,"xx","xx");o.setWidth("295px"),o.setHeight("7px"),o.setOffset({top:"800",left:"605"}),o.getJElement().addClass("dectris-background"),e.resizeOffset(o.setOffset,o,"left",["mid",138],588),e.resizeOffset(o.setOffset,o,"top",["abs",-7],390);var l=new PlacementArea(t,uniId++,"xx","xx");l.jElement.addClass("main-area"),l.setWidth("900px"),l.setOffset({top:"290",left:"18"}),e.resizeOffset(l.setOffset,l,"left",["mid",-449],1),e.trigger();var c=new BlockArea(i,uniId++,"xx","xx"),u=c.addWidget(Image,[]);u.setSrc("im/Banner_BRUENIG_WEBCLIENT.jpg"),u.setWidth("900px");var f=new BlockArea(s,uniId++,"xx","xx"),m=f.addWidget(Image,[]);m.setSrc("im/dectris_logo_1x.jpg"),m.setWidth("173px");var p=new BlockArea(n,uniId++,"xx","xx"),g=p.addWidget(Image,[]);g.setSrc("im/dectris_claim.png"),g.setWidth("440px");var b=new BlockArea(d,uniId++,"xx","xx"),x=b.addWidget(Label,[]);x.getJElement().addClass("dectris"),x.getJElement().html("<b>DECTRIS Ltd.</b><br>5400 Baden<br>Switzerland<br><b>www.dectris.com<b>");var E=new BlockArea(h,uniId++,"xx","xx"),v=new UiHandler(t,l,T,e),y=new EIGERUiHandler(v),w=E.addWidget(Label,[]);w.setText("No S/N Found"),w.setWidth("100px"),y.uiConnect(w,y.e.detector.config.detector_number,10),E.addNewLine();var I=E.addWidget(Indicator,[]);I.setText("Not Connected"),I.setWidth("120px"),y.uiConnect(I,y.e.detector.status.state,.2);{var T=new BlockArea(r,1,"xx","xx"),C=v.addView(ViewArea,"Settings","Detector Settings"),L=v.addView(ViewArea,"Acquire","Aquisition Settings"),W=v.addView(ViewArea,"Exposure","Exposure Information"),k=v.addView(ViewArea,"Data","Data Information"),A=v.addView(ViewArea,"Log","Logs and Information"),R=v.addView(ViewArea,"Help & Support","Information about DECTRIS Ltd. support and help."),S=(v.addNavButton(C,T),v.addNavButton(L,T),v.addNavButton(W,T),v.addNavButton(k,T),v.addNavButton(A,T),v.addNavButton(R,T),C.addWidget(EIGERConSet,[v,y]),L.addWidget(EIGERAcqSet,[v,y]),W.addWidget(EIGERAcq,[v,y]),k.addWidget(EIGERData,[v,y]),A.addWidget(EIGERLog,[v,y]));R.addWidget(EIGERHelp,[v,y])}A.activate=function(){S.activateLog()},A.leave=function(){S.disableLog()};var V=new BlockArea(l,uniId++,"xx","xx"),U=V.addWidget(Label,[]);U.getJElement().addClass("main-footer"),U.setText(sprintf("EIGER Quick Start Client, %s, Copyright: DECTRIS Ltd., Author: Andy Moesch",clientVersion))});